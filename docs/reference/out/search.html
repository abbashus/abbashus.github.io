<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>OpenSearch Reference</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="search" class="book toc2 toc-left">
<div id="header">
<h1>OpenSearch Reference</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OpenSearch Reference</a></span></p><ul class="sectlevel1">
<li><a href="opensearch-intro.html">What is OpenSearch?</a>
</li>
<li><a href="getting-started.html">Getting started with OpenSearch</a>
</li>
<li><a href="setup.html">Set up OpenSearch</a>
</li>
<li><a href="setup-upgrade.html">Upgrade OpenSearch</a>
</li>
<li><a href="index-modules.html">Index modules</a>
</li>
<li><a href="mapping.html">Mapping</a>
</li>
<li><a href="analysis.html">Text analysis</a>
</li>
<li><a href="index-templates.html">Index templates</a>
</li>
<li><a href="ingest.html">Ingest node</a>
</li>
<li><a href="search-your-data.html">Search your data</a>
</li>
<li><a href="query-dsl.html">Query DSL</a>
</li>
<li><a href="search-aggregations.html">Aggregations</a>
</li>
<li><a href="modules-scripting.html">Scripting</a>
</li>
<li><a href="high-availability.html">Set up a cluster for high availability</a>
</li>
<li><a href="snapshot-restore.html">Snapshot and restore</a>
</li>
<li><a href="commands.html">Command line tools</a>
</li>
<li><a href="how-to.html">How To</a>
</li>
<li><a href="glossary.html">Glossary of terms</a>
</li>
<li><a href="rest-apis.html">REST APIs</a>
<ul class="sectlevel1">
<li><a href="api-conventions.html">API conventions</a>
</li>
<li><a href="cat.html">Compact and aligned text (CAT) APIs</a>
</li>
<li><a href="cluster.html">Cluster APIs</a>
</li>
<li><a href="docs.html">Document APIs</a>
</li>
<li><a href="indices.html">Index APIs</a>
</li>
<li><a href="ingest-apis.html">Ingest APIs</a>
</li>
<li><a href="search.html"><span class="toc-current">Search APIs</span></a>
<ul class="sectlevel2">
<li><a href="search.html#search-search">Search API</a>
</li>
<li><a href="search.html#scroll-api">Scroll API</a>
</li>
<li><a href="search.html#clear-scroll-api">Clear scroll API</a>
</li>
<li><a href="search.html#search-template">Search Template</a>
</li>
<li><a href="search.html#multi-search-template">Multi Search Template</a>
</li>
<li><a href="search.html#search-shards">Search Shards API</a>
</li>
<li><a href="search.html#search-suggesters">Suggesters</a>
</li>
<li><a href="search.html#search-multi-search">Multi search API</a>
</li>
<li><a href="search.html#search-count">Count API</a>
</li>
<li><a href="search.html#search-validate">Validate API</a>
</li>
<li><a href="search.html#search-explain">Explain API</a>
</li>
<li><a href="search.html#search-profile">Profile API</a>
</li>
<li><a href="search.html#search-field-caps">Field capabilities API</a>
</li>
<li><a href="search.html#search-rank-eval">Ranking evaluation API</a>
</li>
<li><a href="search.html#put-snapshot-repo-api">Put snapshot repository API</a>
</li>
<li><a href="search.html#verify-snapshot-repo-api">Verify snapshot repository API</a>
</li>
<li><a href="search.html#get-snapshot-repo-api">Get snapshot repository API</a>
</li>
<li><a href="search.html#delete-snapshot-repo-api">Delete snapshot repository API</a>
</li>
<li><a href="search.html#clean-up-snapshot-repo-api">Clean up snapshot repository API</a>
</li>
<li><a href="search.html#clone-snapshot-api">Clone snapshot API</a>
</li>
<li><a href="search.html#create-snapshot-api">Create snapshot API</a>
</li>
<li><a href="search.html#get-snapshot-api">Get snapshot API</a>
</li>
<li><a href="search.html#get-snapshot-status-api">Get snapshot status API</a>
</li>
<li><a href="search.html#restore-snapshot-api">Restore snapshot API</a>
</li>
<li><a href="search.html#delete-snapshot-api">Delete snapshot API</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="breaking-changes.html">Migration guide</a>
</li>
<li><a href="opensearch-release-notes.html">Release notes</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="search">Search APIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Search APIs are used to search and aggregate data stored in OpenSearch indices.
For an overview and related tutorials, see <a href="search-your-data.html">Search your data</a>.</p>
</div>
<div class="paragraph">
<p>Most search APIs support <a href="api-conventions.html#multi-index">multi-target syntax</a>, with the
exception of the <a href="search.html#search-explain">explain API</a>.</p>
</div>
<h3 id="core-search-apis" class="discrete">Core search</h3>
<div class="ulist">
<ul>
<li>
<p><a href="search.html#search-search">Search API</a></p>
</li>
<li>
<p><a href="search.html#search-multi-search">Multi search API</a></p>
</li>
<li>
<p><a href="search.html#scroll-api">Scroll API</a></p>
</li>
<li>
<p><a href="search.html#clear-scroll-api">Clear scroll API</a></p>
</li>
<li>
<p><a href="search.html#search-suggesters">Suggesters</a></p>
</li>
</ul>
</div>
<h3 id="search-testing-apis" class="discrete">Search testing</h3>
<div class="ulist">
<ul>
<li>
<p><a href="search.html#search-explain">Explain API</a></p>
</li>
<li>
<p><a href="search.html#search-field-caps">Field capabilities API</a></p>
</li>
<li>
<p><a href="search.html#search-profile">Profile API</a></p>
</li>
<li>
<p><a href="search.html#search-rank-eval">Ranking evaluation API</a></p>
</li>
<li>
<p><a href="search.html#search-shards">Search Shards API</a></p>
</li>
<li>
<p><a href="search.html#search-validate">Validate API</a></p>
</li>
</ul>
</div>
<h3 id="search-template-apis" class="discrete">Search templates</h3>
<div class="ulist">
<ul>
<li>
<p><a href="search.html#search-template">Search Template</a></p>
</li>
<li>
<p><a href="search.html#multi-search-template">Multi Search Template</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="search-search">Search API</h3>
<titleabbrev>Search</titleabbrev>
<div class="paragraph">
<p>Returns search hits that match the query defined in the request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_search</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="search-search-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /&lt;target&gt;/_search</code></p>
</div>
<div class="paragraph">
<p><code>GET /_search</code></p>
</div>
<div class="paragraph">
<p><code>POST /&lt;target&gt;/_search</code></p>
</div>
<div class="paragraph">
<p><code>POST /_search</code></p>
</div>
</div>
<div class="sect3">
<h4 id="search-search-api-desc">Description</h4>
<div class="paragraph">
<p>Allows you to execute a search query and get back search hits that match the
query. You can provide search queries using the <a href="search.html#search-api-query-params-q"><code>q</code>
query string parameter</a> or <a href="getting-started-modify-data.html#search-request-body">request body</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-search-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;target&gt;</code></dt>
<dd>
<p>(Optional, string)
Comma-separated list of indices and index aliases to search.
Wildcard (<code>*</code>) expressions are supported.</p>
<div class="paragraph">
<p>To search all indices in a cluster, omit this parameter or use
<code>_all</code> or <code>*</code>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="search-search-api-query-params">Query parameters</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Several options for this API can be specified using a query parameter
or a request body parameter. If both parameters are specified, only the query
parameter is used.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>allow_no_indices</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error if any wildcard expression,
<a href="indices.html#indices-aliases">index alias</a>, or <code>_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code>foo*,bar*</code> returns an error if an index
starts with <code>foo</code> but no index starts with <code>bar</code>.</p>
<div class="paragraph">
<p>Defaults to <code>true</code>.</p>
</div>
</dd>
</dl>
</div>
<div id="search-partial-responses" class="dlist">
<dl>
<dt class="hdlist1"><code>allow_partial_search_results</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, returns partial results if there are request timeouts or
<a href="docs.html#shard-failures">shard failures</a>. If <code>false</code>, returns an error with
no partial results. Defaults to <code>true</code>.</p>
<div class="paragraph">
<p>To override the default for this field, set the
<code>search.default_allow_partial_results</code> cluster setting to <code>false</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>batched_reduce_size</code></dt>
<dd>
<p>(Optional, integer) The number of shard results that should be reduced at once
on the coordinating node. This value should be used as a protection mechanism
to reduce the memory overhead per search request if the potential number of
shards in the request can be large. Defaults to <code>512</code>.</p>
</dd>
</dl>
</div>
<div id="ccs-minimize-roundtrips" class="dlist">
<dl>
<dt class="hdlist1"><code>ccs_minimize_roundtrips</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, network round-trips between the
coordinating node and the remote clusters are minimized when executing
cross-cluster search (CCS) requests. See <a href="modules-cross-cluster-search.html#ccs-network-delays">How cross-cluster search handles network delays</a>. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>docvalue_fields</code></dt>
<dd>
<p>(Optional, string) A comma-separated list of fields to return as the docvalue
representation of a field for each hit.</p>
</dd>
<dt class="hdlist1"><code>expand_wildcards</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code>open,hidden</code>. Valid values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>Expand to open and closed indices, including <a href="api-conventions.html#hidden-indices">hidden indices</a>.</p>
</dd>
<dt class="hdlist1"><code>open</code></dt>
<dd>
<p>Expand only to open indices.</p>
</dd>
<dt class="hdlist1"><code>closed</code></dt>
<dd>
<p>Expand only to closed indices.</p>
</dd>
<dt class="hdlist1"><code>hidden</code></dt>
<dd>
<p>Expansion of wildcards will include hidden indices.
Must be combined with <code>open</code>, <code>closed</code>, or both.</p>
</dd>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>Wildcard expressions are not accepted.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>Defaults to <code>open</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>explain</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, returns detailed information about score
computation as part of a hit. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>from</code></dt>
<dd>
<p>(Optional, integer) Starting document offset. Defaults to <code>0</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>By default, you cannot page through more than 10,000 documents using the <code>from</code>
and <code>size</code> parameters. This limit is set using the
<a href="index-modules.html#index-max-result-window"><code>index.max_result_window</code></a> index setting.</p>
</div>
<div class="paragraph">
<p>Deep paging or requesting many results at once can result in slow searches.
Results are sorted before being returned. Because search requests usually span
multiple shards, each shard must generate its own sorted results. These separate
results must then be combined and sorted to ensure that the overall order is
correct.</p>
</div>
<div class="paragraph">
<p>As an alternative to deep paging, we recommend using
<a href="paginate-search-results.html#scroll-search-results">scroll</a> or the
<a href="paginate-search-results.html#search-after"><code>search_after</code></a> parameter.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>ignore_throttled</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, concrete, expanded or aliased indices will be
ignored when frozen. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, missing or closed indices are not included in the
response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>max_concurrent_shard_requests</code></dt>
<dd>
<p>(Optional, integer) Defines the number of concurrent shard requests per node
this search executes concurrently. This value should be used to limit the
impact of the search on the cluster in order to limit the number of concurrent
shard requests. Defaults to <code>5</code>.</p>
</dd>
<dt class="hdlist1"><code>pre_filter_shard_size</code></dt>
<dd>
<p>(Optional, integer) Defines a threshold that enforces a pre-filter roundtrip
to prefilter search shards based on query rewriting if the number of shards
the search request expands to exceeds the threshold. This filter roundtrip can
limit the number of shards significantly if for instance a shard can not match
any documents based on its rewrite method ie. if date filters are mandatory
to match but the shard bounds and the query are disjoint.
When unspecified, the pre-filter phase is executed if any of these conditions is met:</p>
<div class="ulist">
<ul>
<li>
<p>The request targets more than <code>128</code> shards.</p>
</li>
<li>
<p>The request targets one or more read-only index.</p>
</li>
<li>
<p>The primary sort of the query targets an indexed field.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="search-preference" class="dlist">
<dl>
<dt class="hdlist1"><code>preference</code></dt>
<dd>
<p>(Optional, string)
Nodes and shards used for the search. By default, OpenSearch selects from eligible
nodes and shards using <a href="search-shard-routing.html#search-adaptive-replica">adaptive replica selection</a>,
accounting for <a href="settings.html#shard-allocation-awareness">allocation awareness</a>.</p>
<details open>
<summary class="title">Valid values for <code>preference</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>_only_local</code></dt>
<dd>
<p>Run the search only on shards on the local node.</p>
</dd>
<dt class="hdlist1"><code>_local</code></dt>
<dd>
<p>If possible, run the search on shards on the local node. If not, select shards
using the default method.</p>
</dd>
<dt class="hdlist1"><code>_only_nodes:&lt;node-id&gt;,&lt;node-id&gt;</code></dt>
<dd>
<p>Run the search on only the specified nodes IDs. If suitable shards exist on more
than one selected nodes, use shards on those nodes using the default method. If
none of the specified nodes are available, select shards from any available node
using the default method.</p>
</dd>
<dt class="hdlist1"><code>_prefer_nodes:&lt;node-id&gt;,&lt;node-id&gt;</code></dt>
<dd>
<p>If possible, run the search on the specified nodes IDs. If not, select shards
using the default method.</p>
</dd>
<dt class="hdlist1"><code>_shards:&lt;shard&gt;,&lt;shard&gt;</code></dt>
<dd>
<p>Run the search only on the specified shards. This value can be combined with
other <code>preference</code> values, but this value must come first. For example:
<code>_shards:2,3|_local</code></p>
</dd>
<dt class="hdlist1">&lt;custom-string&gt;</dt>
<dd>
<p>Any string that does not start with <code>_</code>. If the cluster state and selected
shards do not change, searches using the same <code>&lt;custom-string&gt;</code> value are routed
to the same shards in the same order.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div id="search-api-query-params-q" class="dlist">
<dl>
<dt class="hdlist1"><code>q</code></dt>
<dd>
<p>(Optional, string) Query in the Lucene query string syntax.</p>
<div class="paragraph">
<p>You can use the <code>q</code> parameter to run a query parameter search. Query parameter
searches do not support the full OpenSearch <a href="query-dsl.html">Query DSL</a> but are handy for
testing.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code>q</code> parameter overrides the <a href="search.html#request-body-search-query"><code>query</code></a>
parameter in the request body. If both parameters are specified, documents
matching the <code>query</code> request body parameter are not returned.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>request_cache</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, the caching of search results is enabled for
requests where <code>size</code> is <code>0</code>. See <a href="settings.html#shard-request-cache">Shard request cache settings</a>. Defaults to index
level settings.</p>
</dd>
<dt class="hdlist1"><code>rest_total_hits_as_int</code></dt>
<dd>
<p>(Optional, Boolean) Indicates whether hits.total should be rendered as an
integer or an object in the rest search response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>routing</code></dt>
<dd>
<p>(Optional, string) Target the specified primary shard.</p>
</dd>
</dl>
</div>
<div id="search-api-scroll-query-param" class="dlist">
<dl>
<dt class="hdlist1"><code>scroll</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time value</a>)
Period to retain the <a href="paginate-search-results.html#scroll-search-context">search context</a> for scrolling. See
<a href="paginate-search-results.html#scroll-search-results">Scroll search results</a>.</p>
<div class="paragraph">
<p>By default, this value cannot exceed <code>1d</code> (24 hours). You can change
this limit using the <code>search.max_keep_alive</code> cluster-level setting.</p>
</div>
</dd>
</dl>
</div>
<div id="search-type" class="dlist">
<dl>
<dt class="hdlist1"><code>search_type</code></dt>
<dd>
<p>(Optional, string)
How <a href="https://en.wikipedia.org/wiki/Tf–idf">distributed term frequencies</a> are calculated for
<a href="query-filter-context.html#relevance-scores">relevance scoring</a>.</p>
<details open>
<summary class="title">Valid values for <code>search_type</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>query_then_fetch</code></dt>
<dd>
<p>(Default)
Distributed term frequencies are calculated locally for each shard running the
search. We recommend this option for faster searches with potentially less
accurate scoring.</p>
</dd>
</dl>
</div>
<div id="dfs-query-then-fetch" class="dlist">
<dl>
<dt class="hdlist1"><code>dfs_query_then_fetch</code></dt>
<dd>
<p>Distributed term frequencies are calculated globally, using information gathered
from all shards running the search. While this option increases the accuracy of
scoring, it adds a round-trip to each shard, which can result in slower
searches.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt class="hdlist1"><code>seq_no_primary_term</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, returns sequence number and primary term of the
last modification of each hit. See <a href="docs.html#optimistic-concurrency-control">Optimistic concurrency control</a>.</p>
</dd>
<dt class="hdlist1"><code>size</code></dt>
<dd>
<p>(Optional, integer) Defines the number of hits to return. Defaults to <code>10</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>By default, you cannot page through more than 10,000 documents using the <code>from</code>
and <code>size</code> parameters. This limit is set using the
<a href="index-modules.html#index-max-result-window"><code>index.max_result_window</code></a> index setting.</p>
</div>
<div class="paragraph">
<p>Deep paging or requesting many results at once can result in slow searches.
Results are sorted before being returned. Because search requests usually span
multiple shards, each shard must generate its own sorted results. These separate
results must then be combined and sorted to ensure that the overall order is
correct.</p>
</div>
<div class="paragraph">
<p>As an alternative to deep paging, we recommend using
<a href="paginate-search-results.html#scroll-search-results">scroll</a> or the
<a href="paginate-search-results.html#search-after"><code>search_after</code></a> parameter.</p>
</div>
<div class="paragraph">
<p>If the <a href="search.html#search-api-scroll-query-param"><code>scroll</code> parameter</a> is specified, this
value cannot be <code>0</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>sort</code></dt>
<dd>
<p>(Optional, string) A comma-separated list of &lt;field&gt;:&lt;direction&gt; pairs.</p>
</dd>
<dt class="hdlist1"><code>_source</code></dt>
<dd>
<p>(Optional)
Indicates which <a href="mapping-fields.html#mapping-source-field">source fields</a> are returned for matching
documents. These fields are returned in the <code>hits._source</code> property of
the search response. Defaults to <code>true</code>.</p>
<details open>
<summary class="title">Valid values for <code>_source</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>true</code></dt>
<dd>
<p>(Boolean)
The entire document source is returned.</p>
</dd>
<dt class="hdlist1"><code>false</code></dt>
<dd>
<p>(Boolean)
The document source is not returned.</p>
</dd>
<dt class="hdlist1"><code>&lt;string&gt;</code></dt>
<dd>
<p>(string)
Comma-separated list of source fields to return.
Wildcard (<code>*</code>) patterns are supported.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt class="hdlist1"><code>_source_excludes</code></dt>
<dd>
<p>(Optional, string)
A comma-separated list of <a href="mapping-fields.html#mapping-source-field">source fields</a> to exclude from
the response.</p>
<div class="paragraph">
<p>You can also use this parameter to exclude fields from the subset specified in
<code>_source_includes</code> query parameter.</p>
</div>
<div class="paragraph">
<p>If the <code>_source</code> parameter is <code>false</code>, this parameter is ignored.</p>
</div>
</dd>
<dt class="hdlist1"><code>_source_includes</code></dt>
<dd>
<p>(Optional, string)
A comma-separated list of <a href="mapping-fields.html#mapping-source-field">source fields</a> to
include in the response.</p>
<div class="paragraph">
<p>If this parameter is specified, only these source fields are returned. You can
exclude fields from this subset using the <code>_source_excludes</code> query parameter.</p>
</div>
<div class="paragraph">
<p>If the <code>_source</code> parameter is <code>false</code>, this parameter is ignored.</p>
</div>
</dd>
<dt class="hdlist1"><code>stats</code></dt>
<dd>
<p>(Optional, string) Specific <code>tag</code> of the request for logging and statistical
purposes.</p>
</dd>
<dt class="hdlist1"><code>stored_fields</code></dt>
<dd>
<p>(Optional, string) A comma-separated list of stored fields to return as part
of a hit. If no fields are specified, no stored fields are included in the
response.</p>
<div class="paragraph">
<p>If this field is specified, the <code>_source</code> parameter defaults to <code>false</code>. You can
pass <code>_source: true</code> to return both source fields and
stored fields in the search response.</p>
</div>
</dd>
<dt class="hdlist1"><code>suggest_field</code></dt>
<dd>
<p>(Optional, string) Specifies which field to use for suggestions.</p>
</dd>
<dt class="hdlist1"><code>suggest_text</code></dt>
<dd>
<p>(Optional, string) The source text for which the suggestions should be
returned.</p>
</dd>
<dt class="hdlist1"><code>terminate_after</code></dt>
<dd>
<p>(Optional, integer) The maximum number of documents to collect for each shard,
upon reaching which the query execution will terminate early.</p>
<div class="paragraph">
<p>Defaults to <code>0</code>, which does not terminate query execution early.</p>
</div>
</dd>
<dt class="hdlist1"><code>timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait
for a response. If no response is received before the timeout expires, the
request fails and returns an error. Defaults to no timeout.</p>
</dd>
<dt class="hdlist1"><code>track_scores</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, calculate and return document scores, even if
the scores are not used for sorting. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>track_total_hits</code></dt>
<dd>
<p>(Optional, integer or Boolean)
Number of hits matching the query to count accurately. Defaults to <code>10000</code>.</p>
<div class="paragraph">
<p>If <code>true</code>, the exact number of hits is returned at the cost of some performance.
If <code>false</code>, the response does not include the total number of hits matching the query.</p>
</div>
</dd>
<dt class="hdlist1"><code>typed_keys</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, aggregation and suggester names are be prefixed
by their respective types in the response. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>version</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, returns document version as part of a hit. Defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="search-search-api-request-body">Request body</h4>
<div id="search-docvalue-fields-param" class="dlist">
<dl>
<dt class="hdlist1"><code>docvalue_fields</code></dt>
<dd>
<p>(Optional, array of strings and objects)
Array of wildcard (<code>*</code>) patterns. The request returns doc values for field names
matching these patterns in the <code>hits.fields</code> property of the response.</p>
<div class="paragraph">
<p>You can specify items in the array as a string or object.
See <a href="search-fields.html#docvalue-fields">Doc value fields</a>.</p>
</div>
<details open>
<summary class="title">Properties of <code>docvalue_fields</code> objects</summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>field</code></dt>
<dd>
<p>(Required, string)
Wildcard pattern. The request returns doc values for field names matching this
pattern.</p>
</dd>
<dt class="hdlist1"><code>format</code></dt>
<dd>
<p>(Optional, string)
Format in which the doc values are returned.</p>
<div class="paragraph">
<p>For <a href="mapping-types.html#date">date fields</a>, you can specify a  date <a href="mapping-params.html#mapping-date-format">date
<code>format</code></a>. For <a href="mapping-types.html#number">numeric fields</a> fields, you can specify a
<a href="https://docs.oracle.com/javase/8/docs/api/java/text/DecimalFormat.html">DecimalFormat
pattern</a>.</p>
</div>
<div class="paragraph">
<p>For other field data types, this parameter is not supported.</p>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt class="hdlist1"><code>fields</code></dt>
<dd>
<p>(Optional, array of strings and objects)
Array of wildcard (<code>*</code>) patterns. The request returns values for field names
matching these patterns in the <code>hits.fields</code> property of the response.</p>
<div class="paragraph">
<p>You can specify items in the array as a string or object.
See <a href="search-fields.html#search-fields-param">Fields</a> for more details.</p>
</div>
<details open>
<summary class="title">Properties of <code>fields</code> objects</summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>field</code></dt>
<dd>
<p>(Required, string)
Wildcard pattern. The request returns values for field names matching this pattern.</p>
</dd>
<dt class="hdlist1"><code>format</code></dt>
<dd>
<p>(Optional, string)
Format in which the values are returned.</p>
<div class="paragraph">
<p>The date fields <a href="mapping-types.html#date"><code>date</code></a> and <a href="mapping-types.html#date_nanos"><code>date_nanos</code></a> accept a
<a href="mapping-params.html#mapping-date-format">date format</a>. <a href="mapping-types.html#spatial_datatypes">Spatial fields</a> accept either
<code>geojson</code> for <a href="http://www.geojson.org">GeoJSON</a> (the default) or <code>wkt</code> for
<a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry">Well Known Text</a>.</p>
</div>
<div class="paragraph">
<p>For other field data types, this parameter is not supported.</p>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div id="request-body-search-explain" class="dlist">
<dl>
<dt class="hdlist1"><code>explain</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, returns detailed information about score
computation as part of a hit. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>from</code></dt>
<dd>
<p>(Optional, integer) Starting document offset. Defaults to <code>0</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>By default, you cannot page through more than 10,000 documents using the <code>from</code>
and <code>size</code> parameters. This limit is set using the
<a href="index-modules.html#index-max-result-window"><code>index.max_result_window</code></a> index setting.</p>
</div>
<div class="paragraph">
<p>Deep paging or requesting many results at once can result in slow searches.
Results are sorted before being returned. Because search requests usually span
multiple shards, each shard must generate its own sorted results. These separate
results must then be combined and sorted to ensure that the overall order is
correct.</p>
</div>
<div class="paragraph">
<p>As an alternative to deep paging, we recommend using
<a href="paginate-search-results.html#scroll-search-results">scroll</a> or the
<a href="paginate-search-results.html#search-after"><code>search_after</code></a> parameter.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>indices_boost</code></dt>
<dd>
<p>(Optional, array of objects)
Boosts the <a href="query-filter-context.html#relevance-scores"><code>_score</code></a> of documents from specified indices.</p>
<details open>
<summary class="title">Properties of <code>indices_boost</code> objects</summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;index&gt;: &lt;boost-value&gt;</code></dt>
<dd>
<p>(Required, float)
<code>&lt;index&gt;</code> is the name of the index or index alias. Wildcard (<code>*</code>) expressions
are supported.</p>
<div class="paragraph">
<p><code>&lt;boost-value&gt;</code> is the factor by which scores are multiplied.</p>
</div>
<div class="paragraph">
<p>A boost value greater than <code>1.0</code> increases the score. A boost value between
<code>0</code> and <code>1.0</code> decreases the score.</p>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div id="search-api-min-score" class="dlist">
<dl>
<dt class="hdlist1"><code>min_score</code></dt>
<dd>
<p>(Optional, float)
Minimum <a href="query-filter-context.html#relevance-scores"><code>_score</code></a> for matching documents. Documents with a
lower <code>_score</code> are not included in the search results.</p>
</dd>
</dl>
</div>
<div id="request-body-search-query" class="dlist">
<dl>
<dt class="hdlist1"><code>query</code></dt>
<dd>
<p>(Optional, <a href="query-dsl.html">query object</a>) Defines the search definition using the
<a href="query-dsl.html">Query DSL</a>.</p>
</dd>
</dl>
</div>
<div id="request-body-search-seq-no-primary-term" class="dlist">
<dl>
<dt class="hdlist1"><code>seq_no_primary_term</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, returns sequence number and primary term of the
last modification of each hit. See <a href="docs.html#optimistic-concurrency-control">Optimistic concurrency control</a>.</p>
</dd>
<dt class="hdlist1"><code>size</code></dt>
<dd>
<p>(Optional, integer) The number of hits to return. Defaults to <code>10</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>By default, you cannot page through more than 10,000 documents using the <code>from</code>
and <code>size</code> parameters. This limit is set using the
<a href="index-modules.html#index-max-result-window"><code>index.max_result_window</code></a> index setting.</p>
</div>
<div class="paragraph">
<p>Deep paging or requesting many results at once can result in slow searches.
Results are sorted before being returned. Because search requests usually span
multiple shards, each shard must generate its own sorted results. These separate
results must then be combined and sorted to ensure that the overall order is
correct.</p>
</div>
<div class="paragraph">
<p>As an alternative to deep paging, we recommend using
<a href="paginate-search-results.html#scroll-search-results">scroll</a> or the
<a href="paginate-search-results.html#search-after"><code>search_after</code></a> parameter.</p>
</div>
<div class="paragraph">
<p>If the <a href="search.html#search-api-scroll-query-param"><code>scroll</code> parameter</a> is specified, this
value cannot be <code>0</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>_source</code></dt>
<dd>
<p>(Optional)
Indicates which <a href="mapping-fields.html#mapping-source-field">source fields</a> are returned for matching
documents. These fields are returned in the <code>hits._source</code> property of
the search response. Defaults to <code>true</code>.</p>
<details open>
<summary class="title">Valid values for <code>_source</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>true</code></dt>
<dd>
<p>(Boolean)
The entire document source is returned.</p>
</dd>
<dt class="hdlist1"><code>false</code></dt>
<dd>
<p>(Boolean)
The document source is not returned.</p>
</dd>
<dt class="hdlist1"><code>&lt;wildcard_pattern&gt;</code></dt>
<dd>
<p>(string or array of strings)
Wildcard (<code>*</code>) pattern or array of patterns containing source fields to return.</p>
</dd>
<dt class="hdlist1"><code>&lt;object&gt;</code></dt>
<dd>
<p>(object)
Object containing a list of source fields to include or exclude.</p>
<details open>
<summary class="title">Properties for <code>&lt;object&gt;</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>excludes</code></dt>
<dd>
<p>(string or array of strings)
Wildcard (<code>*</code>) pattern or array of patterns containing source fields to exclude
from the response.</p>
<div class="paragraph">
<p>You can also use this property to exclude fields from the subset specified in
<code>includes</code> property.</p>
</div>
</dd>
<dt class="hdlist1"><code>includes</code></dt>
<dd>
<p>(string or array of strings)
Wildcard (<code>*</code>) pattern or array of patterns containing source fields to return.</p>
<div class="paragraph">
<p>If this property is specified, only these source fields are returned. You can
exclude fields from this subset using the <code>excludes</code> property.</p>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div id="stats-groups" class="dlist">
<dl>
<dt class="hdlist1"><code>stats</code></dt>
<dd>
<p>(Optional, array of strings)
Stats groups to associate with the search. Each group maintains a statistics
aggregation for its associated searches. You can retrieve these stats using the
<a href="indices.html#indices-stats">indices stats API</a>.</p>
</dd>
<dt class="hdlist1"><code>terminate_after</code></dt>
<dd>
<p>(Optional, integer) The maximum number of documents to collect for each shard,
upon reaching which the query execution will terminate early.</p>
<div class="paragraph">
<p>Defaults to <code>0</code>, which does not terminate query execution early.</p>
</div>
</dd>
<dt class="hdlist1"><code>timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait
for a response. If no response is received before the timeout expires, the
request fails and returns an error. Defaults to no timeout.</p>
</dd>
</dl>
</div>
<div id="request-body-search-version" class="dlist">
<dl>
<dt class="hdlist1"><code>version</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, returns document version as part of a hit. Defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="search-api-response-body">Response body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>_scroll_id</code></dt>
<dd>
<p>(string)
Identifier for the search and its <a href="paginate-search-results.html#scroll-search-context">search context</a>.</p>
<div class="paragraph">
<p>You can use this scroll ID with the <a href="search.html#scroll-api">scroll API</a> to retrieve the
next batch of search results for the request. See
<a href="paginate-search-results.html#scroll-search-results">Scroll search results</a>.</p>
</div>
<div class="paragraph">
<p>This parameter is only returned if the <a href="search.html#search-api-scroll-query-param"><code>scroll</code>
query parameter</a> is specified in the request.</p>
</div>
</dd>
<dt class="hdlist1"><code>took</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(integer)
Milliseconds it took OpenSearch to execute the request.</p>
</div>
<div class="paragraph">
<p>This value is calculated by measuring the time elapsed
between receipt of a request on the coordinating node
and the time at which the coordinating node is ready to send the response.</p>
</div>
<div class="paragraph">
<p>Took time includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Communication time between the coordinating node and data nodes</p>
</li>
<li>
<p>Time the request spends in the <code>search</code> <a href="settings.html#modules-threadpool">thread pool</a>,
queued for execution</p>
</li>
<li>
<p>Actual execution time</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Took time does <strong>not</strong> include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Time needed to send the request to OpenSearch</p>
</li>
<li>
<p>Time needed to serialize the JSON response</p>
</li>
<li>
<p>Time needed to send the response to a client</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>timed_out</code></dt>
<dd>
<p>(Boolean)
If <code>true</code>,
the request timed out before completion;
returned results may be partial or empty.</p>
</dd>
<dt class="hdlist1"><code>_shards</code></dt>
<dd>
<p>(object)
Contains a count of shards used for the request.</p>
<details open>
<summary class="title">Properties of <code>_shards</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>total</code></dt>
<dd>
<p>(integer)
Total number of shards that require querying,
including unallocated shards.</p>
</dd>
<dt class="hdlist1"><code>successful</code></dt>
<dd>
<p>(integer)
Number of shards that executed the request successfully.</p>
</dd>
<dt class="hdlist1"><code>skipped</code></dt>
<dd>
<p>(integer)
Number of shards that skipped the request because a lightweight check
helped realize that no documents could possibly match on this shard. This
typically happens when a search request includes a range filter and the
shard only has values that fall outside of that range.</p>
</dd>
<dt class="hdlist1"><code>failed</code></dt>
<dd>
<p>(integer)
Number of shards that failed to execute the request. Note that shards
that are not allocated will be considered neither successful nor failed.
Having <code>failed+successful</code> less than <code>total</code> is thus an indication that
some of the shards were not allocated.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt class="hdlist1"><code>hits</code></dt>
<dd>
<p>(object)
Contains returned documents and metadata.</p>
<details open>
<summary class="title">Properties of <code>hits</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>total</code></dt>
<dd>
<p>(object)
Metadata about the number of returned documents.</p>
<details open>
<summary class="title">Properties of <code>total</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>value</code></dt>
<dd>
<p>(integer)
Total number of returned documents.</p>
</dd>
<dt class="hdlist1"><code>relation</code></dt>
<dd>
<p>(string)
Indicates whether the number of returned documents in the <code>value</code>
parameter is accurate or a lower bound.</p>
<details open>
<summary class="title">Values of <code>relation</code>:</summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>eq</code></dt>
<dd>
<p>Accurate</p>
</dd>
<dt class="hdlist1"><code>gte</code></dt>
<dd>
<p>Lower bound, including returned documents</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt class="hdlist1"><code>max_score</code></dt>
<dd>
<p>(float)
Highest returned <a href="search.html#search-api-response-body-score">document <code>_score</code></a>.</p>
<div class="paragraph">
<p>This value is <code>null</code> for requests that do not sort by <code>_score</code>.</p>
</div>
</dd>
</dl>
</div>
<div id="search-api-response-body-hits" class="dlist">
<dl>
<dt class="hdlist1"><code>hits</code></dt>
<dd>
<p>(array of objects)
Array of returned document objects.</p>
<details open>
<summary class="title">Properties of <code>hits</code> objects</summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>_index</code></dt>
<dd>
<p>(string)
Name of the index containing the returned document.</p>
</dd>
<dt class="hdlist1"><code>_type</code></dt>
<dd>
<p>(string)
Mapping type of the returned document. Types are deprecated.</p>
</dd>
<dt class="hdlist1"><code>_id</code></dt>
<dd>
<p>(string)
Unique identifier for the returned document.
This ID is only unique within the returned index.</p>
</dd>
</dl>
</div>
<div id="search-api-response-body-score" class="dlist">
<dl>
<dt class="hdlist1"><code>_score</code></dt>
<dd>
<p>(float)
Positive 32-bit floating point number used to determine the relevance of the
returned document.</p>
</dd>
</dl>
</div>
<div id="search-api-response-body-source" class="dlist">
<dl>
<dt class="hdlist1"><code>_source</code></dt>
<dd>
<p>(object)
Original JSON body passed for the document at index time.</p>
<div class="paragraph">
<p>You can use the <code>_source</code> parameter to exclude this property from the response
or specify which source fields to return.</p>
</div>
</dd>
<dt class="hdlist1"><code>fields</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(object)
Contains field values for the documents. These fields must be specified in the
request using one or more of the following request parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="search.html#search-docvalue-fields-param"><code>docvalue_fields</code></a></p>
</li>
<li>
<p><a href="search-fields.html#script-fields"><code>script_fields</code></a></p>
</li>
<li>
<p><a href="search-fields.html#stored-fields"><code>stored_fields</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This property is returned only if one or more of these parameters are set.</p>
</div>
</div>
</div>
<details open>
<summary class="title">Properties of <code>fields</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;field&gt;</code></dt>
<dd>
<p>(array)
Key is the field name. Value is the value for the field.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-search-api-example">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_search
{
  "query": {
    "term": {
      "user.id": "bilbo"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "took": 5,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1.3862942,
    "hits": [
      {
        "_index": "my-index-000001",
        "_type" : "_doc",
        "_id": "0",
        "_score": 1.3862942,
        "_source": {
          "@timestamp": "2099-11-15T14:12:12",
          "http": {
            "request": {
              "method": "get"
            },
            "response": {
              "status_code": 200,
              "bytes": 1070000
            },
            "version": "1.1"
          },
          "source": {
            "ip": "127.0.0.1"
          },
          "message": "GET /search HTTP/1.1 200 1070000",
          "user": {
            "id": "bilbo"
          }
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scroll-api">Scroll API</h3>
<titleabbrev>Scroll</titleabbrev>
<div class="paragraph">
<p>Retrieves the next batch of results for a <a href="paginate-search-results.html#scroll-search-results">scrolling
search</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search/scroll
{
  "scroll_id" : "DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAD4WYm9laVYtZndUQlNsdDcwakFMNjU1QQ=="
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="scroll-api-request">Request</h4>
<div class="paragraph">
<p>Deprecated.
<code>GET /_search/scroll/&lt;scroll_id&gt;</code></p>
</div>
<div class="paragraph">
<p><code>GET /_search/scroll</code></p>
</div>
<div class="paragraph">
<p>Deprecated.
<code>POST /_search/scroll/&lt;scroll_id&gt;</code></p>
</div>
<div class="paragraph">
<p><code>POST /_search/scroll</code></p>
</div>
</div>
<div class="sect3">
<h4 id="scroll-api-desc">Description</h4>
<div class="paragraph">
<p>You can use the scroll API to retrieve large sets of results from a single
<a href="paginate-search-results.html#scroll-search-results">scrolling search</a> request.</p>
</div>
<div class="paragraph">
<p>The scroll API requires a scroll ID. To get a scroll ID, submit a
<a href="search.html#search-search">search API</a> request that includes an argument for the
<a href="search.html#search-api-scroll-query-param"><code>scroll</code> query parameter</a>. The <code>scroll</code>
parameter indicates how long OpenSearch should retain the
<a href="paginate-search-results.html#scroll-search-context">search context</a> for the request.</p>
</div>
<div class="paragraph">
<p>The search response returns a scroll ID in the <code>_scroll_id</code> response body
parameter. You can then use the scroll ID with the scroll API to retrieve the
next batch of results for the request.</p>
</div>
<div class="paragraph">
<p>You can also use the scroll API to specify a new <code>scroll</code> parameter that extends
or shortens the retention period for the search context.</p>
</div>
<div class="paragraph">
<p>See <a href="paginate-search-results.html#scroll-search-results">Scroll search results</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Results from a scrolling search reflect the state of the index at the
time of the initial search request. Subsequent indexing or document changes only
affect later search and scroll requests.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="scroll-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;scroll_id&gt;</code></dt>
<dd>
<p>(Optional, string)
Deprecated. Scroll ID of the search.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Scroll IDs can be long. We recommend only specifying scroll IDs using
the <a href="search.html#scroll-api-scroll-id-param"><code>scroll_id</code> request body parameter</a>.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="scroll-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>scroll</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time value</a>)
Period to retain the <a href="paginate-search-results.html#scroll-search-context">search context</a> for scrolling. See
<a href="paginate-search-results.html#scroll-search-results">Scroll search results</a>.</p>
<div class="paragraph">
<p>This value overrides the duration set by the original search API request&#8217;s
<code>scroll</code> parameter.</p>
</div>
<div class="paragraph">
<p>By default, this value cannot exceed <code>1d</code> (24 hours). You can change
this limit using the <code>search.max_keep_alive</code> cluster-level setting.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
You can also specify this value using the <code>scroll</code> request body
parameter. If both parameters are specified, only the query parameter is used.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>scroll_id</code></dt>
<dd>
<p>(Optional, string)
Deprecated. Scroll ID for the search.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Scroll IDs can be long. We recommend only specifying scroll IDs using
the <a href="search.html#scroll-api-scroll-id-param"><code>scroll_id</code> request body parameter</a>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>rest_total_hits_as_int</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, the API response&#8217;s <code>hit.total</code> property is returned as an integer.
If <code>false</code>, the API response&#8217;s <code>hit.total</code> property is returned as an object.
Defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="scroll-api-request-body">Request body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>scroll</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time value</a>)
Period to retain the <a href="paginate-search-results.html#scroll-search-context">search context</a> for scrolling. See
<a href="paginate-search-results.html#scroll-search-results">Scroll search results</a>.</p>
<div class="paragraph">
<p>This value overrides the duration set by the original search API request&#8217;s
<code>scroll</code> parameter.</p>
</div>
<div class="paragraph">
<p>By default, this value cannot exceed <code>1d</code> (24 hours). You can change
this limit using the <code>search.max_keep_alive</code> cluster-level setting.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
You can also specify this value using the <code>scroll</code> query
parameter. If both parameters are specified, only the query parameter is used.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div id="scroll-api-scroll-id-param" class="dlist">
<dl>
<dt class="hdlist1"><code>scroll_id</code></dt>
<dd>
<p>(Required, string)
Scroll ID for the search.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="scroll-api-response-body">Response body</h4>
<div class="paragraph">
<p>The scroll API returns the same response body as the search API. See the search
API&#8217;s <a href="search.html#search-api-response-body">response body parameters</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clear-scroll-api">Clear scroll API</h3>
<titleabbrev>Clear scroll</titleabbrev>
<div class="paragraph">
<p>Clears the search context and results for a
<a href="paginate-search-results.html#scroll-search-results">scrolling search</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">DELETE /_search/scroll
{
  "scroll_id" : "DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAD4WYm9laVYtZndUQlNsdDcwakFMNjU1QQ=="
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="clear-scroll-api-request">Request</h4>
<div class="paragraph">
<p><code>DELETE /_search/scroll/&lt;scroll_id&gt;</code></p>
</div>
<div class="paragraph">
<p><code>DELETE /_search/scroll</code></p>
</div>
</div>
<div class="sect3">
<h4 id="clear-scroll-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;scroll_id&gt;</code></dt>
<dd>
<p>(Optional, string)
Deprecated. Comma-separated list of scroll IDs to clear. To clear all scroll IDs, use <code>_all</code>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Scroll IDs can be long. We recommend only specifying
scroll IDs using the <a href="search.html#clear-scroll-api-scroll-id-param"><code>scroll_id</code> request body
parameter</a>.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="clear-scroll-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>scroll_id</code></dt>
<dd>
<p>(Optional, string)
Deprecated. Comma-separated list of scroll IDs to clear. To clear all scroll IDs, use <code>_all</code>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Scroll IDs can be long. We recommend only specifying
scroll IDs using the <a href="search.html#clear-scroll-api-scroll-id-param"><code>scroll_id</code> request body
parameter</a>.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="clear-scroll-api-request-body">Request body</h4>
<div id="clear-scroll-api-scroll-id-param" class="dlist">
<dl>
<dt class="hdlist1"><code>scroll_id</code></dt>
<dd>
<p>(Required, string or array of strings)
Scroll IDs to clear. To clear all scroll IDs, use <code>_all</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="clear-scroll-api-response-body">Response body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>succeeded</code></dt>
<dd>
<p>(Boolean)
If <code>true</code>, the request succeeded. This does not indicate whether any scrolling
search requests were cleared.</p>
</dd>
<dt class="hdlist1"><code>num_freed</code></dt>
<dd>
<p>(integer)
Number of scrolling search requests cleared.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-template">Search Template</h3>
<div class="paragraph">
<p>Allows you to use the mustache language to pre render search requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _search/template
{
  "source" : {
    "query": { "match" : { "{{my_field}}" : "{{my_value}}" } },
    "size" : "{{my_size}}"
  },
  "params" : {
    "my_field" : "message",
    "my_value" : "foo",
    "my_size" : 5
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="search-template-api-request">Request</h4>
<div class="paragraph">
<p><code>GET _search/template</code></p>
</div>
</div>
<div class="sect3">
<h4 id="search-template-api-desc">Description</h4>
<div class="paragraph">
<p>The <code>/_search/template</code> endpoint allows you to use the mustache language to pre-
render search requests, before they are executed and fill existing templates
with template parameters.</p>
</div>
<div class="paragraph">
<p>For more information on how Mustache templating and what kind of templating you
can do with it check out the <a href="https://mustache.github.io/mustache.5.html">online
documentation of the mustache project</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The mustache language is implemented in OpenSearch as a sandboxed scripting
language, hence it obeys settings that may be used to enable or disable scripts
per type and context as described in the
<a href="modules-scripting-security.html#allowed-script-types-setting">scripting docs</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="search-template-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;index&gt;</code></dt>
<dd>
<p>(Optional, string) Comma-separated list or wildcard expression of index names
used to limit the request.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-template-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>allow_no_indices</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error if any wildcard expression,
<a href="indices.html#indices-aliases">index alias</a>, or <code>_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code>foo*,bar*</code> returns an error if an index
starts with <code>foo</code> but no index starts with <code>bar</code>.</p>
<div class="paragraph">
<p>Defaults to <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>ccs_minimize_roundtrips</code></dt>
<dd>
<p> (Optional, Boolean) If <code>true</code>, network round-trips are minimized for
cross-cluster search requests. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>expand_wildcards</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code>open,hidden</code>. Valid values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>Expand to open and closed indices, including <a href="api-conventions.html#hidden-indices">hidden indices</a>.</p>
</dd>
<dt class="hdlist1"><code>open</code></dt>
<dd>
<p>Expand only to open indices.</p>
</dd>
<dt class="hdlist1"><code>closed</code></dt>
<dd>
<p>Expand only to closed indices.</p>
</dd>
<dt class="hdlist1"><code>hidden</code></dt>
<dd>
<p>Expansion of wildcards will include hidden indices.
Must be combined with <code>open</code>, <code>closed</code>, or both.</p>
</dd>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>Wildcard expressions are not accepted.</p>
</dd>
</dl>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>explain</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, the response includes additional details about
score computation as part of a hit. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>ignore_throttled</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, specified concrete, expanded or aliased indices
are not included in the response when throttled. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, missing or closed indices are not included in the
response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>preference</code></dt>
<dd>
<p>(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.</p>
</dd>
<dt class="hdlist1"><code>profile</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, the query execution is profiled. Defaults
to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>rest_total_hits_as_int</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, <code>hits.total</code> are rendered as an integer in
the response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>routing</code></dt>
<dd>
<p>(Optional, string) Target the specified primary shard.</p>
</dd>
<dt class="hdlist1"><code>scroll</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies how long a consistent view of
the index should be maintained for scrolled search.</p>
</dd>
<dt class="hdlist1"><code>search_type</code></dt>
<dd>
<p>(Optional, string) The type of the search operation. Available options:</p>
<div class="ulist">
<ul>
<li>
<p><code>query_then_fetch</code></p>
</li>
<li>
<p><code>dfs_query_then_fetch</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>typed_keys</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, aggregation and suggester names are
prefixed by their respective types in the response. Defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-template-api-request-body">Request body</h4>
<div class="paragraph">
<p>The API request body must contain the search definition template and its parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-template-api-example">Response codes</h4>
<div class="sect4">
<h5 id="pre-registered-templates">Store a search template</h5>
<div class="paragraph">
<p>You can store a search template using the stored scripts API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST _scripts/&lt;templateid&gt;
{
  "script": {
    "lang": "mustache",
    "source": {
      "query": {
        "match": {
          "title": "{{query_string}}"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The template can be retrieved by calling</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _scripts/&lt;templateid&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "script" : {
    "lang" : "mustache",
    "source" : """{"query":{"match":{"title":"{{query_string}}"}}}""",
    "options": {
      "content_type" : "application/json; charset=UTF-8"
    }
  },
  "_id": "&lt;templateid&gt;",
  "found": true
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This template can be deleted by calling</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">DELETE _scripts/&lt;templateid&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use-registered-templates">Using a stored search template</h5>
<div class="paragraph">
<p>To use a stored template at search time send the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _search/template
{
  "id": "&lt;templateid&gt;", <b class="conum">(1)</b>
  "params": {
    "query_string": "search for these words"
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Name of the stored template script.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validating_templates">Validating a search template</h4>
<div class="paragraph">
<p>A template can be rendered in a response with given parameters by using the
following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _render/template
{
  "source": "{ \"query\": { \"terms\": {{#toJson}}statuses{{/toJson}} }}",
  "params": {
    "statuses" : {
        "status": [ "pending", "published" ]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the rendered template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "template_output": {
    "query": {
      "terms": {
        "status": [ <b class="conum">(1)</b>
          "pending",
          "published"
        ]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>status</code> array has been populated with values from the <code>params</code> object.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Stored templates can also be rendered by calling the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">GET _render/template/&lt;template_name&gt;
{
  "params": {
    "..."
  }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="search-template-explain-parameter">Using the explain parameter</h5>
<div class="paragraph">
<p>You can use the <code>explain</code> parameter when running a template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _search/template
{
  "id": "my_template",
  "params": {
    "status": [ "pending", "published" ]
  },
  "explain": true
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="search-template-profile-parameter">Profiling</h5>
<div class="paragraph">
<p>You can use the <code>profile</code> parameter when running a template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _search/template
{
  "id": "my_template",
  "params": {
    "status": [ "pending", "published" ]
  },
  "profile": true
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="search-template-query-string-single">Filling in a query string with a single value</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _search/template
{
  "source": {
    "query": {
      "term": {
        "message": "{{query_string}}"
      }
    }
  },
  "params": {
    "query_string": "search for these words"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="search-template-converting-to-json">Converting parameters to JSON</h5>
<div class="paragraph">
<p>The <code>{{#toJson}}parameter{{/toJson}}</code> function can be used to convert parameters
like maps and array to their JSON representation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _search/template
{
  "source": "{ \"query\": { \"terms\": {{#toJson}}statuses{{/toJson}} }}",
  "params": {
    "statuses" : {
        "status": [ "pending", "published" ]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is rendered as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "query": {
    "terms": {
      "status": [
        "pending",
        "published"
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A more complex example substitutes an array of JSON objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _search/template
{
  "source": "{\"query\":{\"bool\":{\"must\": {{#toJson}}clauses{{/toJson}} }}}",
  "params": {
    "clauses": [
      { "term": { "user" : "foo" } },
      { "term": { "user" : "bar" } }
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is rendered as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "user": "foo"
          }
        },
        {
          "term": {
            "user": "bar"
          }
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="search-template-concatenate-array">Concatenating array of values</h5>
<div class="paragraph">
<p>The <code>{{#join}}array{{/join}}</code> function can be used to concatenate the
values of an array as a comma delimited string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _search/template
{
  "source": {
    "query": {
      "match": {
        "emails": "{{#join}}emails{{/join}}"
      }
    }
  },
  "params": {
    "emails": [ "username@email.com", "lastname@email.com" ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is rendered as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "query" : {
    "match" : {
      "emails" : "username@email.com,lastname@email.com"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function also accepts a custom delimiter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _search/template
{
  "source": {
    "query": {
      "range": {
        "born": {
            "gte"   : "{{date.min}}",
            "lte"   : "{{date.max}}",
            "format": "{{#join delimiter='||'}}date.formats{{/join delimiter='||'}}"
	    }
      }
    }
  },
  "params": {
    "date": {
        "min": "2016",
        "max": "31/12/2017",
        "formats": ["dd/MM/yyyy", "yyyy"]
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is rendered as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "query": {
    "range": {
      "born": {
        "gte": "2016",
        "lte": "31/12/2017",
        "format": "dd/MM/yyyy||yyyy"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="search-template-default-values">Default values</h5>
<div class="paragraph">
<p>A default value is written as <code>{{var}}{{^var}}default{{/var}}</code> for instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "source": {
    "query": {
      "range": {
        "line_no": {
          "gte": "{{start}}",
          "lte": "{{end}}{{^end}}20{{/end}}"
        }
      }
    }
  },
  "params": { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>params</code> is <code>{ "start": 10, "end": 15 }</code> this query would be rendered as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "range": {
    "line_no": {
      "gte": "10",
      "lte": "15"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But when <code>params</code> is <code>{ "start": 10 }</code> this query would use the default value
for <code>end</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "range": {
    "line_no": {
      "gte": "10",
      "lte": "20"
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="search-template-conditional-clauses">Conditional clauses</h5>
<div class="paragraph">
<p>Conditional clauses cannot be expressed using the JSON form of the template.
Instead, the template <strong>must</strong> be passed as a string.  For instance, let&#8217;s say
we wanted to run a <code>match</code> query on the <code>line</code> field, and optionally wanted
to filter by line numbers, where <code>start</code> and <code>end</code> are optional.</p>
</div>
<div class="paragraph">
<p>The <code>params</code> would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "params": {
    "text": "words to search for",
    "line_no": {                      <b class="conum">(1)</b>
      "start": 10,
      "end": 20
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>line_no</code>, <code>start</code>, and <code>end</code> parameters are optional.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When written as a query, the template would include invalid JSON, such as
section markers like <code>{{#line_no}}</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "query": {
    "bool": {
      "must": {
        "match": {
          "line": "{{text}}" <b class="conum">(1)</b>
        }
      },
      "filter": {
        {{#line_no}} <b class="conum">(2)</b>
          "range": {
            "line_no": {
              {{#start}} <b class="conum">(3)</b>
                "gte": "{{start}}" <b class="conum">(4)</b>
                {{#end}},{{/end}} <b class="conum">(5)</b>
              {{/start}}
              {{#end}} <b class="conum">(6)</b>
                "lte": "{{end}}" <b class="conum">(7)</b>
              {{/end}}
            }
          }
        {{/line_no}}
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Fill in the value of param <code>text</code></p>
</li>
<li>
<p>Include the <code>range</code> filter only if <code>line_no</code> is specified</p>
</li>
<li>
<p>Include the <code>gte</code> clause only if <code>line_no.start</code> is specified</p>
</li>
<li>
<p>Fill in the value of param <code>line_no.start</code></p>
</li>
<li>
<p>Add a comma after the <code>gte</code> clause only if <code>line_no.start</code>
AND <code>line_no.end</code> are specified</p>
</li>
<li>
<p>Include the <code>lte</code> clause only if <code>line_no.end</code> is specified</p>
</li>
<li>
<p>Fill in the value of param <code>line_no.end</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Because search templates cannot include invalid JSON, you can pass the same
query as a string instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"source": "{\"query\":{\"bool\":{\"must\":{\"match\":{\"line\":\"{{text}}\"}},\"filter\":{{{#line_no}}\"range\":{\"line_no\":{{{#start}}\"gte\":\"{{start}}\"{{#end}},{{/end}}{{/start}}{{#end}}\"lte\":\"{{end}}\"{{/end}}}}{{/line_no}}}}}}"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="search-template-encode-urls">Encoding URLs</h5>
<div class="paragraph">
<p>The <code>{{#url}}value{{/url}}</code> function can be used to encode a string value
in a HTML encoding form as defined in by the
<a href="https://www.w3.org/TR/html4/">HTML specification</a>.</p>
</div>
<div class="paragraph">
<p>As an example, it is useful to encode a URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _render/template
{
  "source": {
    "query": {
      "term": {
        "http_access_log": "{{#url}}{{host}}/{{page}}{{/url}}"
      }
    }
  },
  "params": {
    "host": "https://www.opensearch.org/",
    "page": "learn"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous query will be rendered as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "template_output": {
    "query": {
      "term": {
        "http_access_log": "https%3A%2F%2Fwww.opensearch.org%2F%2Flearn"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multi-search-template">Multi Search Template</h3>
<div class="paragraph">
<p>Allows to execute several search template requests.</p>
</div>
<div class="sect3">
<h4 id="multi-search-template-api-request">Request</h4>
<div class="paragraph">
<p><code>GET _msearch/template</code></p>
</div>
</div>
<div class="sect3">
<h4 id="multi-search-template-api-desc">Description</h4>
<div class="paragraph">
<p>Allows to execute several search template requests within the same API using the
<code>_msearch/template</code> endpoint.</p>
</div>
<div class="paragraph">
<p>The format of the request is similar to the <a href="search.html#search-multi-search">Multi
Search API</a> format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">header\n
body\n
header\n
body\n</code></pre>
</div>
</div>
<div class="paragraph">
<p>The header part supports the same <code>index</code>, <code>search_type</code>, <code>preference</code>, and
<code>routing</code> options as the Multi Search API.</p>
</div>
<div class="paragraph">
<p>The body includes a search template body request and supports inline, stored and
file templates.</p>
</div>
</div>
<div class="sect3">
<h4 id="multi-search-template-api-example">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">$ cat requests
{"index": "test"}
{"source": {"query": {"match":  {"user" : "{{username}}" }}}, "params": {"username": "john"}} <b class="conum">(1)</b>
{"source": {"query": {"{{query_type}}": {"name": "{{name}}" }}}, "params": {"query_type": "match_phrase_prefix", "name": "Smith"}}
{"index": "_all"}
{"id": "template_1", "params": {"query_string": "search for these words" }} <b class="conum">(2)</b>

$ curl -H "Content-Type: application/x-ndjson" -XGET localhost:9200/_msearch/template --data-binary "@requests"; echo</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Inline search template request</p>
</li>
<li>
<p>Search template request based on a stored template</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The response returns a <code>responses</code> array, which includes the search template
response for each search template request matching its order in the original
multi search template request. If there was a complete failure for that specific
search template request, an object with <code>error</code> message will be returned in
place of the actual search response.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-shards">Search Shards API</h3>
<div class="paragraph">
<p>Returns the indices and shards that a search request would be executed against.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_search_shards</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="search-shards-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /&lt;index&gt;/_search_shards</code></p>
</div>
</div>
<div class="sect3">
<h4 id="search-shards-api-desc">Description</h4>
<div class="paragraph">
<p>The search shards api returns the indices and shards that a search request would
be executed against. This can give useful feedback for working out issues or
planning optimizations with routing and shard preferences. When filtered aliases
are used, the filter is returned as part of the <code>indices</code> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-shards-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;index&gt;</code></dt>
<dd>
<p>(Optional, string) Comma-separated list or wildcard expression of index names
used to limit the request.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-shards-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>allow_no_indices</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error if any wildcard expression,
<a href="indices.html#indices-aliases">index alias</a>, or <code>_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code>foo*,bar*</code> returns an error if an index
starts with <code>foo</code> but no index starts with <code>bar</code>.</p>
<div class="paragraph">
<p>Defaults to <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>expand_wildcards</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code>open,hidden</code>. Valid values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>Expand to open and closed indices, including <a href="api-conventions.html#hidden-indices">hidden indices</a>.</p>
</dd>
<dt class="hdlist1"><code>open</code></dt>
<dd>
<p>Expand only to open indices.</p>
</dd>
<dt class="hdlist1"><code>closed</code></dt>
<dd>
<p>Expand only to closed indices.</p>
</dd>
<dt class="hdlist1"><code>hidden</code></dt>
<dd>
<p>Expansion of wildcards will include hidden indices.
Must be combined with <code>open</code>, <code>closed</code>, or both.</p>
</dd>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>Wildcard expressions are not accepted.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Defaults to <code>open</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, missing or closed indices are not included in the
response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>local</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, the request retrieves information from the local
node only. Defaults to <code>false</code>, which means information is retrieved from
the master node.</p>
</dd>
<dt class="hdlist1"><code>preference</code></dt>
<dd>
<p>(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.</p>
</dd>
<dt class="hdlist1"><code>routing</code></dt>
<dd>
<p>(Optional, string) Target the specified primary shard.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-shards-api-example">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_search_shards</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "nodes": ...,
  "indices" : {
    "my-index-000001": { }
  },
  "shards": [
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 0,
        "state": "STARTED",
        "allocation_id": {"id":"0TvkCyF7TAmM1wHP4a42-A"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 1,
        "state": "STARTED",
        "allocation_id": {"id":"fMju3hd1QHWmWrIgFnI4Ww"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 2,
        "state": "STARTED",
        "allocation_id": {"id":"Nwl0wbMBTHCWjEEbGYGapg"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 3,
        "state": "STARTED",
        "allocation_id": {"id":"bU_KLGJISbW0RejwnwDPKw"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 4,
        "state": "STARTED",
        "allocation_id": {"id":"DMs7_giNSwmdqVukF7UydA"},
        "relocating_node": null
      }
    ]
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying the same request, this time with a routing value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_search_shards?routing=foo,bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "nodes": ...,
  "indices" : {
      "my-index-000001": { }
  },
  "shards": [
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 2,
        "state": "STARTED",
        "allocation_id": {"id":"fMju3hd1QHWmWrIgFnI4Ww"},
        "relocating_node": null
      }
    ],
    [
      {
        "index": "my-index-000001",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "shard": 3,
        "state": "STARTED",
        "allocation_id": {"id":"0TvkCyF7TAmM1wHP4a42-A"},
        "relocating_node": null
      }
    ]
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because of the specified routing values,
the search is only executed against two of the shards.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-suggesters">Suggesters</h3>
<div class="paragraph">
<p>Suggests similar looking terms based on a provided text by using a suggester.
Parts of the suggest feature are still under development.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST my-index-000001/_search
{
  "query" : {
    "match": {
      "message": "tring out OpenSearch"
    }
  },
  "suggest" : {
    "my-suggestion" : {
      "text" : "tring out OpenSearch",
      "term" : {
        "field" : "message"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="search-suggesters-api-request">Request</h4>
<div class="paragraph">
<p>The suggest feature suggests similar looking terms based on a provided text by
using a suggester. The suggest request part is defined alongside the query part
in a <code>_search</code> request. If the query part is left out, only suggestions are
returned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>_suggest</code> endpoint has been deprecated in favour of using suggest via
<code>_search</code> endpoint. In 5.0, the <code>_search</code> endpoint has been optimized for
suggest only search requests.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="search-suggesters-api-example">Examples</h4>
<div class="paragraph">
<p>Several suggestions can be specified per request. Each suggestion is identified
with an arbitrary name. In the example below two suggestions are requested. Both
<code>my-suggest-1</code> and <code>my-suggest-2</code> suggestions use the <code>term</code> suggester, but have
a different <code>text</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST _search
{
  "suggest": {
    "my-suggest-1" : {
      "text" : "tring out OpenSearch",
      "term" : {
        "field" : "message"
      }
    },
    "my-suggest-2" : {
      "text" : "kmichy",
      "term" : {
        "field" : "user.id"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The below suggest response example includes the suggestion response for
<code>my-suggest-1</code> and <code>my-suggest-2</code>. Each suggestion part contains
entries. Each entry is effectively a token from the suggest text and
contains the suggestion entry text, the original start offset and length
in the suggest text and if found an arbitrary number of options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "_shards": ...
  "hits": ...
  "took": 2,
  "timed_out": false,
  "suggest": {
    "my-suggest-1": [ {
      "text": "tring",
      "offset": 0,
      "length": 5,
      "options": [ {"text": "trying", "score": 0.8, "freq": 1 } ]
    }, {
      "text": "out",
      "offset": 6,
      "length": 3,
      "options": []
    }, {
      "text": "opensearch",
      "offset": 10,
      "length": 10,
      "options": []
    } ],
    "my-suggest-2": ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each options array contains an option object that includes the
suggested text, its document frequency and score compared to the suggest
entry text. The meaning of the score depends on the used suggester. The
term suggester&#8217;s score is based on the edit distance.</p>
</div>
<h5 id="global-suggest" class="discrete">Global suggest text</h5>
<div class="paragraph">
<p>To avoid repetition of the suggest text, it is possible to define a
global text. In the example below the suggest text is defined globally
and applies to the <code>my-suggest-1</code> and <code>my-suggest-2</code> suggestions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST _search
{
  "suggest": {
    "text" : "tring out OpenSearch",
    "my-suggest-1" : {
      "term" : {
        "field" : "message"
      }
    },
    "my-suggest-2" : {
       "term" : {
        "field" : "user"
       }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The suggest text can in the above example also be specified as
suggestion specific option. The suggest text specified on suggestion
level override the suggest text on the global level.</p>
</div>
</div>
<div class="sect3">
<h4 id="term-suggester">Term suggester</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In order to understand the format of suggestions, please
read the <a href="search.html#search-suggesters">Suggesters</a> page first.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>term</code> suggester suggests terms based on edit distance. The provided
suggest text is analyzed before terms are suggested. The suggested terms
are provided per analyzed suggest text token. The <code>term</code> suggester
doesn&#8217;t take the query into account that is part of request.</p>
</div>
<div class="sect4">
<h5 id="_common_suggest_options">Common suggest options:</h5>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>text</code>
</td>
<td class="hdlist2">
<p>The suggest text. The suggest text is a required option that
needs to be set globally or per suggestion.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>field</code>
</td>
<td class="hdlist2">
<p>The field to fetch the candidate suggestions from. This is
a required option that either needs to be set globally or per
suggestion.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>analyzer</code>
</td>
<td class="hdlist2">
<p>The analyzer to analyse the suggest text with. Defaults
to the search analyzer of the suggest field.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>size</code>
</td>
<td class="hdlist2">
<p>The maximum corrections to be returned per suggest text
token.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sort</code>
</td>
<td class="hdlist2">
<p>Defines how suggestions should be sorted per suggest text
term. Two possible values:</p>
<div class="ulist">
<ul>
<li>
<p><code>score</code>:     Sort by score first, then document frequency and
then the term itself.</p>
</li>
<li>
<p><code>frequency</code>: Sort by document frequency first, then similarity
score and then the term itself.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>suggest_mode</code>
</td>
<td class="hdlist2">
<p>The suggest mode controls what suggestions are
included or controls for what suggest text terms, suggestions should be
suggested. Three possible values can be specified:</p>
<div class="ulist">
<ul>
<li>
<p><code>missing</code>:  Only provide suggestions for suggest text terms that are
not in the index. This is the default.</p>
</li>
<li>
<p><code>popular</code>:  Only suggest suggestions that occur in more docs than
the original suggest text term.</p>
</li>
<li>
<p><code>always</code>:   Suggest any matching suggestions based on terms in the
suggest text.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_other_term_suggest_options">Other term suggest options:</h5>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>max_edits</code>
</td>
<td class="hdlist2">
<p>The maximum edit distance candidate suggestions can
have in order to be considered as a suggestion. Can only be a value
between 1 and 2. Any other value results in a bad request error being
thrown. Defaults to 2.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>prefix_length</code>
</td>
<td class="hdlist2">
<p>The number of minimal prefix characters that must
match in order be a candidate for suggestions. Defaults to 1. Increasing
this number improves spellcheck performance. Usually misspellings don&#8217;t
occur in the beginning of terms. (Old name "prefix_len" is deprecated)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min_word_length</code>
</td>
<td class="hdlist2">
<p>The minimum length a suggest text term must have in
order to be included. Defaults to 4. (Old name "min_word_len" is deprecated)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>shard_size</code>
</td>
<td class="hdlist2">
<p>Sets the maximum number of suggestions to be retrieved
from each individual shard. During the reduce phase only the top N
suggestions are returned based on the <code>size</code> option. Defaults to the
<code>size</code> option. Setting this to a value higher than the <code>size</code> can be
useful in order to get a more accurate document frequency for spelling
corrections at the cost of performance. Due to the fact that terms are
partitioned amongst shards, the shard level document frequencies of
spelling corrections may not be precise. Increasing this will make these
document frequencies more precise.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_inspections</code>
</td>
<td class="hdlist2">
<p>A factor that is used to multiply with the
<code>shards_size</code> in order to inspect more candidate spelling corrections on
the shard level. Can improve accuracy at the cost of performance.
Defaults to 5.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min_doc_freq</code>
</td>
<td class="hdlist2">
<p>The minimal threshold in number of documents a
suggestion should appear in. This can be specified as an absolute number
or as a relative percentage of number of documents. This can improve
quality by only suggesting high frequency terms. Defaults to 0f and is
not enabled. If a value higher than 1 is specified, then the number
cannot be fractional. The shard level document frequencies are used for
this option.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_term_freq</code>
</td>
<td class="hdlist2">
<p>The maximum threshold in number of documents in which a
suggest text token can exist in order to be included. Can be a relative
percentage number (e.g., 0.4) or an absolute number to represent document
frequencies. If a value higher than 1 is specified, then fractional can
not be specified. Defaults to 0.01f. This can be used to exclude high
frequency terms&#8201;&#8212;&#8201;which are usually spelled correctly&#8201;&#8212;&#8201;from being spellchecked.
This also improves the spellcheck performance. The shard level document frequencies
are used for this option.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>string_distance</code>
</td>
<td class="hdlist2">
<p>Which string distance implementation to use for comparing how similar
suggested terms are. Five possible values can be specified:</p>
<div class="ulist">
<ul>
<li>
<p><code>internal</code>: The default based on damerau_levenshtein but highly optimized
for comparing string distance for terms inside the index.</p>
</li>
<li>
<p><code>damerau_levenshtein</code>: String distance algorithm based on
Damerau-Levenshtein algorithm.</p>
</li>
<li>
<p><code>levenshtein</code>: String distance algorithm based on Levenshtein edit distance
algorithm.</p>
</li>
<li>
<p><code>jaro_winkler</code>: String distance algorithm based on Jaro-Winkler algorithm.</p>
</li>
<li>
<p><code>ngram</code>: String distance algorithm based on character n-grams.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="phrase-suggester">Phrase Suggester</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In order to understand the format of suggestions, please
read the <a href="search.html#search-suggesters">Suggesters</a> page first.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>term</code> suggester provides a very convenient API to access word
alternatives on a per token basis within a certain string distance. The API
allows accessing each token in the stream individually while
suggest-selection is left to the API consumer. Yet, often pre-selected
suggestions are required in order to present to the end-user. The
<code>phrase</code> suggester adds additional logic on top of the <code>term</code> suggester
to select entire corrected phrases instead of individual tokens weighted
based on <code>ngram-language</code> models. In practice this suggester will be
able to make better decisions about which tokens to pick based on
co-occurrence and frequencies.</p>
</div>
<div class="sect4">
<h5 id="_api_example">API Example</h5>
<div class="paragraph">
<p>In general the <code>phrase</code> suggester requires special mapping up front to work.
The <code>phrase</code> suggester examples on this page need the following mapping to
work. The <code>reverse</code> analyzer is used only in the last example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT test
{
  "settings": {
    "index": {
      "number_of_shards": 1,
      "analysis": {
        "analyzer": {
          "trigram": {
            "type": "custom",
            "tokenizer": "standard",
            "filter": ["lowercase","shingle"]
          },
          "reverse": {
            "type": "custom",
            "tokenizer": "standard",
            "filter": ["lowercase","reverse"]
          }
        },
        "filter": {
          "shingle": {
            "type": "shingle",
            "min_shingle_size": 2,
            "max_shingle_size": 3
          }
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "fields": {
          "trigram": {
            "type": "text",
            "analyzer": "trigram"
          },
          "reverse": {
            "type": "text",
            "analyzer": "reverse"
          }
        }
      }
    }
  }
}
POST test/_doc?refresh=true
{"title": "noble warriors"}
POST test/_doc?refresh=true
{"title": "nobel prize"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have the analyzers and mappings set up you can use the <code>phrase</code>
suggester in the same spot you&#8217;d use the <code>term</code> suggester:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST test/_search
{
  "suggest": {
    "text": "noble prize",
    "simple_phrase": {
      "phrase": {
        "field": "title.trigram",
        "size": 1,
        "gram_size": 3,
        "direct_generator": [ {
          "field": "title.trigram",
          "suggest_mode": "always"
        } ],
        "highlight": {
          "pre_tag": "&lt;em&gt;",
          "post_tag": "&lt;/em&gt;"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response contains suggestions scored by the most likely spelling correction first. In this case we received the expected correction "nobel prize".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "_shards": ...
  "hits": ...
  "timed_out": false,
  "took": 3,
  "suggest": {
    "simple_phrase" : [
      {
        "text" : "noble prize",
        "offset" : 0,
        "length" : 11,
        "options" : [ {
          "text" : "nobel prize",
          "highlighted": "&lt;em&gt;nobel&lt;/em&gt; prize",
          "score" : 0.48614594
        }]
      }
    ]
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_basic_phrase_suggest_api_parameters">Basic Phrase suggest API parameters</h5>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>field</code>
</td>
<td class="hdlist2">
<p>The name of the field used to do n-gram lookups for the
language model, the suggester will use this field to gain statistics to
score corrections. This field is mandatory.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>gram_size</code>
</td>
<td class="hdlist2">
<p>Sets max size of the n-grams (shingles) in the <code>field</code>.
If the field doesn&#8217;t contain n-grams (shingles), this should be omitted
or set to <code>1</code>. Note that OpenSearch tries to detect the gram size
based on the specified <code>field</code>. If the field uses a <code>shingle</code> filter, the
<code>gram_size</code> is set to the <code>max_shingle_size</code> if not explicitly set.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>real_word_error_likelihood</code>
</td>
<td class="hdlist2">
<p>The likelihood of a term being
misspelled even if the term exists in the dictionary. The default is
<code>0.95</code>, meaning 5% of the real words are misspelled.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>confidence</code>
</td>
<td class="hdlist2">
<p>The confidence level defines a factor applied to the
input phrases score which is used as a threshold for other suggest
candidates. Only candidates that score higher than the threshold will be
included in the result. For instance a confidence level of <code>1.0</code> will
only return suggestions that score higher than the input phrase. If set
to <code>0.0</code> the top N candidates are returned. The default is <code>1.0</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_errors</code>
</td>
<td class="hdlist2">
<p>The maximum percentage of the terms
considered to be misspellings in order to form a correction. This method
accepts a float value in the range <code>[0..1)</code> as a fraction of the actual
query terms or a number <code>&gt;=1</code> as an absolute number of query terms. The
default is set to <code>1.0</code>, meaning only corrections with
at most one misspelled term are returned.  Note that setting this too high
can negatively impact performance. Low values like <code>1</code> or <code>2</code> are recommended;
otherwise the time spend in suggest calls might exceed the time spend in
query execution.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>separator</code>
</td>
<td class="hdlist2">
<p>The separator that is used to separate terms in the
bigram field. If not set the whitespace character is used as a
separator.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>size</code>
</td>
<td class="hdlist2">
<p>The number of candidates that are generated for each
individual query term. Low numbers like <code>3</code> or <code>5</code> typically produce good
results. Raising this can bring up terms with higher edit distances. The
default is <code>5</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>analyzer</code>
</td>
<td class="hdlist2">
<p>Sets the analyzer to analyze to suggest text with.
Defaults to the search analyzer of the suggest field passed via <code>field</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>shard_size</code>
</td>
<td class="hdlist2">
<p>Sets the maximum number of suggested terms to be
retrieved from each individual shard. During the reduce phase, only the
top N suggestions are returned based on the <code>size</code> option. Defaults to
<code>5</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>text</code>
</td>
<td class="hdlist2">
<p>Sets the text / query to provide suggestions for.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>highlight</code>
</td>
<td class="hdlist2">
<p>Sets up suggestion highlighting.  If not provided then
no <code>highlighted</code> field is returned.  If provided must
contain exactly <code>pre_tag</code> and <code>post_tag</code>, which are
wrapped around the changed tokens.  If multiple tokens
in a row are changed the entire phrase of changed tokens
is wrapped rather than each token.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>collate</code>
</td>
<td class="hdlist2">
<p>Checks each suggestion against the specified <code>query</code> to prune suggestions
for which no matching docs exist in the index. The collate query for a
suggestion is run only on the local shard from which the suggestion has
been generated from. The <code>query</code> must be specified and it can be templated,
see <a href="search.html#search-template">search templates</a> for more information.
The current suggestion is automatically made available as the <code>{{suggestion}}</code>
variable, which should be used in your query.  You can still specify
your own template <code>params</code>&#8201;&#8212;&#8201;the <code>suggestion</code> value will be added to the
variables you specify. Additionally, you can specify a <code>prune</code> to control
if all phrase suggestions will be returned; when set to <code>true</code> the suggestions
will have an additional option <code>collate_match</code>, which will be <code>true</code> if
matching documents for the phrase was found, <code>false</code> otherwise.
The default value for <code>prune</code> is <code>false</code>.</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST test/_search
{
  "suggest": {
    "text" : "noble prize",
    "simple_phrase" : {
      "phrase" : {
        "field" :  "title.trigram",
        "size" :   1,
        "direct_generator" : [ {
          "field" :            "title.trigram",
          "suggest_mode" :     "always",
          "min_word_length" :  1
        } ],
        "collate": {
          "query": { <b class="conum">(1)</b>
            "source" : {
              "match": {
                "{{field_name}}" : "{{suggestion}}" <b class="conum">(2)</b>
              }
            }
          },
          "params": {"field_name" : "title"}, <b class="conum">(3)</b>
          "prune": true <b class="conum">(4)</b>
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This query will be run once for every suggestion.</p>
</li>
<li>
<p>The <code>{{suggestion}}</code> variable will be replaced by the text
of each suggestion.</p>
</li>
<li>
<p>An additional <code>field_name</code> variable has been specified in
<code>params</code> and is used by the <code>match</code> query.</p>
</li>
<li>
<p>All suggestions will be returned with an extra <code>collate_match</code>
option indicating whether the generated phrase matched any
document.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_smoothing_models">Smoothing Models</h5>
<div class="paragraph">
<p>The <code>phrase</code> suggester supports multiple smoothing models to balance
weight between infrequent grams (grams (shingles) are not existing in
the index) and frequent grams (appear at least once in the index). The
smoothing model can be selected by setting the <code>smoothing</code> parameter
to one of the following options. Each smoothing model supports specific
properties that can be configured.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>stupid_backoff</code>
</td>
<td class="hdlist2">
<p>A simple backoff model that backs off to lower
order n-gram models if the higher order count is <code>0</code> and discounts the
lower order n-gram model by a constant factor. The default <code>discount</code> is
<code>0.4</code>. Stupid Backoff is the default model.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>laplace</code>
</td>
<td class="hdlist2">
<p>A smoothing model that uses an additive smoothing where a
constant (typically <code>1.0</code> or smaller) is added to all counts to balance
weights. The default <code>alpha</code> is <code>0.5</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>linear_interpolation</code>
</td>
<td class="hdlist2">
<p>A smoothing model that takes the weighted
mean of the unigrams, bigrams, and trigrams based on user supplied
weights (lambdas). Linear Interpolation doesn&#8217;t have any default values.
All parameters (<code>trigram_lambda</code>, <code>bigram_lambda</code>, <code>unigram_lambda</code>)
must be supplied.</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST test/_search
{
  "suggest": {
    "text" : "obel prize",
    "simple_phrase" : {
      "phrase" : {
        "field" : "title.trigram",
        "size" : 1,
        "smoothing" : {
          "laplace" : {
            "alpha" : 0.7
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_candidate_generators">Candidate Generators</h5>
<div class="paragraph">
<p>The <code>phrase</code> suggester uses candidate generators to produce a list of
possible terms per term in the given text. A single candidate generator
is similar to a <code>term</code> suggester called for each individual term in the
text. The output of the generators is subsequently scored in combination
with the candidates from the other terms for suggestion candidates.</p>
</div>
<div class="paragraph">
<p>Currently only one type of candidate generator is supported, the
<code>direct_generator</code>. The Phrase suggest API accepts a list of generators
under the key <code>direct_generator</code>; each of the generators in the list is
called per term in the original text.</p>
</div>
</div>
<div class="sect4">
<h5 id="_direct_generators">Direct Generators</h5>
<div class="paragraph">
<p>The direct generators support the following parameters:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>field</code>
</td>
<td class="hdlist2">
<p>The field to fetch the candidate suggestions from. This is
a required option that either needs to be set globally or per
suggestion.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>size</code>
</td>
<td class="hdlist2">
<p>The maximum corrections to be returned per suggest text token.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>suggest_mode</code>
</td>
<td class="hdlist2">
<p>The suggest mode controls what suggestions are included on the suggestions
generated on each shard. All values other than <code>always</code> can be thought of
as an optimization to generate fewer suggestions to test on each shard and
are not rechecked when combining the suggestions generated on each
shard. Thus <code>missing</code> will generate suggestions for terms on shards that do
not contain them even if other shards do contain them. Those should be
filtered out using <code>confidence</code>. Three possible values can be specified:</p>
<div class="ulist">
<ul>
<li>
<p><code>missing</code>: Only generate suggestions for terms that are not in the
shard. This is the default.</p>
</li>
<li>
<p><code>popular</code>: Only suggest terms that occur in more docs on the shard than
the original term.</p>
</li>
<li>
<p><code>always</code>: Suggest any matching suggestions based on terms in the
suggest text.</p>
</li>
</ul>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_edits</code>
</td>
<td class="hdlist2">
<p>The maximum edit distance candidate suggestions can have
in order to be considered as a suggestion. Can only be a value between 1
and 2. Any other value results in a bad request error being thrown.
Defaults to 2.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>prefix_length</code>
</td>
<td class="hdlist2">
<p>The number of minimal prefix characters that must
match in order be a candidate suggestions. Defaults to 1. Increasing
this number improves spellcheck performance. Usually misspellings don&#8217;t
occur in the beginning of terms. (Old name "prefix_len" is deprecated)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min_word_length</code>
</td>
<td class="hdlist2">
<p>The minimum length a suggest text term must have in
order to be included. Defaults to 4. (Old name "min_word_len" is deprecated)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_inspections</code>
</td>
<td class="hdlist2">
<p>A factor that is used to multiply with the
<code>shards_size</code> in order to inspect more candidate spelling corrections on
the shard level. Can improve accuracy at the cost of performance.
Defaults to 5.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min_doc_freq</code>
</td>
<td class="hdlist2">
<p>The minimal threshold in number of documents a
suggestion should appear in. This can be specified as an absolute number
or as a relative percentage of number of documents. This can improve
quality by only suggesting high frequency terms. Defaults to 0f and is
not enabled. If a value higher than 1 is specified, then the number
cannot be fractional. The shard level document frequencies are used for
this option.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_term_freq</code>
</td>
<td class="hdlist2">
<p>The maximum threshold in number of documents in which a
suggest text token can exist in order to be included. Can be a relative
percentage number (e.g., 0.4) or an absolute number to represent document
frequencies. If a value higher than 1 is specified, then fractional can
not be specified. Defaults to 0.01f. This can be used to exclude high
frequency terms&#8201;&#8212;&#8201;which are usually spelled correctly&#8201;&#8212;&#8201;from being spellchecked. This also improves the spellcheck
performance. The shard level document frequencies are used for this
option.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>pre_filter</code>
</td>
<td class="hdlist2">
<p>A filter (analyzer) that is applied to each of the
tokens passed to this candidate generator. This filter is applied to the
original token before candidates are generated.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>post_filter</code>
</td>
<td class="hdlist2">
<p>A filter (analyzer) that is applied to each of the
generated tokens before they are passed to the actual phrase scorer.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows a <code>phrase</code> suggest call with two generators:
the first one is using a field containing ordinary indexed terms, and the
second one uses a field that uses terms indexed with a <code>reverse</code> filter
(tokens are index in reverse order). This is used to overcome the limitation
of the direct generators to require a constant prefix to provide
high-performance suggestions. The <code>pre_filter</code> and <code>post_filter</code> options
accept ordinary analyzer names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST test/_search
{
  "suggest": {
    "text" : "obel prize",
    "simple_phrase" : {
      "phrase" : {
        "field" : "title.trigram",
        "size" : 1,
        "direct_generator" : [ {
          "field" : "title.trigram",
          "suggest_mode" : "always"
        }, {
          "field" : "title.reverse",
          "suggest_mode" : "always",
          "pre_filter" : "reverse",
          "post_filter" : "reverse"
        } ]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>pre_filter</code> and <code>post_filter</code> can also be used to inject synonyms after
candidates are generated. For instance for the query <code>captain usq</code> we
might generate a candidate <code>usa</code> for the term <code>usq</code>, which is a synonym for
<code>america</code>. This allows us to present <code>captain america</code> to the user if this
phrase scores high enough.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="completion-suggester">Completion Suggester</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In order to understand the format of suggestions, please
read the <a href="search.html#search-suggesters">Suggesters</a> page first. For more flexible
search-as-you-type searches that do not use suggesters, see the
<a href="mapping-types.html#search-as-you-type"><code>search_as_you_type</code> field type</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>completion</code> suggester provides auto-complete/search-as-you-type
functionality. This is a navigational feature to guide users to
relevant results as they are typing, improving search precision.
It is not meant for spell correction or did-you-mean functionality
like the <code>term</code> or <code>phrase</code> suggesters.</p>
</div>
<div class="paragraph">
<p>Ideally, auto-complete functionality should be as fast as a user
types to provide instant feedback relevant to what a user has already
typed in. Hence, <code>completion</code> suggester is optimized for speed.
The suggester uses data structures that enable fast lookups,
but are costly to build and are stored in-memory.</p>
</div>
<div class="sect4">
<h5 id="completion-suggester-mapping">Mapping</h5>
<div class="paragraph">
<p>To use this feature, specify a special mapping for this field,
which indexes the field values for fast completions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT music
{
  "mappings": {
    "properties": {
      "suggest": {
        "type": "completion"
      },
      "title": {
        "type": "keyword"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mapping supports the following parameters:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>analyzer</code>
</td>
<td class="hdlist2">
<p>The index analyzer to use, defaults to <code>simple</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>search_analyzer</code>
</td>
<td class="hdlist2">
<p>The search analyzer to use, defaults to value of <code>analyzer</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>preserve_separators</code>
</td>
<td class="hdlist2">
<p>Preserves the separators, defaults to <code>true</code>.
If disabled, you could find a field starting with <code>Foo Fighters</code>, if you
suggest for <code>foof</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>preserve_position_increments</code>
</td>
<td class="hdlist2">
<p>Enables position increments, defaults to <code>true</code>.
If disabled and using stopwords analyzer, you could get a
field starting with <code>The Beatles</code>, if you suggest for <code>b</code>. <strong>Note</strong>: You
could also achieve this by indexing two inputs, <code>Beatles</code> and
<code>The Beatles</code>, no need to change a simple analyzer, if you are able to
enrich your data.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_input_length</code>
</td>
<td class="hdlist2">
<p>Limits the length of a single input, defaults to <code>50</code> UTF-16 code points.
This limit is only used at index time to reduce the total number of
characters per input string in order to prevent massive inputs from
bloating the underlying datastructure. Most use cases won&#8217;t be influenced
by the default value since prefix completions seldom grow beyond prefixes longer
than a handful of characters.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="indexing">Indexing</h5>
<div class="paragraph">
<p>You index suggestions like any other field. A suggestion is made of an
<code>input</code> and an optional <code>weight</code> attribute. An <code>input</code> is the expected
text to be matched by a suggestion query and the <code>weight</code> determines how
the suggestions will be scored. Indexing a suggestion is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT music/_doc/1?refresh
{
  "suggest" : {
    "input": [ "Nevermind", "Nirvana" ],
    "weight" : 34
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following parameters are supported:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>input</code>
</td>
<td class="hdlist2">
<p>The input to store, this can be an array of strings or just
a string. This field is mandatory.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This value cannot contain the following UTF-16 control characters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>\u0000</code> (null)</p>
</li>
<li>
<p><code>\u001f</code> (information separator one)</p>
</li>
<li>
<p><code>\u001e</code> (information separator two)</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>weight</code>
</td>
<td class="hdlist2">
<p>A positive integer or a string containing a positive integer,
which defines a weight and allows you to rank your suggestions.
This field is optional.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can index multiple suggestions for a document as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT music/_doc/1?refresh
{
  "suggest": [
    {
      "input": "Nevermind",
      "weight": 10
    },
    {
      "input": "Nirvana",
      "weight": 3
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the following shorthand form. Note that you can not specify
a weight with suggestion(s) in the shorthand form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT music/_doc/1?refresh
{
  "suggest" : [ "Nevermind", "Nirvana" ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="querying">Querying</h5>
<div class="paragraph">
<p>Suggesting works as usual, except that you have to specify the suggest
type as <code>completion</code>. Suggestions are near real-time, which means
new suggestions can be made visible by <a href="indices.html#indices-refresh">refresh</a> and
documents once deleted are never shown. This request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST music/_search?pretty
{
  "suggest": {
    "song-suggest": {
      "prefix": "nir",        <b class="conum">(1)</b>
      "completion": {         <b class="conum">(2)</b>
          "field": "suggest"  <b class="conum">(3)</b>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Prefix used to search for suggestions</p>
</li>
<li>
<p>Type of suggestions</p>
</li>
<li>
<p>Name of the field to search for suggestions in</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>returns this response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits": ...
  "took": 2,
  "timed_out": false,
  "suggest": {
    "song-suggest" : [ {
      "text" : "nir",
      "offset" : 0,
      "length" : 3,
      "options" : [ {
        "text" : "Nirvana",
        "_index": "music",
        "_type": "_doc",
        "_id": "1",
        "_score": 1.0,
        "_source": {
          "suggest": ["Nevermind", "Nirvana"]
        }
      } ]
    } ]
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>_source</code> metadata field must be enabled, which is the default
behavior, to enable returning <code>_source</code> with suggestions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configured weight for a suggestion is returned as <code>_score</code>. The
<code>text</code> field uses the <code>input</code> of your indexed suggestion. Suggestions
return the full document <code>_source</code> by default. The size of the <code>_source</code>
can impact performance due to disk fetch and network transport overhead.
To save some network overhead, filter out unnecessary fields from the <code>_source</code>
using <a href="search-fields.html#source-filtering">source filtering</a> to minimize
<code>_source</code> size. Note that the _suggest endpoint doesn&#8217;t support source
filtering but using suggest on the <code>_search</code> endpoint does:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST music/_search
{
  "_source": "suggest",     <b class="conum">(1)</b>
  "suggest": {
    "song-suggest": {
      "prefix": "nir",
      "completion": {
        "field": "suggest", <b class="conum">(2)</b>
        "size": 5           <b class="conum">(3)</b>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Filter the source to return only the <code>suggest</code> field</p>
</li>
<li>
<p>Name of the field to search for suggestions in</p>
</li>
<li>
<p>Number of suggestions to return</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Which should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "took": 6,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 0,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "suggest": {
    "song-suggest": [ {
        "text": "nir",
        "offset": 0,
        "length": 3,
        "options": [ {
            "text": "Nirvana",
            "_index": "music",
            "_type": "_doc",
            "_id": "1",
            "_score": 1.0,
            "_source": {
              "suggest": [ "Nevermind", "Nirvana" ]
            }
          } ]
      } ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The basic completion suggester query supports the following parameters:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>field</code>
</td>
<td class="hdlist2">
<p>The name of the field on which to run the query (required).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>size</code>
</td>
<td class="hdlist2">
<p>The number of suggestions to return (defaults to <code>5</code>).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>skip_duplicates</code>
</td>
<td class="hdlist2">
<p>Whether duplicate suggestions should be filtered out (defaults to <code>false</code>).</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The completion suggester considers all documents in the index.
See <a href="search.html#context-suggester">Context Suggester</a> for an explanation of how to query a subset of
documents instead.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In case of completion queries spanning more than one shard, the suggest
is executed in two phases, where the last phase fetches the relevant documents
from shards, implying executing completion requests against a single shard is
more performant due to the document fetch overhead when the suggest spans
multiple shards. To get best performance for completions, it is recommended to
index completions into a single shard index. In case of high heap usage due to
shard size, it is still recommended to break index into multiple shards instead
of optimizing for completion performance.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="skip_duplicates">Skip duplicate suggestions</h5>
<div class="paragraph">
<p>Queries can return duplicate suggestions coming from different documents.
It is possible to modify this behavior by setting <code>skip_duplicates</code> to true.
When set, this option filters out documents with duplicate suggestions from the result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST music/_search?pretty
{
  "suggest": {
    "song-suggest": {
      "prefix": "nor",
      "completion": {
        "field": "suggest",
        "skip_duplicates": true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When set to true, this option can slow down search because more suggestions
need to be visited to find the top N.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="fuzzy">Fuzzy queries</h5>
<div class="paragraph">
<p>The completion suggester also supports fuzzy queries&#8201;&#8212;&#8201;this means
you can have a typo in your search and still get results back.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST music/_search?pretty
{
  "suggest": {
    "song-suggest": {
      "prefix": "nor",
      "completion": {
        "field": "suggest",
        "fuzzy": {
          "fuzziness": 2
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Suggestions that share the longest prefix to the query <code>prefix</code> will
be scored higher.</p>
</div>
<div class="paragraph">
<p>The fuzzy query can take specific fuzzy parameters.
The following parameters are supported:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>fuzziness</code>
</td>
<td class="hdlist2">
<p>The fuzziness factor, defaults to <code>AUTO</code>.
See  <a href="api-conventions.html#fuzziness">Fuzziness</a> for allowed settings.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>transpositions</code>
</td>
<td class="hdlist2">
<p>if set to <code>true</code>, transpositions are counted
as one change instead of two, defaults to <code>true</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min_length</code>
</td>
<td class="hdlist2">
<p>Minimum length of the input before fuzzy
suggestions are returned, defaults <code>3</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>prefix_length</code>
</td>
<td class="hdlist2">
<p>Minimum length of the input, which is not
checked for fuzzy alternatives, defaults to <code>1</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>unicode_aware</code>
</td>
<td class="hdlist2">
<p>If <code>true</code>, all measurements (like fuzzy edit
distance, transpositions, and lengths) are
measured in Unicode code points instead of
in bytes.  This is slightly slower than raw
bytes, so it is set to <code>false</code> by default.</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you want to stick with the default values, but
      still use fuzzy, you can either use <code>fuzzy: {}</code>
      or <code>fuzzy: true</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="regex">Regex queries</h5>
<div class="paragraph">
<p>The completion suggester also supports regex queries meaning
you can express a prefix as a regular expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST music/_search?pretty
{
  "suggest": {
    "song-suggest": {
      "regex": "n[ever|i]r",
      "completion": {
        "field": "suggest"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The regex query can take specific regex parameters.
The following parameters are supported:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>flags</code>
</td>
<td class="hdlist2">
<p>Possible flags are <code>ALL</code> (default), <code>ANYSTRING</code>, <code>COMPLEMENT</code>,
<code>EMPTY</code>, <code>INTERSECTION</code>, <code>INTERVAL</code>, or <code>NONE</code>. See <a href="term-level-queries.html#query-dsl-regexp-query">regexp-syntax</a>
for their meaning</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_determinized_states</code>
</td>
<td class="hdlist2">
<p>Regular expressions are dangerous because it&#8217;s easy to accidentally
create an innocuous looking one that requires an exponential number of
internal determinized automaton states (and corresponding RAM and CPU)
for Lucene to execute.  Lucene prevents these using the
<code>max_determinized_states</code> setting (defaults to 10000).  You can raise
this limit to allow more complex regular expressions to execute.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="context-suggester">Context Suggester</h4>
<div class="paragraph">
<p>The completion suggester considers all documents in the index, but it is often
desirable to serve suggestions filtered and/or boosted by some criteria.
For example, you want to suggest song titles filtered by certain artists or
you want to boost song titles based on their genre.</p>
</div>
<div class="paragraph">
<p>To achieve suggestion filtering and/or boosting, you can add context mappings while
configuring a completion field. You can define multiple context mappings for a
completion field.
Every context mapping has a unique name and a type. There are two types: <code>category</code>
and <code>geo</code>. Context mappings are configured under the <code>contexts</code> parameter in
the field mapping.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is mandatory to provide a context when indexing and querying
      a context enabled completion field.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following defines types, each with two context mappings for a completion
field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT place
{
  "mappings": {
    "properties": {
      "suggest": {
        "type": "completion",
        "contexts": [
          {                                 <b class="conum">(1)</b>
            "name": "place_type",
            "type": "category"
          },
          {                                 <b class="conum">(2)</b>
            "name": "location",
            "type": "geo",
            "precision": 4
          }
        ]
      }
    }
  }
}
PUT place_path_category
{
  "mappings": {
    "properties": {
      "suggest": {
        "type": "completion",
        "contexts": [
          {                           <b class="conum">(3)</b>
            "name": "place_type",
            "type": "category",
            "path": "cat"
          },
          {                           <b class="conum">(4)</b>
            "name": "location",
            "type": "geo",
            "precision": 4,
            "path": "loc"
          }
        ]
      },
      "loc": {
        "type": "geo_point"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Defines a <code>category</code> context named 'place_type' where the categories must be
sent with the suggestions.</p>
</li>
<li>
<p>Defines a <code>geo</code> context named 'location' where the categories must be sent
with the suggestions.</p>
</li>
<li>
<p>Defines a <code>category</code> context named 'place_type' where the categories are
read from the <code>cat</code> field.</p>
</li>
<li>
<p>Defines a <code>geo</code> context named 'location' where the categories are read from
the <code>loc</code> field.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Adding context mappings increases the index size for completion field. The completion index
is entirely heap resident, you can monitor the completion field index size using <a href="indices.html#indices-stats">Index stats API</a>.
</td>
</tr>
</table>
</div>
<h5 id="suggester-context-category" class="discrete">Category Context</h5>
<div class="paragraph">
<p>The <code>category</code> context allows you to associate one or more categories with suggestions at index
time. At query time, suggestions can be filtered and boosted by their associated categories.</p>
</div>
<div class="paragraph">
<p>The mappings are set up like the <code>place_type</code> fields above. If <code>path</code> is defined
then the categories are read from that path in the document, otherwise they must
be sent in the suggest field like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT place/_doc/1
{
  "suggest": {
    "input": [ "timmy's", "starbucks", "dunkin donuts" ],
    "contexts": {
      "place_type": [ "cafe", "food" ]                    <b class="conum">(1)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>These suggestions will be associated with 'cafe' and 'food' category.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the mapping had a <code>path</code> then the following index request would be enough to
add the categories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT place_path_category/_doc/1
{
  "suggest": ["timmy's", "starbucks", "dunkin donuts"],
  "cat": ["cafe", "food"] <b class="conum">(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>These suggestions will be associated with 'cafe' and 'food' category.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If context mapping references another field and the categories
are explicitly indexed, the suggestions are indexed with both set
of categories.
</td>
</tr>
</table>
</div>
<h6 id="_category_query" class="discrete">Category Query</h6>
<div class="paragraph">
<p>Suggestions can be filtered by one or more categories. The following
filters suggestions by multiple categories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST place/_search?pretty
{
  "suggest": {
    "place_suggestion": {
      "prefix": "tim",
      "completion": {
        "field": "suggest",
        "size": 10,
        "contexts": {
          "place_type": [ "cafe", "restaurants" ]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If multiple categories or category contexts are set on the query
they are merged as a disjunction. This means that suggestions match
if they contain at least one of the provided context values.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Suggestions with certain categories can be boosted higher than others.
The following filters suggestions by categories and additionally boosts
suggestions associated with some categories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST place/_search?pretty
{
  "suggest": {
    "place_suggestion": {
      "prefix": "tim",
      "completion": {
        "field": "suggest",
        "size": 10,
        "contexts": {
          "place_type": [                             <b class="conum">(1)</b>
            { "context": "cafe" },
            { "context": "restaurants", "boost": 2 }
          ]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The context query filter suggestions associated with
categories 'cafe' and 'restaurants' and boosts the
suggestions associated with 'restaurants' by a
factor of <code>2</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In addition to accepting category values, a context query can be composed of
multiple category context clauses. The following parameters are supported for a
<code>category</code> context clause:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>context</code>
</td>
<td class="hdlist2">
<p>The value of the category to filter/boost on.
This is mandatory.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>boost</code>
</td>
<td class="hdlist2">
<p>The factor by which the score of the suggestion
should be boosted, the score is computed by
multiplying the boost with the suggestion weight,
defaults to <code>1</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>prefix</code>
</td>
<td class="hdlist2">
<p>Whether the category value should be treated as a
prefix or not. For example, if set to <code>true</code>,
you can filter category of 'type1', 'type2' and
so on, by specifying a category prefix of 'type'.
Defaults to <code>false</code></p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If a suggestion entry matches multiple contexts the final score is computed as the
maximum score produced by any matching contexts.
</td>
</tr>
</table>
</div>
<h5 id="suggester-context-geo" class="discrete">Geo location Context</h5>
<div class="paragraph">
<p>A <code>geo</code> context allows you to associate one or more geo points or geohashes with suggestions
at index time. At query time, suggestions can be filtered and boosted if they are within
a certain distance of a specified geo location.</p>
</div>
<div class="paragraph">
<p>Internally, geo points are encoded as geohashes with the specified precision.</p>
</div>
<h6 id="_geo_mapping" class="discrete">Geo Mapping</h6>
<div class="paragraph">
<p>In addition to the <code>path</code> setting, <code>geo</code> context mapping accepts the following settings:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>precision</code>
</td>
<td class="hdlist2">
<p>This defines the precision of the geohash to be indexed and can be specified
as a distance value (<code>5m</code>, <code>10km</code> etc.), or as a raw geohash precision (<code>1</code>..<code>12</code>).
Defaults to a raw geohash precision value of <code>6</code>.</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The index time <code>precision</code> setting sets the maximum geohash precision that
can be used at query time.
</td>
</tr>
</table>
</div>
<h6 id="_indexing_geo_contexts" class="discrete">Indexing geo contexts</h6>
<div class="paragraph">
<p><code>geo</code> contexts can be explicitly set with suggestions or be indexed from a geo point field in the
document via the <code>path</code> parameter, similar to <code>category</code> contexts. Associating multiple geo location context
with a suggestion, will index the suggestion for every geo location. The following indexes a suggestion
with two geo location contexts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT place/_doc/1
{
  "suggest": {
    "input": "timmy's",
    "contexts": {
      "location": [
        {
          "lat": 43.6624803,
          "lon": -79.3863353
        },
        {
          "lat": 43.6624718,
          "lon": -79.3873227
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<h6 id="_geo_location_query" class="discrete">Geo location Query</h6>
<div class="paragraph">
<p>Suggestions can be filtered and boosted with respect to how close they are to one or
more geo points. The following filters suggestions that fall within the area represented by
the encoded geohash of a geo point:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST place/_search
{
  "suggest": {
    "place_suggestion": {
      "prefix": "tim",
      "completion": {
        "field": "suggest",
        "size": 10,
        "contexts": {
          "location": {
            "lat": 43.662,
            "lon": -79.380
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When a location with a lower precision at query time is specified, all suggestions
that fall within the area will be considered.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If multiple categories or category contexts are set on the query
they are merged as a disjunction. This means that suggestions match
if they contain at least one of the provided context values.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Suggestions that are within an area represented by a geohash can also be boosted higher
than others, as shown by the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST place/_search?pretty
{
  "suggest": {
    "place_suggestion": {
      "prefix": "tim",
      "completion": {
        "field": "suggest",
        "size": 10,
        "contexts": {
          "location": [             <b class="conum">(1)</b>
                      {
              "lat": 43.6624803,
              "lon": -79.3863353,
              "precision": 2
            },
            {
              "context": {
                "lat": 43.6624803,
                "lon": -79.3863353
              },
              "boost": 2
            }
          ]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The context query filters for suggestions that fall under
the geo location represented by a geohash of '(43.662, -79.380)'
with a precision of '2' and boosts suggestions
that fall under the geohash representation of '(43.6624803, -79.3863353)'
with a default precision of '6' by a factor of <code>2</code></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If a suggestion entry matches multiple contexts the final score is computed as the
maximum score produced by any matching contexts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to accepting context values, a context query can be composed of
multiple context clauses. The following parameters are supported for a
<code>geo</code> context clause:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>context</code>
</td>
<td class="hdlist2">
<p>A geo point object or a geo hash string to filter or
boost the suggestion by. This is mandatory.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>boost</code>
</td>
<td class="hdlist2">
<p>The factor by which the score of the suggestion
should be boosted, the score is computed by
multiplying the boost with the suggestion weight,
defaults to <code>1</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>precision</code>
</td>
<td class="hdlist2">
<p>The precision of the geohash to encode the query geo point.
This can be specified as a distance value (<code>5m</code>, <code>10km</code> etc.),
or as a raw geohash precision (<code>1</code>..<code>12</code>).
Defaults to index time precision level.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>neighbours</code>
</td>
<td class="hdlist2">
<p>Accepts an array of precision values at which
neighbouring geohashes should be taken into account.
precision value can be a distance value (<code>5m</code>, <code>10km</code> etc.)
or a raw geohash precision (<code>1</code>..<code>12</code>). Defaults to
generating neighbours for index time precision level.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="return-suggesters-type">Returning the type of the suggester</h4>
<div class="paragraph">
<p>Sometimes you need to know the exact type of a suggester in order to parse its results. The <code>typed_keys</code> parameter
 can be used to change the suggester&#8217;s name in the response so that it will be prefixed by its type.</p>
</div>
<div class="paragraph">
<p>Considering the following example with two suggesters <code>term</code> and <code>phrase</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST _search?typed_keys
{
  "suggest": {
    "text" : "some test mssage",
    "my-first-suggester" : {
      "term" : {
        "field" : "message"
      }
    },
    "my-second-suggester" : {
      "phrase" : {
        "field" : "message"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the response, the suggester names will be changed to respectively <code>term#my-first-suggester</code> and
<code>phrase#my-second-suggester</code>, reflecting the types of each suggestion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "suggest": {
    "term#my-first-suggester": [ <b class="conum">(1)</b>
      {
        "text": "some",
        "offset": 0,
        "length": 4,
        "options": []
      },
      {
        "text": "test",
        "offset": 5,
        "length": 4,
        "options": []
      },
      {
        "text": "mssage",
        "offset": 10,
        "length": 6,
        "options": [
          {
            "text": "message",
            "score": 0.8333333,
            "freq": 4
          }
        ]
      }
    ],
    "phrase#my-second-suggester": [ <b class="conum">(2)</b>
      {
        "text": "some test mssage",
        "offset": 0,
        "length": 16,
        "options": [
          {
            "text": "some test message",
            "score": 0.030227963
          }
        ]
      }
    ]
  },
  ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The name <code>my-first-suggester</code> now contains the <code>term</code> prefix.</p>
</li>
<li>
<p>The name <code>my-second-suggester</code> now contains the <code>phrase</code> prefix.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-multi-search">Multi search API</h3>
<titleabbrev>Multi search</titleabbrev>
<div class="paragraph">
<p>Executes several searches with a single API request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_msearch
{ }
{"query" : {"match" : { "message": "this is a test"}}}
{"index": "my-index-000002"}
{"query" : {"match_all" : {}}}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="search-multi-search-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /&lt;target&gt;/_msearch</code></p>
</div>
</div>
<div class="sect3">
<h4 id="search-multi-search-api-desc">Description</h4>
<div class="paragraph">
<p>The multi search API executes several searches from a single API request.
The format of the request is similar to the bulk API format and makes use
of the newline delimited JSON (NDJSON) format.</p>
</div>
<div class="paragraph">
<p>The structure is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">header\n
body\n
header\n
body\n</code></pre>
</div>
</div>
<div class="paragraph">
<p>This structure is specifically optimized to reduce parsing if a specific search
ends up redirected to another node.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The final line of data must end with a newline character <code>\n</code>. Each newline
character may be preceded by a carriage return <code>\r</code>. When sending requests to
this endpoint the <code>Content-Type</code> header should be set to <code>application/x-ndjson</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="search-multi-search-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;target&gt;</code></dt>
<dd>
<p>(Optional, string)
Comma-separated list of indices and index aliases to search.</p>
<div class="paragraph">
<p>This list acts as a fallback if a search in the request body does not specify an
<code>index</code> target.</p>
</div>
<div class="paragraph">
<p>Wildcard (<code><strong></code>) expressions are supported. To search all indices
in a cluster, omit this parameter or use <code>_all</code> or <code></strong></code>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-multi-search-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>allow_no_indices</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error if any wildcard expression,
<a href="indices.html#indices-aliases">index alias</a>, or <code>_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code>foo*,bar*</code> returns an error if an index
starts with <code>foo</code> but no index starts with <code>bar</code>.</p>
</dd>
<dt class="hdlist1"><code>ccs_minimize_roundtrips</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, network roundtrips between the coordinating node and remote clusters
are minimized for cross-cluster search requests. Defaults to <code>true</code>. See
<a href="modules-cross-cluster-search.html#ccs-network-delays">How cross-cluster search handles network delays</a>.</p>
</dd>
<dt class="hdlist1"><code>expand_wildcards</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code>open,hidden</code>. Valid values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>Expand to open and closed indices, including <a href="api-conventions.html#hidden-indices">hidden indices</a>.</p>
</dd>
<dt class="hdlist1"><code>open</code></dt>
<dd>
<p>Expand only to open indices.</p>
</dd>
<dt class="hdlist1"><code>closed</code></dt>
<dd>
<p>Expand only to closed indices.</p>
</dd>
<dt class="hdlist1"><code>hidden</code></dt>
<dd>
<p>Expansion of wildcards will include hidden indices.
Must be combined with <code>open</code>, <code>closed</code>, or both.</p>
</dd>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>Wildcard expressions are not accepted.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>Defaults to <code>open</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>ignore_throttled</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, concrete, expanded or aliased indices are ignored when frozen.
Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, missing or closed indices are not included in the
response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>max_concurrent_searches</code></dt>
<dd>
<p>(Optional, integer)
Maximum number of concurrent searches the multi search API can execute. Defaults
to max(1, (# of &lt;&lt;data-node,data nodes&gt;&gt; * min(&lt;&lt;search-threadpool,search thread pool size&gt;&gt;, 10))).</p>
</dd>
<dt class="hdlist1"><code>max_concurrent_shard_requests</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, integer)
Maximum number of concurrent shard requests that each sub-search request
executes per node.  Defaults to <code>5</code>.</p>
</div>
<div class="paragraph">
<p>You can use this parameter to prevent a request from overloading a cluster. For
example, a default request hits all indices in a cluster. This
could cause shard request rejections if the number of shards per node is high.</p>
</div>
<div class="paragraph">
<p>In certain scenarios, parallelism isn&#8217;t achieved through concurrent requests. In
those cases, a low value in this  parameter could result in poor performance.
For example, in an environment where a very low number of concurrent search
requests are expected, a higher value in this parameter may improve performance.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>pre_filter_shard_size</code></dt>
<dd>
<p>(Optional, integer)
Defines a threshold that enforces a pre-filter roundtrip to prefilter search
shards based on query rewriting if the number of shards the search request
expands to exceeds the threshold. This filter roundtrip can limit the number of
shards significantly if for instance a shard can not match any documents based
on its rewrite method i.e., if date filters are mandatory to match but the
shard bounds and the query are disjoint.
When unspecified, the pre-filter phase is executed if any of these
conditions is met:</p>
<div class="ulist">
<ul>
<li>
<p>The request targets more than <code>128</code> shards.</p>
</li>
<li>
<p>The request targets one or more read-only index.</p>
</li>
<li>
<p>The primary sort of the query targets an indexed field.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>rest_total_hits_as_int</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, <code>hits.total</code> are returned as an integer in the
response. Defaults to <code>false</code>, which returns an object.</p>
</dd>
<dt class="hdlist1"><code>routing</code></dt>
<dd>
<p>(Optional, string)
Custom <a href="mapping-fields.html#mapping-routing-field">routing value</a> used to route search operations
to a specific shard.</p>
</dd>
<dt class="hdlist1"><code>search_type</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string)
Indicates whether global term and document frequencies should be used when
scoring returned documents.</p>
</div>
<div class="paragraph">
<p>Options are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>query_then_fetch</code></dt>
<dd>
<p>(default)
Documents are scored using local term and document frequencies for the shard.
This is usually faster but less accurate.</p>
</dd>
<dt class="hdlist1"><code>dfs_query_then_fetch</code></dt>
<dd>
<p>Documents are scored using global term and document frequencies across all
shards. This is usually slower but more accurate.</p>
</dd>
</dl>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>typed_keys</code></dt>
<dd>
<p>(Optional, Boolean)
Specifies whether aggregation and suggester names should be prefixed by their
respective types in the response.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-multi-search-api-request-body">Request body</h4>
<div class="paragraph">
<p>The request body contains a newline-delimited list of search <code>&lt;header&gt;</code> and
search <code>&lt;body&gt;</code> objects.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;header&gt;</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Required, object)
Contains parameters used to limit or change the subsequent search body request.</p>
</div>
<div class="paragraph">
<p>This object is required for each search body but can be empty (<code>{}</code>) or a blank
line.</p>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>allow_no_indices</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, the request does <strong>not</strong> return an error if a wildcard expression or
<code>_all</code> value retrieves only missing or closed indices.</p>
<div class="paragraph">
<p>This parameter also applies to <a href="indices.html#indices-aliases">index aliases</a> that point to a
missing or closed index.</p>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>expand_wildcards</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code>open,hidden</code>. Valid values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>Expand to open and closed indices, including <a href="api-conventions.html#hidden-indices">hidden indices</a>.</p>
</dd>
<dt class="hdlist1"><code>open</code></dt>
<dd>
<p>Expand only to open indices.</p>
</dd>
<dt class="hdlist1"><code>closed</code></dt>
<dd>
<p>Expand only to closed indices.</p>
</dd>
<dt class="hdlist1"><code>hidden</code></dt>
<dd>
<p>Expansion of wildcards will include hidden indices.
Must be combined with <code>open</code>, <code>closed</code>, or both.</p>
</dd>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>Wildcard expressions are not accepted.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>Defaults to <code>open</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, documents from missing or closed indices are not
included in the response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>index</code></dt>
<dd>
<p>(Optional, string or array of strings)
Indices and index aliases to search. Wildcard (<code>*</code>) expressions
are supported. You can specify multiple targets as an array.</p>
<div class="paragraph">
<p>If this parameter is not specified, the <code>&lt;target&gt;</code> request path parameter
is used as a fallback.</p>
</div>
</dd>
<dt class="hdlist1"><code>preference</code></dt>
<dd>
<p>(Optional, string)
Node or shard used to perform the search. Random by default.</p>
</dd>
<dt class="hdlist1"><code>request_cache</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, the request cache can be used for this search. Defaults to
index-level settings. See <a href="settings.html#shard-request-cache">Shard request cache settings</a>.</p>
</dd>
<dt class="hdlist1"><code>routing</code></dt>
<dd>
<p>(Optional, string)
Custom <a href="mapping-fields.html#mapping-routing-field">routing value</a> used to route search operations
to a specific shard.</p>
</dd>
<dt class="hdlist1"><code>search_type</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string)
Indicates whether global term and document frequencies should be used when
scoring returned documents.</p>
</div>
<div class="paragraph">
<p>Options are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>query_then_fetch</code></dt>
<dd>
<p>(default)
Documents are scored using local term and document frequencies for the shard.
This is usually faster but less accurate.</p>
</dd>
<dt class="hdlist1"><code>dfs_query_then_fetch</code></dt>
<dd>
<p>Documents are scored using global term and document frequencies across all
shards. This is usually slower but more accurate.</p>
</dd>
</dl>
</div>
</div>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>&lt;body&gt;</code></dt>
<dd>
<p>(Optional, object)
Contains parameters for a search request:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>aggregations</code></dt>
<dd>
<p>(Optional, <a href="search-aggregations.html">aggregation object</a>)
Aggregations you wish to run during the search. See <a href="search-aggregations.html">Aggregations</a>.</p>
</dd>
<dt class="hdlist1"><code>query</code></dt>
<dd>
<p>(Optional, <a href="query-dsl.html">query DSL object</a>) Query you wish to run during the
search. Hits matching this query are returned in the response.</p>
</dd>
<dt class="hdlist1"><code>from</code></dt>
<dd>
<p>(Optional, integer)
Starting offset for returned hits. Defaults to <code>0</code>.</p>
</dd>
<dt class="hdlist1"><code>size</code></dt>
<dd>
<p>(Optional, integer)
Number of hits to return. Defaults to <code>10</code>.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-multi-search-api-response-body">Response body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>responses</code></dt>
<dd>
<p>(array) Includes the search response and status code for each search request
matching its order in the original multi search request. If there was a
complete failure for a specific search request, an object with <code>error</code> message
and corresponding status code will be returned in place of the actual search
response.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-multi-search-api-example">Examples</h4>
<div class="paragraph">
<p>The header part includes which indices, and index aliases to
search. The header also indicates the <code>search_type</code>,
<code>preference</code>, and <code>routing</code>. The body includes the typical search body request
(including the <code>query</code>, <code>aggregations</code>, <code>from</code>, <code>size</code>, and so on).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">$ cat requests
{"index" : "test"}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{"index" : "test", "search_type" : "dfs_query_then_fetch"}
{"query" : {"match_all" : {}}}
{}
{"query" : {"match_all" : {}}}

{"query" : {"match_all" : {}}}
{"search_type" : "dfs_query_then_fetch"}
{"query" : {"match_all" : {}}}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">$ curl -H "Content-Type: application/x-ndjson" -XGET localhost:9200/_msearch --data-binary "@requests"; echo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note, the above includes an example of an empty header (can also be just
without any content) which is supported as well.</p>
</div>
<div class="paragraph">
<p>The endpoint also allows you to search against indices and index
aliases in the request path. In this case, it will be used as the default target
unless explicitly specified in the header&#8217;s <code>index</code> parameter. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_msearch
{}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{}
{"query" : {"match_all" : {}}}
{"index" : "my-index-000002"}
{"query" : {"match_all" : {}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above will execute the search against the <code>my-index-000001</code> index for all the
requests that don&#8217;t define an <code>index</code> target in the request body. The last
search will be executed against the <code>my-index-000002</code> index.</p>
</div>
<div class="paragraph">
<p>The <code>search_type</code> can be set in a similar manner to globally apply to
all search requests.</p>
</div>
</div>
<div class="sect3">
<h4 id="msearch-security">Security</h4>
<div class="paragraph">
<p>See <a href="api-conventions.html#url-access-control">URL-based access control</a></p>
</div>
</div>
<div class="sect3">
<h4 id="template-msearch">Template support</h4>
<div class="paragraph">
<p>Much like described in <a href="search.html#search-template">Search Template</a> for the _search resource, _msearch
also provides support for templates. Submit them like follows for inline
templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _msearch/template
{"index" : "my-index-000001"}
{ "source" : "{ \"query\": { \"match\": { \"message\" : \"{{keywords}}\" } } } }", "params": { "query_type": "match", "keywords": "some message" } }
{"index" : "my-index-000001"}
{ "source" : "{ \"query\": { \"match_{{template}}\": {} } }", "params": { "template": "all" } }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also create search templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /_scripts/my_template_1
{
  "script": {
    "lang": "mustache",
    "source": {
      "query": {
        "match": {
          "message": "{{query_string}}"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /_scripts/my_template_2
{
  "script": {
    "lang": "mustache",
    "source": {
      "query": {
        "term": {
          "{{field}}": "{{value}}"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use search templates in a _msearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _msearch/template
{"index" : "main"}
{ "id": "my_template_1", "params": { "query_string": "some message" } }
{"index" : "main"}
{ "id": "my_template_2", "params": { "field": "user", "value": "test" } }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multi-search-partial-responses">Partial responses</h4>
<div class="paragraph">
<p>To ensure fast responses, the multi search API will respond with partial results
if one or more shards fail. See <a href="docs.html#shard-failures">Shard failures</a> for more
information.</p>
</div>
</div>
<div class="sect3">
<h4 id="msearch-cancellation">Search Cancellation</h4>
<div class="paragraph">
<p>Multi searches can be cancelled using standard <a href="cluster.html#task-cancellation">task cancellation</a>
mechanism and are also automatically cancelled when the http connection used to
perform the request is closed by the client. It is fundamental that the http
client sending requests closes connections whenever requests time out or are
aborted. Cancelling an msearch request will also cancel all of the corresponding
sub search requests.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-count">Count API</h3>
<div class="paragraph">
<p>Gets the number of matches for a search query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_count?q=user:bilbo</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The query being sent in the body must be nested in a <code>query</code> key, same as
the <a href="search.html#search-search">search API</a> works.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="search-count-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /&lt;target&gt;/_count</code></p>
</div>
</div>
<div class="sect3">
<h4 id="search-count-api-desc">Description</h4>
<div class="paragraph">
<p>The count API allows you to execute a query and get the number of matches for
that query. The query can either
be provided using a simple query string as a parameter, or using the
<a href="query-dsl.html">Query DSL</a> defined within the request body.</p>
</div>
<div class="paragraph">
<p>The count API supports <a href="api-conventions.html#multi-index">multi-target syntax</a>. You can run a single
count API search across multiple indices.</p>
</div>
<div class="paragraph">
<p>The operation is broadcast across all shards. For each shard id group, a replica
is chosen and executed against it. This means that replicas increase the
scalability of count.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-count-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;target&gt;</code></dt>
<dd>
<p>(Optional, string)
Comma-separated list of indices, and index aliases to search.
Wildcard (<code>*</code>) expressions are supported.</p>
<div class="paragraph">
<p>To search all indices in a cluster, omit this parameter or use
<code>_all</code> or <code>*</code>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-count-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>allow_no_indices</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error if any wildcard expression,
<a href="indices.html#indices-aliases">index alias</a>, or <code>_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code>foo*,bar*</code> returns an error if an index
starts with <code>foo</code> but no index starts with <code>bar</code>.</p>
<div class="paragraph">
<p>Defaults to <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>analyzer</code></dt>
<dd>
<p>(Optional, string) Analyzer to use for the query string.</p>
</dd>
<dt class="hdlist1"><code>analyze_wildcard</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, wildcard and prefix queries are
analyzed. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>default_operator</code></dt>
<dd>
<p>(Optional, string) The default operator for query string query: AND or OR.
Defaults to <code>OR</code>.</p>
</dd>
<dt class="hdlist1"><code>df</code></dt>
<dd>
<p>(Optional, string) Field to use as default where no field prefix is
given in the query string.</p>
</dd>
<dt class="hdlist1"><code>expand_wildcards</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code>open,hidden</code>. Valid values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>Expand to open and closed indices, including <a href="api-conventions.html#hidden-indices">hidden indices</a>.</p>
</dd>
<dt class="hdlist1"><code>open</code></dt>
<dd>
<p>Expand only to open indices.</p>
</dd>
<dt class="hdlist1"><code>closed</code></dt>
<dd>
<p>Expand only to closed indices.</p>
</dd>
<dt class="hdlist1"><code>hidden</code></dt>
<dd>
<p>Expansion of wildcards will include hidden indices.
Must be combined with <code>open</code>, <code>closed</code>, or both.</p>
</dd>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>Wildcard expressions are not accepted.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>Defaults to <code>open</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>ignore_throttled</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, concrete, expanded or aliased indices are
ignored when frozen. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, missing or closed indices are not included in the
response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>lenient</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, format-based query failures (such as
providing text to a numeric field) will be ignored. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>min_score</code></dt>
<dd>
<p>(Optional, float)
  Sets the minimum <code>_score</code> value that documents must have to be included in the
  result.</p>
</dd>
<dt class="hdlist1"><code>preference</code></dt>
<dd>
<p>(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.</p>
</dd>
<dt class="hdlist1"><code>q</code></dt>
<dd>
<p>(Optional, string) Query in the Lucene query string syntax.</p>
</dd>
<dt class="hdlist1"><code>routing</code></dt>
<dd>
<p>(Optional, string) Target the specified primary shard.</p>
</dd>
<dt class="hdlist1"><code>terminate_after</code></dt>
<dd>
<p>(Optional, integer) The maximum number of documents to collect for each shard,
upon reaching which the query execution will terminate early.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-count-request-body">Request body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>query</code></dt>
<dd>
<p>(Optional, <a href="query-dsl.html">query object</a>) Defines the search definition using the
<a href="query-dsl.html">Query DSL</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-count-api-example">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /my-index-000001/_doc/1?refresh
{
  "user.id": "bilbo"
}

GET /my-index-000001/_count?q=user:bilbo

GET /my-index-000001/_count
{
  "query" : {
    "term" : { "user.id" : "bilbo" }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both examples above do the same: count the number of documents in
<code>my-index-000001</code> with a <code>user.id</code> of <code>bilbo</code>. The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "count": 1,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query is optional, and when not provided, it will use <code>match_all</code> to
count all the docs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-validate">Validate API</h3>
<div class="paragraph">
<p>Validates a potentially expensive query without executing it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_validate/query?q=user.id:bilbo</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="search-validate-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /&lt;target&gt;/_validate/&lt;query&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="search-validate-api-desc">Description</h4>
<div class="paragraph">
<p>The validate API allows you to validate a potentially expensive query
without executing it. The query can be sent either as a path parameter or in the
request body.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-validate-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;target&gt;</code></dt>
<dd>
<p>(Optional, string)
Comma-separated list of indices, and index aliases to search.
Wildcard (<code>*</code>) expressions are supported.</p>
<div class="paragraph">
<p>To search all indices in a cluster, omit this parameter or use
<code>_all</code> or <code>*</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>query</code></dt>
<dd>
<p>(Optional, <a href="query-dsl.html">query object</a>) Defines the search definition using the
<a href="query-dsl.html">Query DSL</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-validate-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all_shards</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, the validation is executed on all shards
instead of one random shard per index. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>allow_no_indices</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error if any wildcard expression,
<a href="indices.html#indices-aliases">index alias</a>, or <code>_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code>foo*,bar*</code> returns an error if an index
starts with <code>foo</code> but no index starts with <code>bar</code>.</p>
<div class="paragraph">
<p>Defaults to <code>false</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>analyzer</code></dt>
<dd>
<p>(Optional, string) Analyzer to use for the query string.</p>
</dd>
<dt class="hdlist1"><code>analyze_wildcard</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, wildcard and prefix queries are
analyzed. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>default_operator</code></dt>
<dd>
<p>(Optional, string) The default operator for query string query: AND or OR.
Defaults to <code>OR</code>.</p>
</dd>
<dt class="hdlist1"><code>df</code></dt>
<dd>
<p>(Optional, string) Field to use as default where no field prefix is
given in the query string.</p>
</dd>
<dt class="hdlist1"><code>expand_wildcards</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code>open,hidden</code>. Valid values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>Expand to open and closed indices, including <a href="api-conventions.html#hidden-indices">hidden indices</a>.</p>
</dd>
<dt class="hdlist1"><code>open</code></dt>
<dd>
<p>Expand only to open indices.</p>
</dd>
<dt class="hdlist1"><code>closed</code></dt>
<dd>
<p>Expand only to closed indices.</p>
</dd>
<dt class="hdlist1"><code>hidden</code></dt>
<dd>
<p>Expansion of wildcards will include hidden indices.
Must be combined with <code>open</code>, <code>closed</code>, or both.</p>
</dd>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>Wildcard expressions are not accepted.</p>
</dd>
</dl>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>explain</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, the response returns detailed information if an
error has occurred. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, missing or closed indices are not included in the
response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>lenient</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, format-based query failures (such as
providing text to a numeric field) will be ignored. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>rewrite</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, returns a more detailed explanation showing the
actual Lucene query that will be executed. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>q</code></dt>
<dd>
<p>(Optional, string) Query in the Lucene query string syntax.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-validate-api-example">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT my-index-000001/_bulk?refresh
{"index":{"_id":1}}
{"user" : { "id": "bilbo" }, "@timestamp" : "2099-11-15T14:12:12", "message" : "Trying out OpenSearch."}
{"index":{"_id":2}}
{"user" : { "id": "bilba" }, "@timestamp" : "2099-11-15T14:12:13", "message" : "Similar to Bilbo."}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When sent a valid query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_validate/query?q=user.id:bilbo</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response contains <code>valid:true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{"_shards":{"total":1,"successful":1,"failed":0},"valid":true}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query may also be sent in the request body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_validate/query
{
  "query" : {
    "bool" : {
      "must" : {
        "query_string" : {
          "query" : "*:*"
        }
      },
      "filter" : {
        "term" : { "user.id" : "bilbo" }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The query being sent in the body must be nested in a <code>query</code> key, same as
the <a href="search.html#search-search">search api</a> works
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the query is invalid, <code>valid</code> will be <code>false</code>. Here the query is invalid
because OpenSearch knows the <code>post_date</code> field should be a date due to dynamic
mapping, and 'foo' does not correctly parse into a date:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_validate/query
{
  "query": {
    "query_string": {
      "query": "@timestamp:foo",
      "lenient": false
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{"_shards":{"total":1,"successful":1,"failed":0},"valid":false}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_the_explain_parameter">The explain parameter</h5>
<div class="paragraph">
<p>An <code>explain</code> parameter can be specified to get more detailed information about
why a query failed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_validate/query?explain=true
{
  "query": {
    "query_string": {
      "query": "@timestamp:foo",
      "lenient": false
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0
  },
  "valid": false,
  "explanations": [{
    "index": "my-index-000001",
    "valid": false,
    "error": "[my-index-000001/1Nf0oygTT6ypNZs1q3mf0w] QueryShardException[failed to create query...failed to parse date field [foo]"
  }]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_rewrite_parameter">The rewrite parameter</h5>
<div class="paragraph">
<p>When the query is valid, the explanation defaults to the string representation
of that query. With <code>rewrite</code> set to <code>true</code>, the explanation is more detailed
showing the actual Lucene query that will be executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_validate/query?rewrite=true
{
  "query": {
    "more_like_this": {
      "like": {
        "_id": "2"
      },
      "boost_terms": 1
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
   "valid": true,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "explanations": [
      {
         "index": "my-index-000001",
         "valid": true,
         "explanation": "((user:terminator^3.71334 plot:future^2.763601 plot:human^2.8415773 plot:sarah^3.4193945 plot:kyle^3.8244398 plot:cyborg^3.9177752 plot:connor^4.040236 plot:reese^4.7133346 ... )~6) -ConstantScore(_id:2)) #(ConstantScore(_type:_doc))^0.0"
      }
   ]
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rewrite_and_all_shards_parameters">Rewrite and all_shards parameters</h5>
<div class="paragraph">
<p>By default, the request is executed on a single shard only, which is randomly
selected. The detailed explanation of the query may depend on which shard is
being hit, and therefore may vary from one request to another. So, in case of
query rewrite the <code>all_shards</code> parameter should be used to get response from
all available shards.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_validate/query?rewrite=true&amp;all_shards=true
{
  "query": {
    "match": {
      "user.id": {
        "query": "bilbo",
        "fuzziness": "auto"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0
  },
  "valid": true,
  "explanations": [{
    "index": "my-index-000001",
    "shard": 0,
    "valid": true,
    "explanation": "(user.id:bilba)^0.8 user.id:bilbo"
  }]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-explain">Explain API</h3>
<div class="paragraph">
<p>Returns information about why a specific document matches (or doesn&#8217;t match) a
query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_explain/0
{
  "query" : {
    "match" : { "message" : "opensearch" }
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="search-explain-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /&lt;index&gt;/_explain/&lt;id&gt;</code></p>
</div>
<div class="paragraph">
<p><code>POST /&lt;index&gt;/_explain/&lt;id&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="search-explain-api-desc">Description</h4>
<div class="paragraph">
<p>The explain API computes a score explanation for a query and a specific
document. This can give useful feedback whether a document matches or
didn&#8217;t match a specific query.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-explain-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;id&gt;</code></dt>
<dd>
<p>(Required, integer) Defines the document ID.</p>
</dd>
<dt class="hdlist1"><code>&lt;index&gt;</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Required, string)
Index names used to limit the request.</p>
</div>
<div class="paragraph">
<p>Only a single index name can be provided to this parameter.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-explain-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>analyzer</code></dt>
<dd>
<p>(Optional, string) Analyzer to use for the query string.</p>
</dd>
<dt class="hdlist1"><code>analyze_wildcard</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, wildcard and prefix queries are
analyzed. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>default_operator</code></dt>
<dd>
<p>(Optional, string) The default operator for query string query: AND or OR.
Defaults to <code>OR</code>.</p>
</dd>
<dt class="hdlist1"><code>df</code></dt>
<dd>
<p>(Optional, string) Field to use as default where no field prefix is
given in the query string.</p>
</dd>
<dt class="hdlist1"><code>lenient</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, format-based query failures (such as
providing text to a numeric field) will be ignored. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>preference</code></dt>
<dd>
<p>(Optional, string) Specifies the node or shard the operation should be
performed on. Random by default.</p>
</dd>
<dt class="hdlist1"><code>q</code></dt>
<dd>
<p>(Optional, string) Query in the Lucene query string syntax.</p>
</dd>
<dt class="hdlist1"><code>stored_fields</code></dt>
<dd>
<p>(Optional, string) A comma-separated list of stored fields to return in the
response.</p>
</dd>
<dt class="hdlist1"><code>routing</code></dt>
<dd>
<p>(Optional, string)
Custom <a href="mapping-fields.html#mapping-routing-field">routing value</a>
used to route operations to a specific shard.</p>
</dd>
<dt class="hdlist1"><code>_source</code></dt>
<dd>
<p>(Optional, string) True or false to return the <code>_source</code> field or not, or a
list of fields to return.</p>
</dd>
<dt class="hdlist1"><code>_source_excludes</code></dt>
<dd>
<p>(Optional, string)
A comma-separated list of <a href="mapping-fields.html#mapping-source-field">source fields</a> to exclude from
the response.</p>
<div class="paragraph">
<p>You can also use this parameter to exclude fields from the subset specified in
<code>_source_includes</code> query parameter.</p>
</div>
<div class="paragraph">
<p>If the <code>_source</code> parameter is <code>false</code>, this parameter is ignored.</p>
</div>
</dd>
<dt class="hdlist1"><code>_source_includes</code></dt>
<dd>
<p>(Optional, string)
A comma-separated list of <a href="mapping-fields.html#mapping-source-field">source fields</a> to
include in the response.</p>
<div class="paragraph">
<p>If this parameter is specified, only these source fields are returned. You can
exclude fields from this subset using the <code>_source_excludes</code> query parameter.</p>
</div>
<div class="paragraph">
<p>If the <code>_source</code> parameter is <code>false</code>, this parameter is ignored.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-explain-api-request-body">Request body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>query</code></dt>
<dd>
<p>(Optional, <a href="query-dsl.html">query object</a>) Defines the search definition using the
<a href="query-dsl.html">Query DSL</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-explain-api-example">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_explain/0
{
  "query" : {
    "match" : { "message" : "opensearch" }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
   "_index":"my-index-000001",
   "_type":"_doc",
   "_id":"0",
   "matched":true,
   "explanation":{
      "value":1.6943598,
      "description":"weight(message:opensearch in 0) [PerFieldSimilarity], result of:",
      "details":[
         {
            "value":1.6943598,
            "description":"score(freq=1.0), computed as boost * idf * tf from:",
            "details":[
               {
                  "value":2.2,
                  "description":"boost",
                  "details":[]
               },
               {
                  "value":1.3862944,
                  "description":"idf, computed as log(1 + (N - n + 0.5) / (n + 0.5)) from:",
                  "details":[
                     {
                        "value":1,
                        "description":"n, number of documents containing term",
                        "details":[]
                     },
                     {
                        "value":5,
                        "description":"N, total number of documents with field",
                        "details":[]
                     }
                  ]
               },
               {
                  "value":0.5555556,
                  "description":"tf, computed as freq / (freq + k1 * (1 - b + b * dl / avgdl)) from:",
                  "details":[
                     {
                        "value":1.0,
                        "description":"freq, occurrences of term within document",
                        "details":[]
                     },
                     {
                        "value":1.2,
                        "description":"k1, term saturation parameter",
                        "details":[]
                     },
                     {
                        "value":0.75,
                        "description":"b, length normalization parameter",
                        "details":[]
                     },
                     {
                        "value":3.0,
                        "description":"dl, length of field",
                        "details":[]
                     },
                     {
                        "value":5.4,
                        "description":"avgdl, average length of field",
                        "details":[]
                     }
                  ]
               }
            ]
         }
      ]
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a simpler way of specifying the query via the <code>q</code> parameter. The
specified <code>q</code> parameter value is then parsed as if the <code>query_string</code> query was
used. Example usage of the <code>q</code> parameter in the
explain API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_explain/0?q=message:search</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the same result as the previous request.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-profile">Profile API</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The Profile API is a debugging tool and adds significant overhead to search execution.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Provides detailed timing information about the execution of individual
components in a search request.</p>
</div>
<div class="sect3">
<h4 id="search-profile-api-desc">Description</h4>
<div class="paragraph">
<p>The Profile API gives the user insight into how search requests are executed at
a low level so that the user can understand why certain requests are slow, and
take steps to improve them. Note that the Profile API,
<a href="search.html#profile-limitations">amongst other things</a>, doesn&#8217;t measure network latency,
time spent in the search fetch phase, time spent while the requests spends in
queues or while merging shard responses on the coordinating node.</p>
</div>
<div class="paragraph">
<p>The output from the Profile API is <strong>very</strong> verbose, especially for complicated
requests executed across many shards. Pretty-printing the response is
recommended to help understand the output.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-profile-api-example">Examples</h4>
<div class="paragraph">
<p>Any <code>_search</code> request can be profiled by adding a top-level <code>profile</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_search
{
  "profile": true,<b class="conum">(1)</b>
  "query" : {
    "match" : { "message" : "GET /search" }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Setting the top-level <code>profile</code> parameter to <code>true</code> will enable profiling
for the search.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The API returns the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "took": 25,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 5,
      "relation": "eq"
    },
    "max_score": 0.17402273,
    "hits": [...] <b class="conum">(1)</b>
  },
  "profile": {
    "shards": [
      {
        "id": "[2aE02wS1R8q_QFnYu6vDVQ][my-index-000001][0]",
        "searches": [
          {
            "query": [
              {
                "type": "BooleanQuery",
                "description": "message:get
                message:search", "time_in_nanos" : 11972972, "breakdown" :
                {
                  "set_min_competitive_score_count": 0,
                  "match_count": 5,
                  "shallow_advance_count": 0,
                  "set_min_competitive_score": 0,
                  "next_doc": 39022,
                  "match": 4456,
                  "next_doc_count": 5,
                  "score_count": 5,
                  "compute_max_score_count": 0,
                  "compute_max_score": 0,
                  "advance": 84525,
                  "advance_count": 1,
                  "score": 37779,
                  "build_scorer_count": 2,
                  "create_weight": 4694895,
                  "shallow_advance": 0,
                  "create_weight_count": 1,
                  "build_scorer": 7112295
                },
                "children": [
                  {
                    "type": "TermQuery",
                    "description": "message:get",
                    "time_in_nanos": 3801935,
                    "breakdown": {
                      "set_min_competitive_score_count": 0,
                      "match_count": 0,
                      "shallow_advance_count": 3,
                      "set_min_competitive_score": 0,
                      "next_doc": 0,
                      "match": 0,
                      "next_doc_count": 0,
                      "score_count": 5,
                      "compute_max_score_count": 3,
                      "compute_max_score": 32487,
                      "advance": 5749,
                      "advance_count": 6,
                      "score": 16219,
                      "build_scorer_count": 3,
                      "create_weight": 2382719,
                      "shallow_advance": 9754,
                      "create_weight_count": 1,
                      "build_scorer": 1355007
                    }
                  },
                  {
                    "type": "TermQuery",
                    "description": "message:search",
                    "time_in_nanos": 205654,
                    "breakdown": {
                      "set_min_competitive_score_count": 0,
                      "match_count": 0,
                      "shallow_advance_count": 3,
                      "set_min_competitive_score": 0,
                      "next_doc": 0,
                      "match": 0,
                      "next_doc_count": 0,
                      "score_count": 5,
                      "compute_max_score_count": 3,
                      "compute_max_score": 6678,
                      "advance": 12733,
                      "advance_count": 6,
                      "score": 6627,
                      "build_scorer_count": 3,
                      "create_weight": 130951,
                      "shallow_advance": 2512,
                      "create_weight_count": 1,
                      "build_scorer": 46153
                    }
                  }
                ]
              }
            ],
            "rewrite_time": 451233,
            "collector": [
              {
                "name": "SimpleTopScoreDocCollector",
                "reason": "search_top_hits",
                "time_in_nanos": 775274
              }
            ]
          }
        ],
        "aggregations": []
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Search results are returned, but were omitted here for brevity.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Even for a simple query, the response is relatively complicated.  Let&#8217;s break it
down piece-by-piece before moving to more complex examples.</p>
</div>
<div class="paragraph">
<p>The overall structure of the profile response is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
   "profile": {
        "shards": [
           {
              "id": "[2aE02wS1R8q_QFnYu6vDVQ][my-index-000001][0]",  <b class="conum">(1)</b>
              "searches": [
                 {
                    "query": [...],             <b class="conum">(2)</b>
                    "rewrite_time": 51443,      <b class="conum">(3)</b>
                    "collector": [...]          <b class="conum">(4)</b>
                 }
              ],
              "aggregations": [...]             <b class="conum">(5)</b>
           }
        ]
     }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A profile is returned for each shard that participated in the response, and
is identified by a unique ID.</p>
</li>
<li>
<p>Each profile contains a section which holds details about the query
execution.</p>
</li>
<li>
<p>Each profile has a single time representing the cumulative rewrite time.</p>
</li>
<li>
<p>Each profile also contains a section about the Lucene Collectors which run
the search.</p>
</li>
<li>
<p>Each profile contains a section which holds the details about the
aggregation execution.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Because a search request may be executed against one or more shards in an index,
and a search may cover one or more indices, the top level element in the profile
response is an array of <code>shard</code> objects. Each shard object lists its <code>id</code> which
uniquely identifies the shard.  The ID&#8217;s format is
<code>[nodeID][indexName][shardID]</code>.</p>
</div>
<div class="paragraph">
<p>The profile itself may consist of one or more "searches", where a search is a
query executed against the underlying Lucene index.  Most search requests
submitted by the user will only execute a single <code>search</code> against the Lucene
index. But occasionally multiple searches will be executed, such as including a
global aggregation (which needs to execute a secondary "match_all" query for the
global context).</p>
</div>
<div class="paragraph">
<p>Inside each <code>search</code> object there will be two arrays of profiled information:
a <code>query</code> array and a <code>collector</code> array.  Alongside the <code>search</code> object is an
<code>aggregations</code> object that contains the profile information for the
aggregations. In the future, more sections may be added, such as <code>suggest</code>,
<code>highlight</code>, etc.</p>
</div>
<div class="paragraph">
<p>There will also be a <code>rewrite</code> metric showing the total time spent rewriting the
query (in nanoseconds).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As with other statistics apis, the Profile API supports human readable outputs. This can be turned on by adding
<code>?human=true</code> to the query string. In this case, the output contains the additional <code>time</code> field containing rounded,
human readable timing information (e.g. <code>"time": "391,9ms"</code>, <code>"time": "123.3micros"</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="profiling-queries">Profiling Queries</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The details provided by the Profile API directly expose Lucene class names and concepts, which means
that complete interpretation of the results require fairly advanced knowledge of Lucene.  This
page attempts to give a crash-course in how Lucene executes queries so that you can use the Profile API to successfully
diagnose and debug queries, but it is only an overview.  For complete understanding, please refer
to Lucene&#8217;s documentation and, in places, the code.</p>
</div>
<div class="paragraph">
<p>With that said, a complete understanding is often not required to fix a slow query.  It is usually
sufficient to see that a particular component of a query is slow, and not necessarily understand why
the <code>advance</code> phase of that query is the cause, for example.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="query-section"><code>query</code> Section</h5>
<div class="paragraph">
<p>The <code>query</code> section contains detailed timing of the query tree executed by
Lucene on a particular shard. The overall structure of this query tree will
resemble your original OpenSearch query, but may be slightly (or sometimes
very) different.  It will also use similar but not always identical naming.
Using our previous <code>match</code> query example, let&#8217;s analyze the <code>query</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">"query": [
    {
       "type": "BooleanQuery",
       "description": "message:get message:search",
       "time_in_nanos": "11972972",
       "breakdown": {...},               <b class="conum">(1)</b>
       "children": [
          {
             "type": "TermQuery",
             "description": "message:get",
             "time_in_nanos": "3801935",
             "breakdown": {...}
          },
          {
             "type": "TermQuery",
             "description": "message:search",
             "time_in_nanos": "205654",
             "breakdown": {...}
          }
       ]
    }
]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The breakdown timings are omitted for simplicity.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Based on the profile structure, we can see that our <code>match</code> query was rewritten
by Lucene into a BooleanQuery with two clauses (both holding a TermQuery).  The
<code>type</code> field displays the Lucene class name, and often aligns with the
equivalent name in OpenSearch.  The <code>description</code> field displays the Lucene
explanation text for the query, and is made available to help differentiating
between parts of your query (e.g. both <code>message:get</code> and <code>message:search</code> are
TermQuery&#8217;s and would appear identical otherwise.</p>
</div>
<div class="paragraph">
<p>The <code>time_in_nanos</code> field shows that this query took ~11.9ms for the entire
BooleanQuery to execute.  The recorded time is inclusive of all children.</p>
</div>
<div class="paragraph">
<p>The <code>breakdown</code> field will give detailed stats about how the time was spent,
we&#8217;ll look at that in a moment.  Finally, the <code>children</code> array lists any
sub-queries that may be present.  Because we searched for two values ("get
search"), our BooleanQuery holds two children TermQueries.  They have identical
information (type, time, breakdown, etc).  Children are allowed to have their
own children.</p>
</div>
</div>
<div class="sect4">
<h5 id="_timing_breakdown">Timing Breakdown</h5>
<div class="paragraph">
<p>The <code>breakdown</code> component lists detailed timing statistics about low-level
Lucene execution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">"breakdown": {
  "set_min_competitive_score_count": 0,
  "match_count": 5,
  "shallow_advance_count": 0,
  "set_min_competitive_score": 0,
  "next_doc": 39022,
  "match": 4456,
  "next_doc_count": 5,
  "score_count": 5,
  "compute_max_score_count": 0,
  "compute_max_score": 0,
  "advance": 84525,
  "advance_count": 1,
  "score": 37779,
  "build_scorer_count": 2,
  "create_weight": 4694895,
  "shallow_advance": 0,
  "create_weight_count": 1,
  "build_scorer": 7112295
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Timings are listed in wall-clock nanoseconds and are not normalized at all. All
caveats about the overall <code>time_in_nanos</code> apply here.  The intention of the
breakdown is to give you a feel for A) what machinery in Lucene is actually
eating time, and B) the magnitude of differences in times between the various
components. Like the overall time, the breakdown is inclusive of all children
times.</p>
</div>
<div class="paragraph">
<p>The meaning of the stats are as follows:</p>
</div>
<h5 id="_all_parameters" class="discrete">All parameters:</h5>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>create_weight</code>
</td>
<td class="hdlist2">
<p>A Query in Lucene must be capable of reuse across multiple IndexSearchers (think of it as the engine that
executes a search against a specific Lucene Index).  This puts Lucene in a tricky spot, since many queries
need to accumulate temporary state/statistics associated with the index it is being used against, but the
Query contract mandates that it must be immutable.
<br>
<br>
To get around this, Lucene asks each query to generate a Weight object which acts as a temporary context
object to hold state associated with this particular (IndexSearcher, Query) tuple.  The <code>weight</code> metric
shows how long this process takes</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>build_scorer</code>
</td>
<td class="hdlist2">
<p>This parameter shows how long it takes to build a Scorer for the query.  A Scorer is the mechanism that
iterates over matching documents and generates a score per-document (e.g. how well does "foo" match the document?).
Note, this records the time required to generate the Scorer object, not actually score the documents.  Some
queries have faster or slower initialization of the Scorer, depending on optimizations, complexity, etc.
<br>
<br>
This may also show timing associated with caching, if enabled and/or applicable for the query</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>next_doc</code>
</td>
<td class="hdlist2">
<p>The Lucene method <code>next_doc</code> returns Doc ID of the next document matching the query.  This statistic shows
the time it takes to determine which document is the next match, a process that varies considerably depending
on the nature of the query.   Next_doc is a specialized form of advance() which is more convenient for many
queries in Lucene.  It is equivalent to advance(docId() + 1)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>advance</code>
</td>
<td class="hdlist2">
<p><code>advance</code> is the "lower level" version of next_doc: it serves the same purpose of finding the next matching
doc, but requires the calling query to perform extra tasks such as identifying and moving past skips, etc.
However,  not all queries can use next_doc, so <code>advance</code> is also timed for those queries.
<br>
<br>
Conjunctions (e.g. <code>must</code> clauses in a Boolean) are typical consumers of <code>advance</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>match</code>
</td>
<td class="hdlist2">
<p>Some queries, such as phrase queries, match documents using a "two-phase" process.  First, the document is
"approximately" matched, and if it matches approximately, it is checked a second time with a more rigorous
(and expensive) process.  The second phase verification is what the <code>match</code> statistic measures.
<br>
<br>
For example, a phrase query first checks a document approximately by ensuring all terms in the phrase are
present in the doc.  If all the terms are present, it then executes the second phase verification to ensure
the terms are in-order to form the phrase, which is relatively more expensive than just checking for presence
of the terms.
<br>
<br>
Because this two-phase process is only used by a handful of queries, the <code>match</code> statistic is often zero</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>score</code>
</td>
<td class="hdlist2">
<p>This records the time taken to score a particular document via its Scorer</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>*_count</code>
</td>
<td class="hdlist2">
<p>Records the number of invocations of the particular method.  For example, <code>"next_doc_count": 2,</code>
means the <code>nextDoc()</code> method was called on two different documents.  This can be used to help judge
how selective queries are, by comparing counts between different query components.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="collectors-section"><code>collectors</code> Section</h5>
<div class="paragraph">
<p>The Collectors portion of the response shows high-level execution details.
Lucene works by defining a "Collector" which is responsible for coordinating the
traversal, scoring, and collection of matching documents.  Collectors are also
how a single query can record aggregation results, execute unscoped "global"
queries, execute post-query filters, etc.</p>
</div>
<div class="paragraph">
<p>Looking at the previous example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">"collector": [
  {
    "name": "SimpleTopScoreDocCollector",
    "reason": "search_top_hits",
    "time_in_nanos": 775274
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see a single collector named <code>SimpleTopScoreDocCollector</code> wrapped into
<code>CancellableCollector</code>. <code>SimpleTopScoreDocCollector</code> is the default "scoring and
sorting" <code>Collector</code> used by OpenSearch. The <code>reason</code> field attempts to give a plain
English description of the class name.  The <code>time_in_nanos</code> is similar to the
time in the Query tree: a wall-clock time inclusive of all children. Similarly,
<code>children</code> lists all sub-collectors. The <code>CancellableCollector</code> that wraps
<code>SimpleTopScoreDocCollector</code> is used by OpenSearch to detect if the current search was
cancelled and stop collecting documents as soon as it occurs.</p>
</div>
<div class="paragraph">
<p>It should be noted that Collector times are <strong>independent</strong> from the Query
times.  They are calculated, combined, and normalized independently! Due to the
nature of Lucene&#8217;s execution, it is impossible to "merge" the times from the
Collectors into the Query section, so they are displayed in separate portions.</p>
</div>
<div class="paragraph">
<p>For reference, the various collector reasons are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>search_sorted</code>
</td>
<td class="hdlist2">
<p>A collector that scores and sorts documents.  This is the most common collector and will be seen in most
simple searches</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>search_count</code>
</td>
<td class="hdlist2">
<p>A collector that only counts the number of documents that match the query, but does not fetch the source.
This is seen when <code>size: 0</code> is specified</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>search_terminate_after_count</code>
</td>
<td class="hdlist2">
<p>A collector that terminates search execution after <code>n</code> matching documents have been found.  This is seen
when the <code>terminate_after_count</code> query parameter has been specified</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>search_min_score</code>
</td>
<td class="hdlist2">
<p>A collector that only returns matching documents that have a score greater than <code>n</code>.  This is seen when
the top-level parameter <code>min_score</code> has been specified.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>search_multi</code>
</td>
<td class="hdlist2">
<p>A collector that wraps several other collectors.  This is seen when combinations of search, aggregations,
global aggs, and post_filters are combined in a single search.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>search_timeout</code>
</td>
<td class="hdlist2">
<p>A collector that halts execution after a specified period of time.  This is seen when a <code>timeout</code> top-level
parameter has been specified.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>aggregation</code>
</td>
<td class="hdlist2">
<p>A collector that OpenSearch uses to run aggregations against the query scope.  A single <code>aggregation</code>
collector is used to collect documents for <strong>all</strong> aggregations, so you will see a list of aggregations
in the name rather.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>global_aggregation</code>
</td>
<td class="hdlist2">
<p>A collector that executes an aggregation against the global query scope, rather than the specified query.
Because the global scope is necessarily different from the executed query, it must execute its own
match_all query (which you will see added to the Query section) to collect your entire dataset</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="rewrite-section"><code>rewrite</code> Section</h5>
<div class="paragraph">
<p>All queries in Lucene undergo a "rewriting" process.  A query (and its
sub-queries) may be rewritten one or more times, and the process continues until
the query stops changing.  This process allows Lucene to perform optimizations,
such as removing redundant clauses, replacing one query for a more efficient
execution path, etc. For example a Boolean &#8594; Boolean &#8594; TermQuery can be
rewritten to a TermQuery, because all the Booleans are unnecessary in this case.</p>
</div>
<div class="paragraph">
<p>The rewriting process is complex and difficult to display, since queries can
change drastically. Rather than showing the intermediate results, the total
rewrite time is simply displayed as a value (in nanoseconds). This value is
cumulative and contains the total time for all queries being rewritten.</p>
</div>
</div>
<div class="sect4">
<h5 id="_a_more_complex_example">A more complex example</h5>
<div class="paragraph">
<p>To demonstrate a slightly more complex query and the associated results, we can
profile the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_search
{
  "profile": true,
  "query": {
    "term": {
      "user.id": {
        "value": "elkbee"
      }
    }
  },
  "aggs": {
    "my_scoped_agg": {
      "terms": {
        "field": "http.response.status_code"
      }
    },
    "my_global_agg": {
      "global": {},
      "aggs": {
        "my_level_agg": {
          "terms": {
            "field": "http.response.status_code"
          }
        }
      }
    }
  },
  "post_filter": {
    "match": {
      "message": "search"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example has:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A query</p>
</li>
<li>
<p>A scoped aggregation</p>
</li>
<li>
<p>A global aggregation</p>
</li>
<li>
<p>A post_filter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The API returns the following result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  ...
  "profile": {
    "shards": [
      {
        "id": "[P6-vulHtQRWuD4YnubWb7A][my-index-000001][0]",
        "searches": [
          {
            "query": [
              {
                "type": "TermQuery",
                "description": "message:search",
                "time_in_nanos": 141618,
                "breakdown": {
                  "set_min_competitive_score_count": 0,
                  "match_count": 0,
                  "shallow_advance_count": 0,
                  "set_min_competitive_score": 0,
                  "next_doc": 0,
                  "match": 0,
                  "next_doc_count": 0,
                  "score_count": 0,
                  "compute_max_score_count": 0,
                  "compute_max_score": 0,
                  "advance": 3942,
                  "advance_count": 4,
                  "score": 0,
                  "build_scorer_count": 2,
                  "create_weight": 38380,
                  "shallow_advance": 0,
                  "create_weight_count": 1,
                  "build_scorer": 99296
                }
              },
              {
                "type": "TermQuery",
                "description": "user.id:elkbee",
                "time_in_nanos": 163081,
                "breakdown": {
                  "set_min_competitive_score_count": 0,
                  "match_count": 0,
                  "shallow_advance_count": 0,
                  "set_min_competitive_score": 0,
                  "next_doc": 2447,
                  "match": 0,
                  "next_doc_count": 4,
                  "score_count": 4,
                  "compute_max_score_count": 0,
                  "compute_max_score": 0,
                  "advance": 3552,
                  "advance_count": 1,
                  "score": 5027,
                  "build_scorer_count": 2,
                  "create_weight": 107840,
                  "shallow_advance": 0,
                  "create_weight_count": 1,
                  "build_scorer": 44215
                }
              }
            ],
            "rewrite_time": 4769,
            "collector": [
              {
                "name": "MultiCollector",
                "reason": "search_multi",
                "time_in_nanos": 1945072,
                "children": [
                  {
                    "name": "FilteredCollector",
                    "reason": "search_post_filter",
                    "time_in_nanos": 500850,
                    "children": [
                      {
                        "name": "SimpleTopScoreDocCollector",
                        "reason": "search_top_hits",
                        "time_in_nanos": 22577
                      }
                    ]
                  },
                  {
                    "name": "MultiBucketCollector: [[my_scoped_agg, my_global_agg]]",
                    "reason": "aggregation",
                    "time_in_nanos": 867617
                  }
                ]
              }
            ]
          }
        ],
        "aggregations": [...] <b class="conum">(1)</b>
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>"aggregations"</code> portion has been omitted because it will be covered in
the next section.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As you can see, the output is significantly more verbose than before.  All the
major portions of the query are represented:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first <code>TermQuery</code> (user.id:elkbee) represents the main <code>term</code> query.</p>
</li>
<li>
<p>The second <code>TermQuery</code> (message:search) represents the <code>post_filter</code> query.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Collector tree is fairly straightforward, showing how a single
CancellableCollector wraps a MultiCollector which also wraps a FilteredCollector
to execute the post_filter (and in turn wraps the normal scoring
SimpleCollector), a BucketCollector to run all scoped aggregations.</p>
</div>
</div>
<div class="sect4">
<h5 id="_understanding_multitermquery_output">Understanding MultiTermQuery output</h5>
<div class="paragraph">
<p>A special note needs to be made about the <code>MultiTermQuery</code> class of queries.
This includes wildcards, regex, and fuzzy queries. These queries emit very
verbose responses, and are not overly structured.</p>
</div>
<div class="paragraph">
<p>Essentially, these queries rewrite themselves on a per-segment basis. If you
imagine the wildcard query <code>b*</code>, it technically can match any token that begins
with the letter "b".  It would be impossible to enumerate all possible
combinations, so Lucene rewrites the query in context of the segment being
evaluated, e.g., one segment may contain the tokens <code>[bar, baz]</code>, so the query
rewrites to a BooleanQuery combination of "bar" and "baz".  Another segment may
only have the token <code>[bakery]</code>, so the query rewrites to a single TermQuery for
"bakery".</p>
</div>
<div class="paragraph">
<p>Due to this dynamic, per-segment rewriting, the clean tree structure becomes
distorted and no longer follows a clean "lineage" showing how one query rewrites
into the next.  At present time, all we can do is apologize, and suggest you
collapse the details for that query&#8217;s children if it is too confusing. Luckily,
all the timing statistics are correct, just not the physical layout in the
response, so it is sufficient to just analyze the top-level MultiTermQuery and
ignore its children if you find the details too tricky to interpret.</p>
</div>
<div class="paragraph">
<p>Hopefully this will be fixed in future iterations, but it is a tricky problem to
solve and still in-progress. :)</p>
</div>
</div>
<div class="sect4">
<h5 id="profiling-aggregations">Profiling Aggregations</h5>
<div class="sect5">
<h6 id="agg-section"><code>aggregations</code> Section</h6>
<div class="paragraph">
<p>The <code>aggregations</code> section contains detailed timing of the aggregation tree
executed by a particular shard. The overall structure of this aggregation tree
will resemble your original OpenSearch request. Let&#8217;s execute the previous query again
and look at the aggregation profile this time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_search
{
  "profile": true,
  "query": {
    "term": {
      "user.id": {
        "value": "elkbee"
      }
    }
  },
  "aggs": {
    "my_scoped_agg": {
      "terms": {
        "field": "http.response.status_code"
      }
    },
    "my_global_agg": {
      "global": {},
      "aggs": {
        "my_level_agg": {
          "terms": {
            "field": "http.response.status_code"
          }
        }
      }
    }
  },
  "post_filter": {
    "match": {
      "message": "search"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This yields the following aggregation profile output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "profile": {
    "shards": [
      {
        "aggregations": [
          {
            "type": "NumericTermsAggregator",
            "description": "my_scoped_agg",
            "time_in_nanos": 79294,
            "breakdown": {
              "reduce": 0,
              "build_aggregation": 30885,
              "build_aggregation_count": 1,
              "initialize": 2623,
              "initialize_count": 1,
              "reduce_count": 0,
              "collect": 45786,
              "collect_count": 4,
              "build_leaf_collector": 18211,
              "build_leaf_collector_count": 1,
              "post_collection": 929,
              "post_collection_count": 1
            },
            "debug": {
              "total_buckets": 1,
              "result_strategy": "long_terms"
            }
          },
          {
            "type": "GlobalAggregator",
            "description": "my_global_agg",
            "time_in_nanos": 104325,
            "breakdown": {
              "reduce": 0,
              "build_aggregation": 22470,
              "build_aggregation_count": 1,
              "initialize": 12454,
              "initialize_count": 1,
              "reduce_count": 0,
              "collect": 69401,
              "collect_count": 4,
              "build_leaf_collector": 8150,
              "build_leaf_collector_count": 1,
              "post_collection": 1584,
              "post_collection_count": 1
            },
            "children": [
              {
                "type": "NumericTermsAggregator",
                "description": "my_level_agg",
                "time_in_nanos": 76876,
                "breakdown": {
                  "reduce": 0,
                  "build_aggregation": 13824,
                  "build_aggregation_count": 1,
                  "initialize": 1441,
                  "initialize_count": 1,
                  "reduce_count": 0,
                  "collect": 61611,
                  "collect_count": 4,
                  "build_leaf_collector": 5564,
                  "build_leaf_collector_count": 1,
                  "post_collection": 471,
                  "post_collection_count": 1
                },
                "debug": {
                  "total_buckets": 1,
                  "result_strategy": "long_terms"
                }
              }
            ]
          }
        ]
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the profile structure we can see that the <code>my_scoped_agg</code> is internally
being run as a <code>NumericTermsAggregator</code> (because the field it is aggregating,
<code>http.response.status_code</code>, is a numeric field). At the same level, we see a <code>GlobalAggregator</code>
which comes from <code>my_global_agg</code>. That aggregation then has a child
<code>NumericTermsAggregator</code> which comes from the second term&#8217;s aggregation on <code>http.response.status_code</code>.</p>
</div>
<div class="paragraph">
<p>The <code>time_in_nanos</code> field shows the time executed by each aggregation, and is
inclusive of all children.  While the overall time is useful, the <code>breakdown</code>
field will give detailed stats about how the time was spent.</p>
</div>
<div class="paragraph">
<p>Some aggregations may return expert <code>debug</code> information that describe features
of the underlying execution of the aggregation that are 'useful for folks that
hack on aggregations but that we don&#8217;t expect to be otherwise useful. They can
vary wildly between versions, aggregations, and aggregation execution
strategies.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_timing_breakdown_2">Timing Breakdown</h5>
<div class="paragraph">
<p>The <code>breakdown</code> component lists detailed statistics about low-level execution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"breakdown": {
  "reduce": 0,
  "build_aggregation": 30885,
  "build_aggregation_count": 1,
  "initialize": 2623,
  "initialize_count": 1,
  "reduce_count": 0,
  "collect": 45786,
  "collect_count": 4,
  "build_leaf_collector": 18211,
  "build_leaf_collector_count": 1,
  "post_collection": 929,
  "post_collection_count": 1
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each property in the <code>breakdown</code> component corresponds to an internal method for
the aggregation. For example, the <code>build_leaf_collector</code> property measures
nanoseconds spent running the aggregation&#8217;s <code>getLeafCollector()</code> method.
Properties ending in <code>_count</code> record the number of invocations of the particular
method. For example, <code>"collect_count": 2</code> means the aggregation called the
<code>collect()</code> on two different documents. The <code>reduce</code> property is reserved for
future use and always returns <code>0</code>.</p>
</div>
<div class="paragraph">
<p>Timings are listed in wall-clock nanoseconds and are not normalized at all. All
caveats about the overall <code>time</code> apply here.  The intention of the breakdown is
to give you a feel for A) what machinery in OpenSearch is actually eating time, and B)
the magnitude of differences in times between the various components. Like the
overall time, the breakdown is inclusive of all children times.</p>
</div>
</div>
<div class="sect4">
<h5 id="profiling-considerations">Profiling Considerations</h5>
<div class="paragraph">
<p>Like any profiler, the Profile API introduces a non-negligible overhead to
search execution. The act of instrumenting low-level method calls such as
<code>collect</code>, <code>advance</code>, and <code>next_doc</code> can be fairly expensive, since these
methods are called in tight loops.  Therefore, profiling should not be enabled
in production settings by default, and should not be compared against
non-profiled query times. Profiling is just a diagnostic tool.</p>
</div>
<div class="paragraph">
<p>There are also cases where special Lucene optimizations are disabled, since they
are not amenable to profiling. This could cause some queries to report larger
relative times than their non-profiled counterparts, but in general should not
have a drastic effect compared to other components in the profiled query.</p>
</div>
</div>
<div class="sect4">
<h5 id="profile-limitations">Limitations</h5>
<div class="ulist">
<ul>
<li>
<p>Profiling currently does not measure the search fetch phase nor the network
overhead.</p>
</li>
<li>
<p>Profiling also does not account for time spent in the queue, merging shard
responses on the coordinating node, or additional work such as building global
ordinals (an internal data structure used to speed up search).</p>
</li>
<li>
<p>Profiling statistics are currently not available for suggestions,
highlighting, <code>dfs_query_then_fetch</code>.</p>
</li>
<li>
<p>Profiling of the reduce phase of aggregation is currently not available.</p>
</li>
<li>
<p>The Profiler is still highly experimental. The Profiler is instrumenting parts
of Lucene that were never designed to be exposed in this manner, and so all
results should be viewed as a best effort to provide detailed diagnostics. We
hope to improve this over time. If you find obviously wrong numbers, strange
query structures, or other bugs, please report them!</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-field-caps">Field capabilities API</h3>
<titleabbrev>Field capabilities</titleabbrev>
<div class="paragraph">
<p>Allows you to retrieve the capabilities of fields among multiple indices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_field_caps?fields=rating</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="search-field-caps-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /_field_caps?fields=&lt;fields&gt;</code></p>
</div>
<div class="paragraph">
<p><code>POST /_field_caps?fields=&lt;fields&gt;</code></p>
</div>
<div class="paragraph">
<p><code>GET /&lt;target&gt;/_field_caps?fields=&lt;fields&gt;</code></p>
</div>
<div class="paragraph">
<p><code>POST /&lt;target&gt;/_field_caps?fields=&lt;fields&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="search-field-caps-api-desc">Description</h4>
<div class="paragraph">
<p>The field capabilities API returns the information about the capabilities of
fields among multiple indices.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-field-caps-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;target&gt;</code></dt>
<dd>
<p>(Optional, string)
Comma-separated list of indices and index aliases used to limit
the request. Wildcard expressions (<code>*</code>) are supported.</p>
<div class="paragraph">
<p>To target all indices in a cluster, omit this parameter or use
<code>_all</code> or <code>*</code>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-field-caps-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fields</code></dt>
<dd>
<p>(Required, string)
Comma-separated list of fields to retrieve capabilities for. Wildcard (<code>*</code>)
expressions are supported.</p>
</dd>
<dt class="hdlist1"><code>allow_no_indices</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error if any wildcard expression,
<a href="indices.html#indices-aliases">index alias</a>, or <code>_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code>foo*,bar*</code> returns an error if an index
starts with <code>foo</code> but no index starts with <code>bar</code>.</p>
<div class="paragraph">
<p>Defaults to <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>expand_wildcards</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code>open,hidden</code>. Valid values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>Expand to open and closed indices, including <a href="api-conventions.html#hidden-indices">hidden indices</a>.</p>
</dd>
<dt class="hdlist1"><code>open</code></dt>
<dd>
<p>Expand only to open indices.</p>
</dd>
<dt class="hdlist1"><code>closed</code></dt>
<dd>
<p>Expand only to closed indices.</p>
</dd>
<dt class="hdlist1"><code>hidden</code></dt>
<dd>
<p>Expansion of wildcards will include hidden indices.
Must be combined with <code>open</code>, <code>closed</code>, or both.</p>
</dd>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>Wildcard expressions are not accepted.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Defaults to <code>open</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, missing or closed indices are not included in the
response. Defaults to <code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>include_unmapped</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, unmapped fields are included in the response.
Defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-field-caps-api-request-body">Request body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>index_filter</code></dt>
<dd>
<p>(Optional,  <a href="query-dsl.html">query object</a> Allows to filter indices if the provided
query rewrites to <code>match_none</code> on every shard.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-field-caps-api-response-body">Response body</h4>
<div class="paragraph">
<p>The types used in the response describe <em>families</em> of field types.
Normally a type family is the same as the field type declared in the mapping,
but to simplify matters certain field types that behave identically are
described using a type family. For example, <code>keyword</code>, <code>constant_keyword</code> and <code>wildcard</code>
field types are all described as the <code>keyword</code> type family.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>searchable</code></dt>
<dd>
<p>Whether this field is indexed for search on all indices.</p>
</dd>
<dt class="hdlist1"><code>aggregatable</code></dt>
<dd>
<p>Whether this field can be aggregated on all indices.</p>
</dd>
<dt class="hdlist1"><code>indices</code></dt>
<dd>
<p>The list of indices where this field has the same type family, or null if all indices
have the same type family for the field.</p>
</dd>
<dt class="hdlist1"><code>non_searchable_indices</code></dt>
<dd>
<p>The list of indices where this field is not searchable, or null if all indices
have the same definition for the field.</p>
</dd>
<dt class="hdlist1"><code>non_aggregatable_indices</code></dt>
<dd>
<p>The list of indices where this field is not aggregatable, or null if all
indices have the same definition for the field.</p>
</dd>
<dt class="hdlist1"><code>meta</code></dt>
<dd>
<p>Merged metadata across all indices as a map of string keys to arrays of values.
A value length of 1 indicates that all indices had the same value for this key,
while a length of 2 or more indicates that not all indices had the same value
for this key.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-field-caps-api-example">Examples</h4>
<div class="paragraph">
<p>The request can be restricted to specific indices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET my-index-000001/_field_caps?fields=rating</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example API call requests information about the <code>rating</code> and the
<code>title</code> fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _field_caps?fields=rating,title</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "indices": [ "index1", "index2", "index3", "index4", "index5" ],
  "fields": {
    "rating": {                                   <b class="conum">(1)</b>
      "long": {
        "searchable": true,
        "aggregatable": false,
        "indices": [ "index1", "index2" ],
        "non_aggregatable_indices": [ "index1" ]  <b class="conum">(2)</b>
      },
      "keyword": {
        "searchable": false,
        "aggregatable": true,
        "indices": [ "index3", "index4" ],
        "non_searchable_indices": [ "index4" ]    <b class="conum">(3)</b>
      }
    },
    "title": {                                    <b class="conum">(4)</b>
      "text": {
        "searchable": true,
        "aggregatable": false

      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The field <code>rating</code> is defined as a long in <code>index1</code> and <code>index2</code>
and as a <code>keyword</code> in <code>index3</code> and <code>index4</code>.</p>
</li>
<li>
<p>The field <code>rating</code> is not aggregatable in <code>index1</code>.</p>
</li>
<li>
<p>The field <code>rating</code> is not searchable in <code>index4</code>.</p>
</li>
<li>
<p>The field <code>title</code> is defined as <code>text</code> in all indices.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By default unmapped fields are ignored. You can include them in the response by
adding a parameter called <code>include_unmapped</code> in the request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET _field_caps?fields=rating,title&amp;include_unmapped</code></pre>
</div>
</div>
<div class="paragraph">
<p>In which case the response will contain an entry for each field that is present
in some indices but not all:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "indices": [ "index1", "index2", "index3" ],
  "fields": {
    "rating": {
      "long": {
        "searchable": true,
        "aggregatable": false,
        "indices": [ "index1", "index2" ],
        "non_aggregatable_indices": [ "index1" ]
      },
      "keyword": {
        "searchable": false,
        "aggregatable": true,
        "indices": [ "index3", "index4" ],
        "non_searchable_indices": [ "index4" ]
      },
      "unmapped": {                               <b class="conum">(1)</b>
        "indices": [ "index5" ],
        "searchable": false,
        "aggregatable": false
      }
    },
    "title": {
      "text": {
        "indices": [ "index1", "index2", "index3", "index4" ],
        "searchable": true,
        "aggregatable": false
      },
      "unmapped": {                               <b class="conum">(2)</b>
        "indices": [ "index5" ],
        "searchable": false,
        "aggregatable": false
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>rating</code> field is unmapped` in <code>index5</code>.</p>
</li>
<li>
<p>The <code>title</code> field is unmapped` in <code>index5</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is also possible to filter indices with a query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST my-index-*/_field_caps?fields=rating
{
  "index_filter": {
    "range": {
      "@timestamp": {
        "gte": "2018"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In which case indices that rewrite the provided filter to <code>match_none</code> on every shard
will be filtered from the response.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The filtering is done on a best-effort basis, it uses index statistics and mappings
to rewrite queries to <code>match_none</code> instead of fully executing the request.
For instance a <code>range</code> query over a <code>date</code> field can rewrite to <code>match_none</code>
if all documents within a shard (including deleted documents) are outside
of the provided range.
However, not all queries can rewrite to <code>match_none</code> so this API may return
an index even if the provided filter matches no document.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search-rank-eval">Ranking evaluation API</h3>
<titleabbrev>Ranking evaluation</titleabbrev>
<div class="paragraph">
<p>Allows you to evaluate the quality of ranked search results over a set of
typical search queries.</p>
</div>
<div class="sect3">
<h4 id="search-rank-eval-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /&lt;target&gt;/_rank_eval</code></p>
</div>
<div class="paragraph">
<p><code>POST /&lt;target&gt;/_rank_eval</code></p>
</div>
</div>
<div class="sect3">
<h4 id="search-rank-eval-api-desc">Description</h4>
<div class="paragraph">
<p>The ranking evaluation API allows you to evaluate the quality of ranked search
results over a set of typical search queries. Given this set of queries and a
list of manually rated documents, the <code><em>rank_eval</code> endpoint calculates and
returns typical information retrieval metrics like _mean reciprocal rank</em>,
<em>precision</em> or <em>discounted cumulative gain</em>.</p>
</div>
<div class="paragraph">
<p>Search quality evaluation starts with looking at the users of your search
application, and the things that they are searching for. Users have a specific
<em>information need</em>; for example, they are looking for gift in a web shop or want
to book a flight for their next holiday. They usually enter some search terms
into a search box or some other web form. All of this information, together with
meta information about the user (for example the browser, location, earlier
preferences and so on) then gets translated into a query to the underlying
search system.</p>
</div>
<div class="paragraph">
<p>The challenge for search engineers is to tweak this translation process from
user entries to a concrete query, in such a way that the search results contain
the most relevant information with respect to the user&#8217;s information need. This
can only be done if the search result quality is evaluated constantly across a
representative test suite of typical user queries, so that improvements in the
rankings for one particular query don&#8217;t negatively affect the ranking for
other types of queries.</p>
</div>
<div class="paragraph">
<p>In order to get started with search quality evaluation, you need three basic
things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A collection of documents you want to evaluate your query performance against,
usually one or more  indices.</p>
</li>
<li>
<p>A collection of typical search requests that users enter into your system.</p>
</li>
<li>
<p>A set of document ratings that represent the documents' relevance with respect
to a search request.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is important to note that one set of document ratings is needed per test
query, and that the relevance judgements are based on the information need of
the user that entered the query.</p>
</div>
<div class="paragraph">
<p>The ranking evaluation API provides a convenient way to use this information in
a ranking evaluation request to calculate different search evaluation metrics.
This gives you a first estimation of your overall search quality, as well as a
measurement to optimize against when fine-tuning various aspect of the query
generation in your application.</p>
</div>
</div>
<div class="sect3">
<h4 id="search-rank-eval-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;target&gt;</code></dt>
<dd>
<p>(Optional, string)
Comma-separated list of indices and index aliases used to limit
the request. Wildcard (<code>*</code>) expressions are supported.</p>
<div class="paragraph">
<p>To target all indices in a cluster, omit this parameter or use
<code>_all</code> or <code>*</code>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-rank-eval-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>allow_no_indices</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error if any wildcard expression,
<a href="indices.html#indices-aliases">index alias</a>, or <code>_all</code> value targets only missing or closed
indices. This behavior applies even if the request targets other open indices.
For example, a request targeting <code>foo*,bar*</code> returns an error if an index
starts with <code>foo</code> but no index starts with <code>bar</code>.</p>
<div class="paragraph">
<p>Defaults to <code>true</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>expand_wildcards</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, string) Controls what kind of indices that wildcard expressions can
expand to. Multiple values are accepted when separated by a comma, as in
<code>open,hidden</code>. Valid values are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>Expand to open and closed indices, including <a href="api-conventions.html#hidden-indices">hidden indices</a>.</p>
</dd>
<dt class="hdlist1"><code>open</code></dt>
<dd>
<p>Expand only to open indices.</p>
</dd>
<dt class="hdlist1"><code>closed</code></dt>
<dd>
<p>Expand only to closed indices.</p>
</dd>
<dt class="hdlist1"><code>hidden</code></dt>
<dd>
<p>Expansion of wildcards will include hidden indices.
Must be combined with <code>open</code>, <code>closed</code>, or both.</p>
</dd>
<dt class="hdlist1"><code>none</code></dt>
<dd>
<p>Wildcard expressions are not accepted.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Defaults to <code>open</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, missing or closed indices are not included in the
response. Defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="search-rank-eval-api-example">Examples</h4>
<div class="paragraph">
<p>In its most basic form, a request to the <code>_rank_eval</code> endpoint has two sections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">GET /my-index-000001/_rank_eval
{
  "requests": [ ... ],                            <b class="conum">(1)</b>
  "metric": {                                     <b class="conum">(2)</b>
    "mean_reciprocal_rank": { ... }               <b class="conum">(3)</b>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>a set of typical search requests, together with their provided ratings</p>
</li>
<li>
<p>definition of the evaluation metric to calculate</p>
</li>
<li>
<p>a specific metric and its parameters</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The request section contains several search requests typical to your
application, along with the document ratings for each particular search request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "amsterdam_query",                                  <b class="conum">(1)</b>
      "request": {                                              <b class="conum">(2)</b>
          "query": { "match": { "text": "amsterdam" } }
      },
      "ratings": [                                              <b class="conum">(3)</b>
        { "_index": "my-index-000001", "_id": "doc1", "rating": 0 },
        { "_index": "my-index-000001", "_id": "doc2", "rating": 3 },
        { "_index": "my-index-000001", "_id": "doc3", "rating": 1 }
      ]
    },
    {
      "id": "berlin_query",
      "request": {
        "query": { "match": { "text": "berlin" } }
      },
      "ratings": [
        { "_index": "my-index-000001", "_id": "doc1", "rating": 1 }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The search request&#8217;s ID, used to group result details later.</p>
</li>
<li>
<p>The query being evaluated.</p>
</li>
<li>
<p>A list of document ratings. Each entry contains the following arguments:</p>
<div class="ulist">
<ul>
<li>
<p><code>_index</code>: The document&#8217;s index.</p>
</li>
<li>
<p><code>_id</code>: The document ID.</p>
</li>
<li>
<p><code>rating</code>: The document&#8217;s relevance with regard to this search request.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A document <code>rating</code> can be any integer value that expresses the relevance of the
document on a user-defined scale. For some of the metrics, just giving a binary
rating (for example <code>0</code> for irrelevant and <code>1</code> for relevant) will be sufficient,
while other metrics can use a more fine-grained scale.</p>
</div>
<div class="sect4">
<h5 id="_template_based_ranking_evaluation">Template-based ranking evaluation</h5>
<div class="paragraph">
<p>As an alternative to having to provide a single query per test request, it is
possible to specify query templates in the evaluation request and later refer to
them. This way, queries with a similar structure that differ only in their
parameters don&#8217;t have to be repeated all the time in the <code>requests</code> section.
In typical search systems, where user inputs usually get filled into a small
set of query templates, this helps make the evaluation request more succinct.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">GET /my-index-000001/_rank_eval
{
   [...]
  "templates": [
     {
        "id": "match_one_field_query",  <b class="conum">(1)</b>
        "template": { <b class="conum">(2)</b>
            "inline": {
                "query": {
                  "match": { "{{field}}": { "query": "{{query_string}}" }}
                }
            }
        }
     }
  ],
  "requests": [
      {
         "id": "amsterdam_query"
         "ratings": [ ... ],
         "template_id": "match_one_field_query", <b class="conum">(3)</b>
         "params": { <b class="conum">(4)</b>
            "query_string": "amsterdam",
            "field": "text"
          }
     },
    [...]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>the template id</p>
</li>
<li>
<p>the template definition to use</p>
</li>
<li>
<p>a reference to a previously defined template</p>
</li>
<li>
<p>the parameters to use to fill the template</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is also possible to use <a href="search.html#pre-registered-templates">templates already stored</a>  in the cluster state by referencing their id in the templates section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">GET /my_index/_rank_eval
{
   [...]
  "templates": [
     {
        "id": "match_one_field_query",  <b class="conum">(1)</b>
        "template": { <b class="conum">(2)</b>
            "id": "match_one_field_query"
        }
     }
  ],
  "requests": [...]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>the template id used for requests</p>
</li>
<li>
<p>the template id stored in the cluster state</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_available_evaluation_metrics">Available evaluation metrics</h5>
<div class="paragraph">
<p>The <code>metric</code> section determines which of the available evaluation metrics
will be used. The following metrics are supported:</p>
</div>
<h5 id="k-precision" class="discrete">Precision at K (P@k)</h5>
<div class="paragraph">
<p>This metric measures the proportion of relevant results in the top k search results.
It&#8217;s a form of the well-known
<a href="https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Precision">Precision</a>
metric that only looks at the top k documents. It is the fraction of relevant
documents in those first k results. A precision at 10 (P@10) value of 0.6 then
means 6 out of the 10 top hits are relevant with respect to the user&#8217;s
information need.</p>
</div>
<div class="paragraph">
<p>P@k works well as a simple evaluation metric that has the benefit of being easy
to understand and explain. Documents in the collection need to be rated as either
relevant or irrelevant with respect to the current query. P@k is a set-based
metric and does not take into account the position of the relevant documents
within the top k results, so a ranking of ten results that contains one
relevant result in position 10 is equally as good as a ranking of ten results
that contains one relevant result in position 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "precision": {
      "k": 20,
      "relevant_rating_threshold": 1,
      "ignore_unlabeled": false
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>precision</code> metric takes the following optional parameters</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sets the maximum number of documents retrieved per query. This value will act in place of the usual <code>size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relevant_rating_threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sets the rating threshold above which documents are considered to be
"relevant". Defaults to <code>1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ignore_unlabeled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">controls how unlabeled documents in the search results are counted.
If set to 'true', unlabeled documents are ignored and neither count as relevant or irrelevant. Set to 'false' (the default), they are treated as irrelevant.</p></td>
</tr>
</tbody>
</table>
<h5 id="k-recall" class="discrete">Recall at K (R@k)</h5>
<div class="paragraph">
<p>This metric measures the total number of relevant results in the top k search
results. It&#8217;s a form of the well-known
<a href="https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Recall">Recall</a>
metric. It is the fraction of relevant documents in those first k results
relative to all possible relevant results. A recall at 10 (R@10) value of 0.5 then
means 4 out of 8 relevant documents, with respect to the user&#8217;s information
need, were retrieved in the 10 top hits.</p>
</div>
<div class="paragraph">
<p>R@k works well as a simple evaluation metric that has the benefit of being easy
to understand and explain. Documents in the collection need to be rated as either
relevant or irrelevant with respect to the current query. R@k is a set-based
metric and does not take into account the position of the relevant documents
within the top k results, so a ranking of ten results that contains one
relevant result in position 10 is equally as good as a ranking of ten results
that contains one relevant result in position 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "recall": {
      "k": 20,
      "relevant_rating_threshold": 1
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>recall</code> metric takes the following optional parameters</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sets the maximum number of documents retrieved per query. This value will act in place of the usual <code>size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relevant_rating_threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sets the rating threshold above which documents are considered to be
"relevant". Defaults to <code>1</code>.</p></td>
</tr>
</tbody>
</table>
<h5 id="_mean_reciprocal_rank" class="discrete">Mean reciprocal rank</h5>
<div class="paragraph">
<p>For every query in the test suite, this metric calculates the reciprocal of the
rank of the first relevant document. For example, finding the first relevant
result in position 3 means the reciprocal rank is 1/3. The reciprocal rank for
each query is averaged across all queries in the test suite to give the
<a href="https://en.wikipedia.org/wiki/Mean_reciprocal_rank">mean reciprocal rank</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "mean_reciprocal_rank": {
      "k": 20,
      "relevant_rating_threshold": 1
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mean_reciprocal_rank</code> metric takes the following optional parameters</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sets the maximum number of documents retrieved per query. This value will act in place of the usual <code>size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relevant_rating_threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the rating threshold above which documents are considered to be
"relevant". Defaults to <code>1</code>.</p></td>
</tr>
</tbody>
</table>
<h5 id="_discounted_cumulative_gain_dcg" class="discrete">Discounted cumulative gain (DCG)</h5>
<div class="paragraph">
<p>In contrast to the two metrics above,
<a href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain">discounted cumulative gain</a>
takes both the rank and the rating of the search results into account.</p>
</div>
<div class="paragraph">
<p>The assumption is that highly relevant documents are more useful for the user
when appearing at the top of the result list. Therefore, the DCG formula reduces
the contribution that high ratings for documents on lower search ranks have on
the overall DCG metric.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "dcg": {
      "k": 20,
      "normalize": false
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>dcg</code> metric takes the following optional parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sets the maximum number of documents retrieved per query. This value will act in place of the usual <code>size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>normalize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, this metric will calculate the <a href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain#Normalized_DCG">Normalized DCG</a>.</p></td>
</tr>
</tbody>
</table>
<h5 id="_expected_reciprocal_rank_err" class="discrete">Expected Reciprocal Rank (ERR)</h5>
<div class="paragraph">
<p>Expected Reciprocal Rank (ERR) is an extension of the classical reciprocal rank
for the graded relevance case (Olivier Chapelle, Donald Metzler, Ya Zhang, and
Pierre Grinspan. 2009.
<a href="https://olivier.chapelle.cc/pub/err.pdf">Expected reciprocal rank for graded relevance</a>.)</p>
</div>
<div class="paragraph">
<p>It is based on the assumption of a cascade model of search, in which a user
scans through ranked search results in order and stops at the first document
that satisfies the information need. For this reason, it is a good metric for
question answering and navigation queries, but less so for survey-oriented
information needs where the user is interested in finding many relevant
documents in the top k results.</p>
</div>
<div class="paragraph">
<p>The metric models the expectation of the reciprocal of the position at which a
user stops reading through the result list. This means that a relevant document
in a top ranking position will have a large contribution to the overall score.
However, the same document will contribute much less to the score if it appears
in a lower rank; even more so if there are some relevant (but maybe less relevant)
documents preceding it. In this way, the ERR metric discounts documents that
are shown after very relevant documents. This introduces a notion of dependency
in the ordering of relevant documents that e.g. Precision or DCG don&#8217;t account
for.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_rank_eval
{
  "requests": [
    {
      "id": "JFK query",
      "request": { "query": { "match_all": {} } },
      "ratings": []
    } ],
  "metric": {
    "expected_reciprocal_rank": {
      "maximum_relevance": 3,
      "k": 20
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>expected_reciprocal_rank</code> metric takes the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maximum_relevance</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory parameter. The highest relevance grade used in the user-supplied
relevance judgments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sets the maximum number of documents retrieved per query. This value will act in place of the usual <code>size</code> parameter
in the query. Defaults to 10.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_response_format_2">Response format</h5>
<div class="paragraph">
<p>The response of the <code>_rank_eval</code> endpoint contains the overall calculated result
for the defined quality metric, a <code>details</code> section with a breakdown of results
for each query in the test suite and an optional <code>failures</code> section that shows
potential errors of individual queries. The response has the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "rank_eval": {
    "metric_score": 0.4,                          <b class="conum">(1)</b>
      "details": {
      "my_query_id1": {                           <b class="conum">(2)</b>
        "metric_score": 0.6,                      <b class="conum">(3)</b>
        "unrated_docs": [                         <b class="conum">(4)</b>
          {
            "_index": "my-index-000001",
            "_id": "1960795"
          }, ...
        ],
        "hits": [
          {
            "hit": {                              <b class="conum">(5)</b>
              "_index": "my-index-000001",
              "_type": "page",
              "_id": "1528558",
              "_score": 7.0556192
            },
            "rating": 1
          }, ...
        ],
        "metric_details": {                       <b class="conum">(6)</b>
          "precision": {
            "relevant_docs_retrieved": 6,
            "docs_retrieved": 10
          }
        }
      },
      "my_query_id2": { [... ] }
    },
    "failures": { [... ] }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>the overall evaluation quality calculated by the defined metric</p>
</li>
<li>
<p>the <code>details</code> section contains one entry for every query in the original <code>requests</code> section, keyed by the search request id</p>
</li>
<li>
<p>the <code>metric_score</code> in the <code>details</code> section shows the contribution of this query to the global quality metric score</p>
</li>
<li>
<p>the <code>unrated_docs</code> section contains an <code>_index</code> and <code>_id</code> entry for each document in the search result for this
query that didn&#8217;t have a ratings value. This can be used to ask the user to supply ratings for these documents</p>
</li>
<li>
<p>the <code>hits</code> section shows a grouping of the search results with their supplied ratings</p>
</li>
<li>
<p>the <code>metric_details</code> give additional information about the calculated quality metric (e.g. how many of the retrieved
documents were relevant). The content varies for each metric but allows for better interpretation of the results</p>
<div id="snapshot-restore-apis" class="paragraph">
<p>== Snapshot and restore APIs</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can use the following APIs to set up snapshot repositories, manage snapshot
backups, and restore snapshots to a running cluster.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="snapshot-restore.html">Snapshot and restore</a>.</p>
</div>
<h3 id="snapshot-restore-repo-apis" class="discrete">Snapshot repository management APIs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="search.html#put-snapshot-repo-api">Put snapshot repository</a></p>
</li>
<li>
<p><a href="search.html#verify-snapshot-repo-api">Verify snapshot repository</a></p>
</li>
<li>
<p><a href="search.html#get-snapshot-repo-api">Get snapshot repository</a></p>
</li>
<li>
<p><a href="search.html#delete-snapshot-repo-api">Delete snapshot repository</a></p>
</li>
<li>
<p><a href="search.html#clean-up-snapshot-repo-api">Clean up snapshot repository</a></p>
</li>
</ul>
</div>
<h3 id="snapshot-management-apis" class="discrete">Snapshot management APIs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="search.html#create-snapshot-api">Create snapshot</a></p>
</li>
<li>
<p><a href="search.html#clone-snapshot-api">Clone snapshot</a></p>
</li>
<li>
<p><a href="search.html#get-snapshot-api">Get snapshot</a></p>
</li>
<li>
<p><a href="search.html#get-snapshot-status-api">Get snapshot status</a></p>
</li>
<li>
<p><a href="search.html#restore-snapshot-api">Restore snapshot</a></p>
</li>
<li>
<p><a href="search.html#delete-snapshot-api">Delete snapshot</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="put-snapshot-repo-api">Put snapshot repository API</h3>
<titleabbrev>Put snapshot repository</titleabbrev>
<div class="paragraph">
<p>Registers or updates a <a href="snapshots-register-repository.html">snapshot repository</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /_snapshot/my_repository
{
  "type": "fs",
  "settings": {
    "location": "my_backup_location"
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="put-snapshot-repo-api-request">Request</h4>
<div class="paragraph">
<p><code>PUT /_snapshot/&lt;repository&gt;</code></p>
</div>
<div class="paragraph">
<p><code>POST /_snapshot/&lt;repository&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="put-snapshot-repo-api-desc">Description</h4>
<div class="paragraph">
<p>A snapshot repository must be registered before you can perform
<a href="snapshot-restore.html">snapshot and restore</a> operations. You can use the put
snapshot repository API to register new repositories and update existing ones.
See <a href="snapshots-register-repository.html">Register a snapshot repository</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Because snapshot formats can change between major versions of
OpenSearch, we recommend registering a new snapshot repository for each major version.
See <a href="snapshot-restore.html#snapshot-restore-version-compatibility">Version compatibility</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="put-snapshot-repo-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the snapshot repository to register or update.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="put-snapshot-repo-api-query-params">Query parameters</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Several options for this API can be specified using a query parameter
or a request body parameter. If both parameters are specified, only the query
parameter is used.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>master_timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait for
a connection to the master node. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
<dt class="hdlist1"><code>timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait for
a response. If no response is received before the timeout expires, the request
fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
<dt class="hdlist1"><code>verify</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, the request verifies the repository is functional on all master and
data nodes in the cluster. If <code>false</code>, this verification is skipped. Defaults to
<code>true</code>.</p>
<div class="paragraph">
<p>You can manually perform this verification using the
<a href="search.html#verify-snapshot-repo-api">verify snapshot repository API</a>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="put-snapshot-repo-api-request-body">Request body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>master_timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>)
Specifies the period of time to wait for
a connection to the master node. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
<dt class="hdlist1"><code>timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>)
Specifies the period of time to wait for
a response. If no response is received before the timeout expires, the request
fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
</dl>
</div>
<div id="put-snapshot-repo-api-request-type" class="dlist">
<dl>
<dt class="hdlist1"><code>type</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Required, string)
Repository type.</p>
</div>
<details open>
<summary class="title">Valid values for <code>type</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fs</code></dt>
<dd>
<p>Shared file system repository. Repositories of this type use a shared file
system to store snapshots. This file system must accessible to all master and
data nodes in the cluster.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
To register a shared file system repository, you must mount the same
shared filesystem to the same location on all master and data nodes. This
location must be registered in the <code>path.repo</code> setting on all master and data
nodes in the cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="snapshots-register-repository.html#snapshots-filesystem-repository">Shared file system repository</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>url</code></dt>
<dd>
<p>URL repository. Repositories of this type are read-only
for the cluster. This means the cluster can retrieve or restore snapshots from
the repository but cannot write or create snapshots in it.</p>
<div class="paragraph">
<p>You can use URL repositories as an alternative way to give a cluster read-only
access to a shared file system (<code>fs</code>) repository.</p>
</div>
<div class="paragraph">
<p>See <a href="snapshots-register-repository.html#snapshots-read-only-repository">Read-only URL repository</a>.</p>
</div>
</dd>
</dl>
</div>
</div>
</details>
<div class="paragraph">
<p>More repository types are available through these official
plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.opensearch.org/guide/en/opensearch/plugins/{branch}/repository-s3.html">repository-s3</a> for S3 repository support</p>
</li>
<li>
<p><a href="https://www.opensearch.org/guide/en/opensearch/plugins/{branch}/repository-hdfs.html">repository-hdfs</a> for HDFS repository support in
Hadoop environments</p>
</li>
<li>
<p><a href="https://www.opensearch.org/guide/en/opensearch/plugins/{branch}/repository-azure.html">repository-azure</a> for Azure storage
repositories</p>
</li>
<li>
<p><a href="https://www.opensearch.org/guide/en/opensearch/plugins/{branch}/repository-gcs.html">repository-gcs</a> for Google Cloud Storage
repositories</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div id="put-snapshot-repo-api-settings-param" class="dlist">
<dl>
<dt class="hdlist1"><code>settings</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Required, object)
Contains settings for the repository.</p>
</div>
<div class="paragraph">
<p>The following <code>settings</code> properties are valid for all repository types:</p>
</div>
<details open>
<summary class="title">Properties of <code>settings</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>chunk_size</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#byte-units">byte value</a>)
Maximum size of files in snapshots. In snapshots, files larger than this are
broken down into chunks of this size or smaller. Defaults to <code>null</code> (unlimited
file size).</p>
</dd>
<dt class="hdlist1"><code>compress</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, metadata files, such as index mappings and settings, are compressed
in snapshots. Data files are not compressed. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>max_restore_bytes_per_sec</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#byte-units">byte value</a>)
Maximum snapshot restore rate per node. Defaults to unlimited. Note
that restores are also throttled through <a href="settings.html#recovery">recovery settings</a>.</p>
</dd>
<dt class="hdlist1"><code>max_snapshot_bytes_per_sec</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#byte-units">byte value</a>)
Maximum snapshot creation rate per node. Defaults to <code>40mb</code> per second.</p>
</dd>
<dt class="hdlist1"><code>readonly</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, the repository is read-only. The cluster can retrieve and restore
snapshots from the repository but not write to the repository or create
snapshots in it.</p>
<div class="paragraph">
<p>If <code>false</code>, the cluster can write to the repository and create snapshots in it.
Defaults to <code>false</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you register the same snapshot repository with multiple clusters, only
one cluster should have write access to the repository. Having multiple clusters
write to the repository at the same time risks corrupting the contents of the
repository.</p>
</div>
<div class="paragraph">
<p>Only a cluster with write access can create snapshots in the repository. All
other clusters connected to the repository should have the <code>readonly</code> parameter
set to <code>true</code>. This means those clusters can retrieve or restore snapshots from
the repository but not create snapshots in it.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
</details>
<div class="paragraph">
<p>Other accepted <code>settings</code> properties depend on the repository type, set using the
<a href="search.html#put-snapshot-repo-api-request-type"><code>type</code></a> parameter.</p>
</div>
<details open>
<summary class="title">Valid <code>settings</code> properties for <code>fs</code> repositories</summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>location</code></dt>
<dd>
<p>(Required, string)
Location of the shared filesystem used to store and retrieve snapshots. This
location must be registered in the <code>path.repo</code> setting on all master and data
nodes in the cluster.</p>
</dd>
</dl>
</div>
</div>
</details>
<details open>
<summary class="title">Valid <code>settings</code> properties for <code>url</code> repositories</summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>url</code></dt>
<dd>
<p>(Required, string)
URL location of the root of the shared filesystem repository. The following
protocols are supported:</p>
<div class="ulist">
<ul>
<li>
<p><code>file</code></p>
</li>
<li>
<p><code>ftp</code></p>
</li>
<li>
<p><code>http</code></p>
</li>
<li>
<p><code>https</code></p>
</li>
<li>
<p><code>jar</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>URLs using the <code>file</code> protocol must point to the location of a shared filesystem
accessible to all master and data nodes in the cluster. This location must be
registered in the <code>path.repo</code> setting.</p>
</div>
<div class="paragraph">
<p>URLs using the <code>http</code>, <code>https</code>, or <code>ftp</code> protocols must be explicitly allowed with the
<code>repositories.url.allowed_urls</code> setting. This setting supports wildcards in the
place of a host, path, query, or fragment in the URL.</p>
</div>
</div>
</details>
</div>
</div>
</dd>
<dt class="hdlist1"><code>verify</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, the request verifies the repository is functional on all master and
data nodes in the cluster. If <code>false</code>, this verification is skipped. Defaults to
<code>true</code>.</p>
<div class="paragraph">
<p>You can manually perform this verification using the
<a href="snapshots-register-repository.html#snapshots-repository-verification">verify snapshot repository API</a>.</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verify-snapshot-repo-api">Verify snapshot repository API</h3>
<titleabbrev>Verify snapshot repository</titleabbrev>
<div class="paragraph">
<p>Verifies that a snapshot repository is functional.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /_snapshot/my_repository/_verify</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="verify-snapshot-repo-api-request">Request</h4>
<div class="paragraph">
<p><code>POST /_snapshot/&lt;repository&gt;/_verify</code></p>
</div>
</div>
<div class="sect3">
<h4 id="verify-snapshot-repo-api-desc">Description</h4>
<div class="paragraph">
<p>By default, <a href="search.html#put-snapshot-repo-api">put snapshot repository API</a> requests
verify that a snapshot is functional on all master and data nodes in the
cluster.</p>
</div>
<div class="paragraph">
<p>You can skip this verification using the put snapshot repository API&#8217;s <code>verify</code>
parameter. You can then use the verify snapshot repository API to manually
verify the repository.</p>
</div>
<div class="paragraph">
<p>If verification is successful, the verify snapshot repository API returns a list
of nodes connected to the snapshot repository. If verification failed, the API
returns an error.</p>
</div>
</div>
<div class="sect3">
<h4 id="verify-snapshot-repo-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the snapshot repository to verify.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="verify-snapshot-repo-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>master_timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait for
a connection to the master node. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
<dt class="hdlist1"><code>timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait for
a response. If no response is received before the timeout expires, the request
fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="verify-snapshot-repo-api-response-body">Response body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>nodes</code></dt>
<dd>
<p>(object)</p>
<details open>
<summary class="title">Properties of <code>nodes</code> objects</summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;node_id&gt;</code></dt>
<dd>
<p>(object)
Contains information about a node connected to the snapshot repository.</p>
<div class="paragraph">
<p>The key is the ID of the node.</p>
</div>
<details open>
<summary class="title">Properties of <code>&lt;node_id&gt;</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>name</code></dt>
<dd>
<p>(string)
Human-readable name for the node.</p>
<div class="paragraph">
<p>You can set this name using the <a href="important-settings.html#node-name"><code>node.name</code></a> property in
<code>opensearch.yml</code>. Defaults to the machine&#8217;s hostname.</p>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="get-snapshot-repo-api">Get snapshot repository API</h3>
<titleabbrev>Get snapshot repository</titleabbrev>
<div class="paragraph">
<p>Gets information about one or more registered
<a href="snapshots-register-repository.html">snapshot repositories</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_snapshot/my_repository</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-repo-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /_snapshot/&lt;repository&gt;</code></p>
</div>
<div class="paragraph">
<p><code>GET /_snapshot</code></p>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-repo-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Comma-separated list of snapshot repository names used to limit the request.
Wildcard (<code>*</code>) expressions are supported.</p>
<div class="paragraph">
<p>To get information about all snapshot repositories registered in the
cluster, omit this parameter or use <code>*</code> or <code>_all</code>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-repo-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>local</code></dt>
<dd>
<p>(Optional, Boolean) If <code>true</code>, the request gets information from the local node
only. If <code>false</code>, the request gets information from the master node. Defaults to
<code>false</code>.</p>
</dd>
<dt class="hdlist1"><code>master_timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait for
a connection to the master node. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="get-snapshot-repo-api-response-body">Response body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(object)
Contains information about the snapshot repository. Key is the name of the
snapshot repository.</p>
<details open>
<summary class="title">Properties of <code>&lt;repository&gt;</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>type</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(string)
Repository type.</p>
</div>
<details open>
<summary class="title">Values for <code>type</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fs</code></dt>
<dd>
<p>Shared file system repository. See <a href="snapshots-register-repository.html#snapshots-filesystem-repository">Shared file system repository</a>.</p>
</dd>
<dt class="hdlist1"><code>url</code></dt>
<dd>
<p>URL repository. See <a href="snapshots-register-repository.html#snapshots-read-only-repository">Read-only URL repository</a>.</p>
</dd>
</dl>
</div>
</div>
</details>
<div class="paragraph">
<p>More repository types are available through these official plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.opensearch.org/guide/en/opensearch/plugins/{branch}/repository-s3.html">repository-s3</a> for S3 repository support</p>
</li>
<li>
<p><a href="https://www.opensearch.org/guide/en/opensearch/plugins/{branch}/repository-hdfs.html">repository-hdfs</a> for HDFS repository support in
Hadoop environments</p>
</li>
<li>
<p><a href="https://www.opensearch.org/guide/en/opensearch/plugins/{branch}/repository-azure.html">repository-azure</a> for Azure storage
repositories</p>
</li>
<li>
<p><a href="https://www.opensearch.org/guide/en/opensearch/plugins/{branch}/repository-gcs.html">repository-gcs</a> for Google Cloud Storage
repositories</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>settings</code></dt>
<dd>
<p>(object)
Contains settings for the repository. Valid properties for the <code>settings</code> object
depend on the repository type, set using the
<a href="search.html#put-snapshot-repo-api-request-type"><code>type</code></a> parameter.</p>
<div class="paragraph">
<p>For properties, see the <a href="search.html#put-snapshot-repo-api">put snapshot repository API</a>'s
<a href="search.html#put-snapshot-repo-api-settings-param"><code>settings</code> parameter</a>.</p>
</div>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-repo-api-example">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_snapshot/my_repository</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "my_repository" : {
    "type" : "fs",
    "settings" : {
      "location" : "my_backup_location"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delete-snapshot-repo-api">Delete snapshot repository API</h3>
<titleabbrev>Delete snapshot repository</titleabbrev>
<div class="paragraph">
<p>Unregisters one or more <a href="snapshots-register-repository.html">snapshot repositories</a>.</p>
</div>
<div class="paragraph">
<p>When a repository is unregistered, OpenSearch only removes the reference to the
location where the repository is storing the snapshots. The snapshots themselves
are left untouched and in place.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">DELETE /_snapshot/my_repository</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="delete-snapshot-repo-api-request">Request</h4>
<div class="paragraph">
<p><code>DELETE /_snapshot/&lt;repository&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="delete-snapshot-repo-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the snapshot repository to unregister. Wildcard (<code>*</code>) patterns are
supported.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="delete-snapshot-repo-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>master_timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait for
a connection to the master node. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
<dt class="hdlist1"><code>timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait for
a response. If no response is received before the timeout expires, the request
fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clean-up-snapshot-repo-api">Clean up snapshot repository API</h3>
<titleabbrev>Clean up snapshot repository</titleabbrev>
<div class="paragraph">
<p>Triggers the review of a snapshot repository&#8217;s contents and deletes any stale
data that is not referenced by existing snapshots.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /_snapshot/my_repository/_cleanup</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="clean-up-snapshot-repo-api-request">Request</h4>
<div class="paragraph">
<p><code>POST /_snapshot/&lt;repository&gt;/_cleanup</code></p>
</div>
</div>
<div class="sect3">
<h4 id="clean-up-snapshot-repo-api-desc">Description</h4>
<div class="paragraph">
<p>Over time, snapshot repositories can accumulate stale data that is no longer
referenced by existing snapshots.</p>
</div>
<div class="paragraph">
<p>While this unreferenced data does not negatively impact the performance or
safety of a snapshot repository, it can lead to more storage use than necessary.</p>
</div>
<div class="paragraph">
<p>You can use the clean up snapshot repository API to detect and delete this
unreferenced data.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Most cleanup operations performed by this API are performed automatically when
a snapshot is deleted from a repository.</p>
</div>
<div class="paragraph">
<p>If you regularly delete snapshots, calling this API may only reduce your storage
slightly or not at all.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="clean-up-snapshot-repo-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the snapshot repository to review and clean up.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="clean-up-snapshot-repo-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>master_timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>)
Period to wait for a connection to the master node. If no response is received
before the timeout expires, the request fails and returns an error. Defaults to
<code>30s</code>.</p>
</dd>
<dt class="hdlist1"><code>timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>)
Period to wait for a response. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="clean-up-snapshot-repo-api-response-body">Response body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>results</code></dt>
<dd>
<p>(object)
Contains statistics for cleanup operations.</p>
<details open>
<summary class="title">Properties of <code>results</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>deleted_bytes</code></dt>
<dd>
<p>(integer)
Number of bytes freed by cleanup operations.</p>
</dd>
<dt class="hdlist1"><code>deleted_blobs</code></dt>
<dd>
<p>(integer)
Number of binary large objects (blobs) removed from the snapshot repository
during cleanup operations. Any non-zero value implies that unreferenced blobs
were found and subsequently cleaned up.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="clean-up-snapshot-repo-api-example">Examples</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /_snapshot/my_repository/_cleanup</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "results": {
    "deleted_bytes": 20,
    "deleted_blobs": 5
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clone-snapshot-api">Clone snapshot API</h3>
<titleabbrev>Clone snapshot</titleabbrev>
<div class="paragraph">
<p>Clones part or all of a snapshot into a new snapshot.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /_snapshot/my_repository/source_snapshot/_clone/target_snapshot
{
  "indices": "index_a,index_b"
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="clone-snapshot-api-request">Request</h4>
<div class="paragraph">
<p><code>PUT /_snapshot/&lt;repository&gt;/&lt;source_snapshot&gt;/_clone/&lt;target_snapshot&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="clone-snapshot-api-desc">Description</h4>
<div class="paragraph">
<p>The clone snapshot API allows creating a copy of all or part of an existing snapshot
within the same repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="clone-snapshot-api-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the snapshot repository that both source and target snapshot belong to.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="clone-snapshot-api-query-params">Query parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>master_timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait for
a connection to the master node. If no response is received before the timeout
expires, the request fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
<dt class="hdlist1"><code>timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>) Specifies the period of time to wait for
a response. If no response is received before the timeout expires, the request
fails and returns an error. Defaults to <code>30s</code>.</p>
</dd>
<dt class="hdlist1"><code>indices</code></dt>
<dd>
<p>(Required, string)
A comma-separated list of indices to include in the snapshot.
<a href="api-conventions.html#multi-index">Multi-index syntax</a> is supported.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-snapshot-api">Create snapshot API</h3>
<titleabbrev>Create snapshot</titleabbrev>
<div class="paragraph">
<p>Takes a <a href="snapshot-restore.html">snapshot</a> of a cluster or specified
indices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /_snapshot/my_repository/my_snapshot</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="create-snapshot-api-request">Request</h4>
<div class="paragraph">
<p><code>PUT /_snapshot/&lt;repository&gt;/&lt;snapshot&gt;</code></p>
</div>
<div class="paragraph">
<p><code>POST /_snapshot/&lt;repository&gt;/&lt;snapshot&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="create-snapshot-api-desc">Description</h4>
<div class="paragraph">
<p>You can use the create snapshot API to create a <a href="snapshot-restore.html">snapshot</a>, which is a
backup taken from a running OpenSearch cluster.</p>
</div>
<div class="paragraph">
<p>By default, a snapshot includes all open indices in the
cluster, as well as the cluster state.  You can change this behavior by
specifying a list of indices to back up in the body of the
snapshot request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You must register a snapshot repository before performing snapshot and restore operations. Use the <a href="search.html#put-snapshot-repo-api">put snapshot repository API</a> to register new repositories and update existing ones.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The snapshot process is incremental. When creating a snapshot, OpenSearch analyzes the list of files that are already stored in the repository and copies only files that were created or changed since the last snapshot. This process allows multiple snapshots to be preserved in the repository in a compact form.</p>
</div>
<div class="paragraph">
<p>The snapshot process is executed in non-blocking fashion, so all indexing and searching operations can run concurrently against the index that OpenSearch is snapshotting.</p>
</div>
<div class="paragraph">
<p>A snapshot represents a point-in-time view of the moment when the snapshot was created. No records that were added to an index after the snapshot process started will be present in the snapshot.</p>
</div>
<div class="paragraph">
<p>For primary shards that have not been started and are not currently relocating, the snapshot process starts immediately. If shards are in the process of starting or relocating, OpenSearch waits for these processes to complete before taking a snapshot.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
While a snapshot of a particular shard is being created, this shard cannot be moved to another node. Relocating a shard during the snapshot process can interfere with rebalancing and allocation filtering. OpenSearch can move a shard to another node (according to the current allocation filtering settings and rebalancing algorithm) only after the snapshot process completes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Besides creating a copy of each index, the snapshot process can also store global cluster metadata, including persistent cluster settings and templates. The transient settings and registered snapshot repositories are not stored as part of the snapshot.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-snapshot-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the repository to create a snapshot in.</p>
</dd>
<dt class="hdlist1"><code>&lt;snapshot&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the snapshot to create. This name must be unique in the snapshot repository.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="create-snapshot-api-request-body">Request body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error for any index that is missing or closed. Defaults to <code>false</code>.</p>
<div class="paragraph">
<p>If <code>true</code>, the request ignores indices in <code>indices</code> that are missing or closed.</p>
</div>
</dd>
<dt class="hdlist1"><code>indices</code></dt>
<dd>
<p>(Optional, string)
A comma-separated list of indices to include in the snapshot.
<a href="api-conventions.html#multi-index">Multi-index syntax</a> is supported.</p>
<div class="paragraph">
<p>By default, a snapshot includes all indices in the cluster. If this
argument is provided, the snapshot only includes the specified clusters.</p>
</div>
</dd>
<dt class="hdlist1"><code>include_global_state</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, Boolean)
If <code>true</code>, the current cluster state is included in the snapshot.
Defaults to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The cluster state includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistent cluster settings</p>
</li>
<li>
<p>Index templates</p>
</li>
<li>
<p>Legacy index templates</p>
</li>
<li>
<p>Ingest pipelines</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
By default, the entire snapshot will fail if one or more indices included in the snapshot do not have all primary shards available. You can change this behavior by setting <a href="search.html#create-snapshot-api-partial"><code>partial</code></a> to <code>true</code>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>master_timeout</code></dt>
<dd>
<p>(Optional, <a href="api-conventions.html#time-units">time units</a>)
Period to wait for a connection to the master node. If no response is received
before the timeout expires, the request fails and returns an error. Defaults to
<code>30s</code>.</p>
</dd>
<dt class="hdlist1"><code>metadata</code></dt>
<dd>
<p>(Optional, string)
Attaches arbitrary metadata to the snapshot, such as a record of who took the snapshot, why it was taken, or any other useful data. Metadata must be less than 1024 bytes.</p>
</dd>
</dl>
</div>
<div id="create-snapshot-api-partial" class="dlist">
<dl>
<dt class="hdlist1"><code>partial</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the entire snapshot will fail if one or more indices included in the snapshot do not have all primary shards available. Defaults to <code>false</code>.</p>
<div class="paragraph">
<p>If <code>true</code>, allows taking a partial snapshot of indices with unavailable shards.</p>
</div>
</dd>
<dt class="hdlist1"><code>wait_for_completion</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, the request returns a response when the snapshot is complete.
If <code>false</code>, the request returns a response when the snapshot initializes.
Defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="create-snapshot-api-example">Examples</h4>
<div class="paragraph">
<p>The following request takes a snapshot of <code>index_1</code> and <code>index_2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /_snapshot/my_repository/snapshot_2?wait_for_completion=true
{
  "indices": "index_1,index_2",
  "ignore_unavailable": true,
  "include_global_state": false,
  "metadata": {
    "taken_by": "user123",
    "taken_because": "backup before upgrading"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "snapshot": {
    "snapshot": "snapshot_2",
    "uuid": "vdRctLCxSketdKb54xw67g",
    "version_id": &lt;version_id&gt;,
    "version": &lt;version&gt;,
    "indices": [],
    "data_streams": [],
    "include_global_state": false,
    "metadata": {
      "taken_by": "user123",
      "taken_because": "backup before upgrading"
    },
    "state": "SUCCESS",
    "start_time": "2020-06-25T14:00:28.850Z",
    "start_time_in_millis": 1593093628850,
    "end_time": "2020-06-25T14:00:28.850Z",
    "end_time_in_millis": 1593094752018,
    "duration_in_millis": 0,
    "failures": [],
    "shards": {
      "total": 0,
      "failed": 0,
      "successful": 0
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="get-snapshot-api">Get snapshot API</h3>
<titleabbrev>Get snapshot</titleabbrev>
<div class="paragraph">
<p>Retrieves information about one or more snapshots.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_snapshot/my_repository/my_snapshot</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /_snapshot/&lt;repository&gt;/&lt;snapshot&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-api-desc">Description</h4>
<div class="paragraph">
<p>Use the get snapshot API to return information about one or more snapshots, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Start and end time values</p>
</li>
<li>
<p>Version of OpenSearch that created the snapshot</p>
</li>
<li>
<p>List of included indices</p>
</li>
<li>
<p>Current state of the snapshot</p>
</li>
<li>
<p>List of failures that occurred during the snapshot</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Snapshot repository name used to limit the request.</p>
<div class="paragraph">
<p>To get information about all snapshot repositories registered in the
cluster, omit this parameter or use <code>*</code> or <code>_all</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>&lt;snapshot&gt;</code></dt>
<dd>
<p>(Required, string)
Comma-separated list of snapshot names to retrieve. Also accepts wildcards (<code>*</code>).</p>
<div class="ulist">
<ul>
<li>
<p>To get information about all snapshots in a registered repository, use a wildcard (<code>*</code>) or <code>_all</code>.</p>
</li>
<li>
<p>To get information about any snapshots that are currently running, use <code>_current</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Using <code>_all</code> in a request fails if any snapshots are unavailable.
Set <a href="search.html#get-snapshot-api-ignore-unavailable"><code>ignore_unavailable</code></a> to <code>true</code> to return only available snapshots.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="get-snapshot-api-request-body">Request body</h4>
<div id="get-snapshot-api-ignore-unavailable" class="dlist">
<dl>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error for any snapshots that are unavailable. Defaults to <code>false</code>.</p>
<div class="paragraph">
<p>If <code>true</code>, the request ignores snapshots that are unavailable, such as those that are corrupted or temporarily cannot be returned.</p>
</div>
</dd>
<dt class="hdlist1"><code>verbose</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, returns all available information about a snapshot. Defaults to <code>true</code>.</p>
<div class="paragraph">
<p>If <code>false</code>, omits additional information about the snapshot, such as version information, start and end times, and the number of snapshotted shards.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="get-snapshot-api-response-body">Response body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>snapshot</code></dt>
<dd>
<p>(string)
Name of the snapshot.</p>
</dd>
<dt class="hdlist1"><code>uuid</code></dt>
<dd>
<p>(string)
Universally unique identifier (UUID) of the snapshot.</p>
</dd>
<dt class="hdlist1"><code>version_id</code></dt>
<dd>
<p>(int)
Build ID of the OpenSearch version used to create the snapshot.</p>
</dd>
<dt class="hdlist1"><code>version</code></dt>
<dd>
<p>(float)
OpenSearch version used to create the snapshot.</p>
</dd>
<dt class="hdlist1"><code>indices</code></dt>
<dd>
<p>(array)
List of indices included in the snapshot.</p>
</dd>
<dt class="hdlist1"><code>data_streams</code></dt>
<dd>
<p>(array)
List of data streams included in the snapshot.</p>
</dd>
<dt class="hdlist1"><code>include_global_state</code></dt>
<dd>
<p>(Boolean)
Indicates whether the current cluster state is included in the snapshot.</p>
</dd>
<dt class="hdlist1"><code>start_time</code></dt>
<dd>
<p>(string)
Date timestamp of when the snapshot creation process started.</p>
</dd>
<dt class="hdlist1"><code>start_time_in_millis</code></dt>
<dd>
<p>(long)
The time, in milliseconds, when the snapshot creation process started.</p>
</dd>
<dt class="hdlist1"><code>end_time</code></dt>
<dd>
<p>(string)
Date timestamp of when the snapshot creation process ended.</p>
</dd>
<dt class="hdlist1"><code>end_time_in_millis</code></dt>
<dd>
<p>(long)
The time, in milliseconds, when the snapshot creation process ended.</p>
</dd>
<dt class="hdlist1"><code>duration_in_millis</code></dt>
<dd>
<p>(long)
How long, in milliseconds, it took to create the snapshot.</p>
</dd>
</dl>
</div>
<div id="get-snapshot-api-response-failures" class="dlist">
<dl>
<dt class="hdlist1"><code>failures</code></dt>
<dd>
<p>(array)
Lists any failures that occurred when creating the snapshot.</p>
</dd>
<dt class="hdlist1"><code>shards</code></dt>
<dd>
<p>(object)
Contains a count of shards in the snapshot.</p>
<details open>
<summary class="title">Properties of <code>shards</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>total</code></dt>
<dd>
<p>(integer)
Total number of shards included in the snapshot.</p>
</dd>
<dt class="hdlist1"><code>successful</code></dt>
<dd>
<p>(integer)
Number of shards that were successfully included in the snapshot.</p>
</dd>
<dt class="hdlist1"><code>failed</code></dt>
<dd>
<p>(integer)
Number of shards that failed to be included in the snapshot.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt class="hdlist1"><code>state</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(string)
The snapshot <code>state</code> can be one of the following values:</p>
</div>
<details open>
<summary class="title">Values for <code>state</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>IN_PROGRESS</code></dt>
<dd>
<p>The snapshot is currently running.</p>
</dd>
<dt class="hdlist1"><code>SUCCESS</code></dt>
<dd>
<p>The snapshot finished and all shards were stored successfully.</p>
</dd>
<dt class="hdlist1"><code>FAILED</code></dt>
<dd>
<p>The snapshot finished with an error and failed to store any data.</p>
</dd>
<dt class="hdlist1"><code>PARTIAL</code></dt>
<dd>
<p>The global cluster state was stored, but data of at least one shard was not stored successfully.
The <a href="search.html#get-snapshot-api-response-failures"><code>failures</code></a> section of the response contains more detailed information about shards
that were not processed correctly.</p>
</dd>
</dl>
</div>
</div>
</details>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-api-example">Examples</h4>
<div class="paragraph">
<p>The following request returns information for <code>snapshot_2</code> in the <code>my_repository</code> repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_snapshot/my_repository/snapshot_2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "snapshots": [
    {
      "snapshot": "snapshot_2",
      "uuid": "vdRctLCxSketdKb54xw67g",
      "version_id": &lt;version_id&gt;,
      "version": &lt;version&gt;,
      "indices": [],
      "data_streams": [],
      "include_global_state": true,
      "state": "SUCCESS",
      "start_time": "2020-07-06T21:55:18.129Z",
      "start_time_in_millis": 1593093628850,
      "end_time": "2020-07-06T21:55:18.876Z",
      "end_time_in_millis": 1593094752018,
      "duration_in_millis": 0,
      "failures": [],
      "shards": {
        "total": 0,
        "failed": 0,
        "successful": 0
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="get-snapshot-status-api">Get snapshot status API</h3>
<titleabbrev>Get snapshot status</titleabbrev>
<div class="paragraph">
<p>Retrieves a detailed description of the current state for each shard participating in the snapshot.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_snapshot/my_repository/my_snapshot/_status</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-status-api-request">Request</h4>
<div class="paragraph">
<p><code>GET /_snapshot/&lt;repository&gt;/&lt;snapshot&gt;/_status</code></p>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-status-api-desc">Description</h4>
<div class="paragraph">
<p>Use the get snapshot status API to retrieve detailed information about snapshots currently running in the cluster.</p>
</div>
<div class="paragraph">
<p>If you specify both the repository name and snapshot, the request retrieves detailed status information for the given snapshot, even if not currently running.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using the get snapshot status API to return any status results other than the currently running snapshots (<code>_current</code>) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot. Such requests are taxing to machine resources and can also incur high processing costs when running in the cloud.</p>
</div>
<div class="paragraph">
<p>For example, if you have 100 snapshots with 1,000 shards each, the API request will result in 100,000 file reads (100 snapshots * 1,000 shards). Depending on the latency of your file storage, the request can take extremely long to retrieve results.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-status-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Snapshot repository name used to limit the request. Wildcard (<code>*</code>) expressions are supported.</p>
<div class="paragraph">
<p>Use <code>_current</code> after the repository name to limit the request only to the currently running snapshots. This usage is preferred to return only snapshots that are currently running and not degrade response time.</p>
</div>
</dd>
<dt class="hdlist1"><code>&lt;snapshot&gt;</code></dt>
<dd>
<p>(Required, string)
Comma-separated list of snapshot names to retrieve status for.</p>
<div class="paragraph">
<p>To retrieve a list of all snapshots in a specified repository, omit this parameter.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Wildcard (<code>*</code>) expressions are not supported for <code>&lt;snapshot&gt;</code>.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="get-snapshot-status-api-request-body">Request body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error for any snapshots that are unavailable. Defaults to <code>false</code>.</p>
<div class="paragraph">
<p>If <code>true</code>, the request ignores snapshots that are unavailable, such as those that are corrupted or temporarily cannot be returned.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3 child_attributes">
<h4 id="get-snapshot-status-api-response-body">Response body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>repository</code></dt>
<dd>
<p>(string)
Name of the repository that includes the snapshot.</p>
</dd>
<dt class="hdlist1"><code>snapshot</code></dt>
<dd>
<p>(string)
Name of the snapshot.</p>
</dd>
<dt class="hdlist1"><code>uuid</code></dt>
<dd>
<p>(string)
Universally unique identifier (UUID) of the snapshot.</p>
</dd>
<dt class="hdlist1"><code>state</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(string)
Indicates the current snapshot state.</p>
</div>
<details open>
<summary class="title">Values for <code>state</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>FAILED</code></dt>
<dd>
<p>The snapshot finished with an error and failed to store any data.</p>
</dd>
<dt class="hdlist1"><code>IN_PROGRESS</code></dt>
<dd>
<p>The snapshot is currently running.</p>
</dd>
<dt class="hdlist1"><code>PARTIAL</code></dt>
<dd>
<p>The global cluster state was stored, but data of at least one shard was not stored successfully.
The <a href="search.html#get-snapshot-api-response-failures"><code>failures</code></a> section of the response contains more detailed information about shards
that were not processed correctly.</p>
</dd>
<dt class="hdlist1"><code>SUCCESS</code></dt>
<dd>
<p>The snapshot finished and all shards were stored successfully.</p>
</dd>
</dl>
</div>
</div>
</details>
</div>
</div>
</dd>
<dt class="hdlist1"><code>include_global_state</code></dt>
<dd>
<p>(Boolean)
Indicates whether the current cluster state is included in the snapshot.</p>
</dd>
</dl>
</div>
<div id="get-snapshot-status-shards-stats" class="dlist">
<dl>
<dt class="hdlist1"><code>shards_stats</code></dt>
<dd>
<p>(object)
Contains a count of shards in the snapshot.</p>
<details open>
<summary class="title">Properties of <code>shards_stats</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>initializing</code></dt>
<dd>
<p>(integer)
Number of shards that are still initializing.</p>
</dd>
<dt class="hdlist1"><code>started</code></dt>
<dd>
<p>(integer)
Number of shards that have started but not are not finalized.</p>
</dd>
<dt class="hdlist1"><code>finalizing</code></dt>
<dd>
<p>(integer)
Number of shards that are finalizing but are not done.</p>
</dd>
<dt class="hdlist1"><code>done</code></dt>
<dd>
<p>(integer)
Number of shards that initialized, started, and finalized successfully.</p>
</dd>
<dt class="hdlist1"><code>failed</code></dt>
<dd>
<p>(integer)
Number of shards that failed to be included in the snapshot.</p>
</dd>
<dt class="hdlist1"><code>total</code></dt>
<dd>
<p>(integer)
Total number of shards included in the snapshot.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
<div id="get-snapshot-status-stats" class="dlist">
<dl>
<dt class="hdlist1"><code>stats</code></dt>
<dd>
<p>(object)
Provides details on the number (<code>file_count</code>) and size (<code>size_in_bytes</code>) of files included in the snapshot.</p>
<details open>
<summary class="title">Properties of <code>stats</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>incremental</code></dt>
<dd>
<p>(object)
Number and size of files that still need to be copied as part of the incremental snapshot.</p>
<div class="paragraph">
<p>For completed snapshots, this property indicates the number and size
of files that were not already in the repository and were copied as
part of the incremental snapshot.</p>
</div>
</dd>
<dt class="hdlist1"><code>processed</code></dt>
<dd>
<p>(object)
Number and size of files that have already been uploaded to the snapshot. After a file is uploaded, the processed <code>file_count</code> and <code>size_in_bytes</code> are incremented in <code>stats</code>.</p>
</dd>
<dt class="hdlist1"><code>total</code></dt>
<dd>
<p>(object)
Total number and size of files that are referenced by the snapshot.</p>
</dd>
</dl>
</div>
<div id="get-snapshot-status-start-time" class="dlist">
<dl>
<dt class="hdlist1"><code>start_time_in_millis</code></dt>
<dd>
<p>(long)
The time, in milliseconds, when the snapshot creation process started.</p>
</dd>
</dl>
</div>
<div id="get-snapshot-status-total-time" class="dlist">
<dl>
<dt class="hdlist1"><code>time_in_millis</code></dt>
<dd>
<p>(long)
The total time, in milliseconds, that it took for the snapshot process
to complete.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt class="hdlist1"><code>&lt;index&gt;</code></dt>
<dd>
<p>(list of objects)
List of objects containing information about the
indices included in the snapshot.</p>
<details open>
<summary class="title">Properties of <code>&lt;index&gt;</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>shards_stats</code></dt>
<dd>
<p>(object)
See <a href="search.html#get-snapshot-status-shards-stats"><code>shards_stats</code></a>.</p>
</dd>
<dt class="hdlist1"><code>stats</code></dt>
<dd>
<p>(object)
See <a href="search.html#get-snapshot-status-stats"><code>stats</code></a>.</p>
</dd>
<dt class="hdlist1"><code>shards</code></dt>
<dd>
<p>(list of objects)
List of objects containing information about the
shards that include the snapshot.</p>
<details open>
<summary class="title">Properties of <code>shards</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>stage</code></dt>
<dd>
<p>(string)
Indicates the current state of the shards that include the snapshot.</p>
<details open>
<summary class="title">Properties of <code>stage</code></summary>
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>DONE</code></dt>
<dd>
<p>Number of shards in the snapshot that were successfully stored in the repository.</p>
</dd>
<dt class="hdlist1"><code>FAILURE</code></dt>
<dd>
<p>Number of shards in the snapshot that were not successfully stored in
the repository.</p>
</dd>
<dt class="hdlist1"><code>FINALIZE</code></dt>
<dd>
<p>Number of shards in the snapshot that are in the finalizing stage
of being stored in the repository.</p>
</dd>
<dt class="hdlist1"><code>INIT</code></dt>
<dd>
<p>Number of shards in the snapshot that are in the initializing stage
of being stored in the repository.</p>
</dd>
<dt class="hdlist1"><code>STARTED</code></dt>
<dd>
<p>Number of shards in the snapshot that are in the started stage
of being stored in the repository.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
<dt class="hdlist1"><code>stats</code></dt>
<dd>
<p>(object)
See <a href="search.html#get-snapshot-status-stats"><code>stats</code></a>.</p>
</dd>
<dt class="hdlist1"><code>total</code></dt>
<dd>
<p>(object)
Total number and size of files that are referenced by the snapshot.</p>
</dd>
<dt class="hdlist1"><code>start_time_in_millis</code></dt>
<dd>
<p>(long)
See <a href="search.html#get-snapshot-status-start-time"><code>start_time_in_millis</code></a>.</p>
</dd>
<dt class="hdlist1"><code>time_in_millis</code></dt>
<dd>
<p>(long)
See <a href="search.html#get-snapshot-status-total-time"><code>time_in_millis</code></a>.</p>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
</details>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="get-snapshot-status-api-example">Example</h4>
<div class="paragraph">
<p>The following request returns detailed status information for <code>snapshot_2</code> in the <code>my_repository</code> repository. This response includes additional information beyond the <a href="search.html#get-snapshot-api">Get snapshot API</a>, such as shard status and file statistics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_snapshot/my_repository/snapshot_2/_status</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "snapshots" : [
    {
      "snapshot" : "snapshot_2",
      "repository" : "my_repository",
      "uuid" : "lNeQD1SvTQCqqJUMQSwmGg",
      "state" : "SUCCESS",
      "include_global_state" : false,
      "shards_stats" : {
        "initializing" : 0,
        "started" : 0,
        "finalizing" : 0,
        "done" : 1,
        "failed" : 0,
        "total" : 1
      },
      "stats" : {
        "incremental" : {
          "file_count" : 3,
          "size_in_bytes" : 5969
        },
        "total" : {
          "file_count" : 4,
          "size_in_bytes" : 6024
        },
        "start_time_in_millis" : 1594829326691,
        "time_in_millis" : 205
      },
      "indices" : {
        "index_1" : {
          "shards_stats" : {
            "initializing" : 0,
            "started" : 0,
            "finalizing" : 0,
            "done" : 1,
            "failed" : 0,
            "total" : 1
          },
          "stats" : {
            "incremental" : {
              "file_count" : 3,
              "size_in_bytes" : 5969
            },
            "total" : {
              "file_count" : 4,
              "size_in_bytes" : 6024
            },
            "start_time_in_millis" : 1594829326896,
            "time_in_millis" : 0
          },
          "shards" : {
            "0" : {
              "stage" : "DONE",
              "stats" : {
                "incremental" : {
                  "file_count" : 3,
                  "size_in_bytes" : 5969
                },
                "total" : {
                  "file_count" : 4,
                  "size_in_bytes" : 6024
                },
                "start_time_in_millis" : 1594829326896,
                "time_in_millis" : 0
              }
            }
          }
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restore-snapshot-api">Restore snapshot API</h3>
<titleabbrev>Restore snapshot</titleabbrev>
<div class="paragraph">
<p>Restores a <a href="snapshot-restore.html">snapshot</a> of a cluster or specified indices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /_snapshot/my_repository/my_snapshot/_restore</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="restore-snapshot-api-request">Request</h4>
<div class="paragraph">
<p><code>POST /_snapshot/&lt;repository&gt;/&lt;snapshot&gt;/_restore</code></p>
</div>
</div>
<div class="sect3">
<h4 id="restore-snapshot-api-desc">Description</h4>
<div class="paragraph">
<p>Use the restore snapshot API to restore a snapshot of a cluster, including all indices in the snapshot. If you do not want to restore the entire snapshot, you can select specific indices to restore.</p>
</div>
<div class="paragraph">
<p>You can run the restore operation on a cluster that contains an elected
<a href="settings.html#master-node">master node</a> and has data nodes with enough capacity to accommodate the snapshot
you are restoring. Existing indices can only be restored if they are
<a href="indices.html#indices-close">closed</a> and have the same number of shards as the indices in
the snapshot. The restore operation automatically opens restored indices if
they were closed and creates new indices if they do not exist in the cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="restore-snapshot-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the repository to restore a snapshot from.</p>
</dd>
<dt class="hdlist1"><code>&lt;snapshot&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the snapshot to restore.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3 child-attributes">
<h4 id="restore-snapshot-api-request-body">Request body</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ignore_unavailable</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns an error for any index that is missing or closed. Defaults to <code>false</code>.</p>
<div class="paragraph">
<p>If <code>true</code>, the request ignores indices in <code>indices</code> that are missing or closed.</p>
</div>
</dd>
<dt class="hdlist1"><code>ignore_index_settings</code></dt>
<dd>
<p>(Optional, string)
A comma-separated list of index settings that should not be restored from a snapshot.</p>
</dd>
<dt class="hdlist1"><code>include_aliases</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>true</code>, index aliases from the original snapshot are restored.
Defaults to <code>true</code>.</p>
<div class="paragraph">
<p>If <code>false</code>, prevents aliases from being restored together with associated
indices.</p>
</div>
</dd>
</dl>
</div>
<div id="restore-snapshot-api-include-global-state" class="dlist">
<dl>
<dt class="hdlist1"><code>include_global_state</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, Boolean)
If <code>false</code>, the cluster state is not restored. Defaults to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>If <code>true</code>, the current cluster state is included in the restore operation.</p>
</div>
<div class="paragraph">
<p>The cluster state includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistent cluster settings</p>
</li>
<li>
<p>Index templates</p>
</li>
<li>
<p>Legacy index templates</p>
</li>
<li>
<p>Ingest pipelines</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
By default, the entire restore operation will fail if one or more indices included in the snapshot do not have all primary shards available. You can change this behavior by setting <a href="search.html#restore-snapshot-api-partial"><code>partial</code></a> to <code>true</code>.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div id="restore-snapshot-api-index-settings" class="dlist">
<dl>
<dt class="hdlist1"><code>index_settings</code></dt>
<dd>
<p>(Optional, string)
A comma-separated list of settings to add or change in all restored indices. Use this parameter to override index settings when restoring snapshots.</p>
<div class="paragraph">
<p>For more information regarding all the different index-level settings
that you can specify, see
<a href="index-modules.html">index modules</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>indices</code></dt>
<dd>
<p>(Optional, string)
A comma-separated list of indices to restore from the snapshot.
<a href="api-conventions.html#multi-index">Multi-index syntax</a> is supported.</p>
<div class="paragraph">
<p>By default, a restore operation includes all indices in the snapshot. If this
argument is provided, the restore operation only includes the specified indices.</p>
</div>
</dd>
</dl>
</div>
<div id="restore-snapshot-api-partial" class="dlist">
<dl>
<dt class="hdlist1"><code>partial</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the entire restore operation will fail if one or more indices included in the snapshot do not have all primary shards available. Defaults to <code>false</code>.</p>
<div class="paragraph">
<p>If <code>true</code>, allows restoring a partial snapshot of indices with unavailable shards. Only shards that were successfully included in the snapshot
will be restored. All missing shards will be recreated as empty.</p>
</div>
</dd>
</dl>
</div>
<div id="restore-snapshot-api-rename-pattern" class="dlist">
<dl>
<dt class="hdlist1"><code>rename_pattern</code></dt>
<dd>
<p>(Optional, string)
Defines a rename pattern to apply to restored indices. Indices matching the rename pattern will be renamed according to
<a href="search.html#restore-snapshot-api-rename-replacement"><code>rename_replacement</code></a>.</p>
<div class="paragraph">
<p>The rename pattern is applied as defined by the regular expression that
supports referencing the original text, according to the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#appendReplacement-java.lang.StringBuffer-java.lang.String-"><code>appendReplacement</code></a> logic.</p>
</div>
<div class="paragraph">
<p>The request will fail if two or more indices will be renamed into the same name.</p>
</div>
</dd>
</dl>
</div>
<div id="restore-snapshot-api-rename-replacement" class="dlist">
<dl>
<dt class="hdlist1"><code>rename_replacement</code></dt>
<dd>
<p>(Optional, string)
Defines the rename replacement string. See <a href="search.html#restore-snapshot-api-rename-pattern"><code>rename_pattern</code></a> for more information.</p>
</dd>
<dt class="hdlist1"><code>wait_for_completion</code></dt>
<dd>
<p>(Optional, Boolean)
If <code>false</code>, the request returns a response when the restore operation initializes.
Defaults to <code>false</code>.</p>
<div class="paragraph">
<p>If <code>true</code>, the request returns a response when the restore operation
completes.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="restore-snapshot-api-example">Examples</h4>
<div class="paragraph">
<p>The following request restores <code>index_1</code> and <code>index_2</code> from <code>snapshot_2</code>. The <code>rename_pattern</code> and <code>rename_replacement</code> parameters indicate any index matching the regular expression <code>index_(.+)</code> will be renamed using the pattern <code>restored_index_$1</code> when restored.</p>
</div>
<div class="paragraph">
<p>For example, <code>index_1</code> will be renamed to <code>restored_index_1</code>. <code>index_2</code> will be renamed to <code>restored_index_2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /_snapshot/my_repository/snapshot_2/_restore?wait_for_completion=true
{
  "indices": "index_1,index_2",
  "ignore_unavailable": true,
  "include_global_state": false,
  "rename_pattern": "index_(.+)",
  "rename_replacement": "restored_index_$1",
  "include_aliases": false
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns an acknowledgement if the request succeeds. If the request encounters errors, the response indicates any issues found, such as
open indices that are blocking the restore operation from completing.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delete-snapshot-api">Delete snapshot API</h3>
<titleabbrev>Delete snapshot</titleabbrev>
<div class="paragraph">
<p>Deletes a <a href="snapshot-restore.html">snapshot</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">DELETE /_snapshot/my_repository/my_snapshot</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="delete-snapshot-api-request">Request</h4>
<div class="paragraph">
<p><code>DELETE /_snapshot/&lt;repository&gt;/&lt;snapshot&gt;</code></p>
</div>
</div>
<div class="sect3">
<h4 id="delete-snapshot-api-desc">Description</h4>
<div class="paragraph">
<p>Use the delete snapshot API to delete a <a href="snapshot-restore.html">snapshot</a>, which is a backup taken from a running OpenSearch cluster.</p>
</div>
<div class="paragraph">
<p>When deleting a snapshot from a repository, OpenSearch deletes all files that are associated with the snapshot and not used by any other snapshots. All files that are shared with at least one other existing snapshot are left intact.</p>
</div>
<div class="paragraph">
<p>If you attempt to delete a snapshot while it is being created, the snapshot process aborts and all associated will be deleted.</p>
</div>
<div class="paragraph">
<p>To delete multiple snapshots in a single request, separate the snapshot names with a comma or use a wildcard (<code>*</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Use the delete snapshot API to cancel long-running snapshot operations that were started by mistake.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="delete-snapshot-api-path-params">Path parameters</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;repository&gt;</code></dt>
<dd>
<p>(Required, string)
Name of the repository to delete a snapshot from.</p>
</dd>
<dt class="hdlist1"><code>&lt;snapshot&gt;</code></dt>
<dd>
<p>(Required, string)
Comma-separated list of snapshot names to delete. Also accepts wildcards (<code>*</code>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="delete-snapshot-api-example">Example</h4>
<div class="paragraph">
<p>The following request deletes <code>snapshot_2</code> and <code>snapshot_3</code> from the repository named <code>my_repository</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">DELETE /_snapshot/my_repository/snapshot_2,snapshot_3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API returns the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "acknowledged" : true
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="ingest-apis.html">Ingest APIs</a> | ↑ Up: <a href="rest-apis.html">REST APIs</a> | ⌂ Home: <a href="index.html">OpenSearch Reference</a> | Next: <a href="breaking-changes.html">Migration guide</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-04-12 14:08:20 -0700
</div>
</div>
</body>
</html>