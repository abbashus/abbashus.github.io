<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>Painless Scripting Language</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="painless-guide" class="book toc2 toc-left">
<div id="header">
<h1>Painless Scripting Language</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">Painless Scripting Language</a></span></p><ul class="sectlevel1">
<li><a href="painless-guide.html"><span class="toc-current">Painless Guide</span></a>
<ul class="sectlevel2">
<li><a href="painless-guide.html#painless-walkthrough">A Brief Painless Walkthrough</a>
</li>
<li><a href="painless-guide.html#painless-datetime">Using Datetime in Painless</a>
</li>
<li><a href="painless-guide.html#modules-scripting-painless-dispatch">How painless dispatches functions</a>
</li>
<li><a href="painless-guide.html#painless-debugging">Painless Debugging</a>
</li>
<li><a href="painless-guide.html#painless-execute-api">Painless execute API</a>
</li>
</ul>
</li>
<li><a href="redirects.html">Appendix A: Deleted pages</a>
</li>
<li><a href="painless-lang-spec.html">Painless Language Specification</a>
</li>
<li><a href="painless-contexts.html">Painless contexts</a>
</li>
<li><a href="painless-api-reference.html">Painless API Reference</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="painless-guide">Painless Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Painless</em> is a simple, secure scripting language. It is the default scripting language for OpenSearch and
can safely be used for inline and stored scripts. For a jump start into
Painless, see <a href="painless-guide.html#painless-walkthrough">A Brief Painless Walkthrough</a>. For a
detailed description of the Painless syntax and language features, see the
<a href="painless-lang-spec.html">Painless Language Specification</a>.</p>
</div>
<div class="paragraph">
<p>You can use Painless anywhere scripts are used in OpenSearch. Painless
provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fast performance: Painless scripts <a href="https://benchmarks.opensearch.org/index.html#search_qps_scripts">
run several times faster</a> than the alternatives.</p>
</li>
<li>
<p>Safety: Fine-grained allowlist with method call/field granularity. See the
<a href="https://www.opensearch.org/guide/en/opensearch/painless/{branch}/painless-api-reference.html">Painless API Reference</a> for a
complete list of available classes and methods.</p>
</li>
<li>
<p>Optional typing: Variables and parameters can use explicit types or the
dynamic <code>def</code> type.</p>
</li>
<li>
<p>Syntax: Extends a subset of Java&#8217;s syntax to provide additional scripting
language features.</p>
</li>
<li>
<p>Optimizations: Designed specifically for OpenSearch scripting.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="painless-walkthrough">A Brief Painless Walkthrough</h3>
<div class="paragraph">
<p>To illustrate how Painless works, let&#8217;s load some hockey stats into an OpenSearch index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT hockey/_bulk?refresh
{"index":{"_id":1}}
{"first":"johnny","last":"gaudreau","goals":[9,27,1],"assists":[17,46,0],"gp":[26,82,1],"born":"1993/08/13"}
{"index":{"_id":2}}
{"first":"sean","last":"monohan","goals":[7,54,26],"assists":[11,26,13],"gp":[26,82,82],"born":"1994/10/12"}
{"index":{"_id":3}}
{"first":"jiri","last":"hudler","goals":[5,34,36],"assists":[11,62,42],"gp":[24,80,79],"born":"1984/01/04"}
{"index":{"_id":4}}
{"first":"micheal","last":"frolik","goals":[4,6,15],"assists":[8,23,15],"gp":[26,82,82],"born":"1988/02/17"}
{"index":{"_id":5}}
{"first":"sam","last":"bennett","goals":[5,0,0],"assists":[8,1,0],"gp":[26,1,0],"born":"1996/06/20"}
{"index":{"_id":6}}
{"first":"dennis","last":"wideman","goals":[0,26,15],"assists":[11,30,24],"gp":[26,81,82],"born":"1983/03/20"}
{"index":{"_id":7}}
{"first":"david","last":"jones","goals":[7,19,5],"assists":[3,17,4],"gp":[26,45,34],"born":"1984/08/10"}
{"index":{"_id":8}}
{"first":"tj","last":"brodie","goals":[2,14,7],"assists":[8,42,30],"gp":[26,82,82],"born":"1990/06/07"}
{"index":{"_id":39}}
{"first":"mark","last":"giordano","goals":[6,30,15],"assists":[3,30,24],"gp":[26,60,63],"born":"1983/10/03"}
{"index":{"_id":10}}
{"first":"mikael","last":"backlund","goals":[3,15,13],"assists":[6,24,18],"gp":[26,82,82],"born":"1989/03/17"}
{"index":{"_id":11}}
{"first":"joe","last":"colborne","goals":[3,18,13],"assists":[6,20,24],"gp":[26,67,82],"born":"1990/01/30"}</code></pre>
</div>
</div>
<h4 id="_accessing_doc_values_from_painless" class="discrete">Accessing Doc Values from Painless</h4>
<div class="paragraph">
<p>Document values can be accessed from a <code>Map</code> named <code>doc</code>.</p>
</div>
<div class="paragraph">
<p>For example, the following script calculates a player&#8217;s total goals. This example uses a strongly typed <code>int</code> and a <code>for</code> loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET hockey/_search
{
  "query": {
    "function_score": {
      "script_score": {
        "script": {
          "lang": "painless",
          "source": """
            int total = 0;
            for (int i = 0; i &lt; doc['goals'].length; ++i) {
              total += doc['goals'][i];
            }
            return total;
          """
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you could do the same thing using a script field instead of a function score:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET hockey/_search
{
  "query": {
    "match_all": {}
  },
  "script_fields": {
    "total_goals": {
      "script": {
        "lang": "painless",
        "source": """
          int total = 0;
          for (int i = 0; i &lt; doc['goals'].length; ++i) {
            total += doc['goals'][i];
          }
          return total;
        """
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example uses a Painless script to sort the players by their combined first and last names. The names are accessed using
<code>doc['first'].value</code> and <code>doc['last'].value</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET hockey/_search
{
  "query": {
    "match_all": {}
  },
  "sort": {
    "_script": {
      "type": "string",
      "order": "asc",
      "script": {
        "lang": "painless",
        "source": "doc['first.keyword'].value + ' ' + doc['last.keyword'].value"
      }
    }
  }
}</code></pre>
</div>
</div>
<h4 id="_missing_values" class="discrete">Missing values</h4>
<div class="paragraph">
<p><code>doc['field'].value</code> throws an exception if
the field is missing in a document.</p>
</div>
<div class="paragraph">
<p>To check if a document is missing a value, you can call
<code>doc['field'].size() == 0</code>.</p>
</div>
<h4 id="_updating_fields_with_painless" class="discrete">Updating Fields with Painless</h4>
<div class="paragraph">
<p>You can also easily update fields. You access the original source for a field as <code>ctx._source.&lt;field-name&gt;</code>.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s look at the source data for a player by submitting the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET hockey/_search
{
  "query": {
    "term": {
      "_id": 1
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To change player 1&#8217;s last name to <code>hockey</code>, simply set <code>ctx._source.last</code> to the new value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST hockey/_update/1
{
  "script": {
    "lang": "painless",
    "source": "ctx._source.last = params.last",
    "params": {
      "last": "hockey"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add fields to a document. For example, this script adds a new field that contains
the player&#8217;s nickname,  <em>hockey</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST hockey/_update/1
{
  "script": {
    "lang": "painless",
    "source": """
      ctx._source.last = params.last;
      ctx._source.nick = params.nick
    """,
    "params": {
      "last": "gaudreau",
      "nick": "hockey"
    }
  }
}</code></pre>
</div>
</div>
<h4 id="modules-scripting-painless-dates" class="discrete">Dates</h4>
<div class="paragraph">
<p>Date fields are exposed as
<code>ZonedDateTime</code>, so they support methods like <code>getYear</code>, <code>getDayOfWeek</code>
or e.g. getting milliseconds since epoch with <code>getMillis</code>. To use these
in a script, leave out the <code>get</code> prefix and continue with lowercasing the
rest of the method name. For example, the following returns every hockey
player&#8217;s birth year:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET hockey/_search
{
  "script_fields": {
    "birth_year": {
      "script": {
        "source": "doc.born.value.year"
      }
    }
  }
}</code></pre>
</div>
</div>
<h4 id="modules-scripting-painless-regex" class="discrete">Regular expressions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Regexes are enabled by default as the Setting <code>script.painless.regex.enabled</code>
has a new option, <code>limited</code>, the default. This defaults to using regular expressions
but limiting the complexity of the regular expressions. Innocuous looking regexes
can have staggering performance and stack depth behavior. But still, they remain an
amazingly powerful tool. In addition, to <code>limited</code>, the setting can be set to <code>true</code>,
as before, which enables regular expressions without limiting them.To enable them
yourself set <code>script.painless.regex.enabled: true</code> in <code>opensearch.yml</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Painless&#8217;s native support for regular expressions has syntax constructs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/pattern/</code>: Pattern literals create patterns. This is the only way to create
a pattern in painless. The pattern inside the /'s are just
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java regular expressions</a>.
See <a href="painless-lang-spec.html#pattern-flags">Pattern flags</a> for more.</p>
</li>
<li>
<p><code>=~</code>: The find operator return a <code>boolean</code>, <code>true</code> if a subsequence of the
text matches, <code>false</code> otherwise.</p>
</li>
<li>
<p><code>==~</code>: The match operator returns a <code>boolean</code>, <code>true</code> if the text matches,
<code>false</code> if it doesn&#8217;t.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the find operator (<code>=~</code>) you can update all hockey players with "b" in
their last name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST hockey/_update_by_query
{
  "script": {
    "lang": "painless",
    "source": """
      if (ctx._source.last =~ /b/) {
        ctx._source.last += "matched";
      } else {
        ctx.op = "noop";
      }
    """
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the match operator (<code>==~</code>) you can update all the hockey players whose
names start with a consonant and end with a vowel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST hockey/_update_by_query
{
  "script": {
    "lang": "painless",
    "source": """
      if (ctx._source.last ==~ /[^aeiou].*[aeiou]/) {
        ctx._source.last += "matched";
      } else {
        ctx.op = "noop";
      }
    """
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>Pattern.matcher</code> directly to get a <code>Matcher</code> instance and
remove all of the vowels in all of their last names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST hockey/_update_by_query
{
  "script": {
    "lang": "painless",
    "source": "ctx._source.last = /[aeiou]/.matcher(ctx._source.last).replaceAll('')"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Matcher.replaceAll</code> is just a call to Java&#8217;s <code>Matcher&#8217;s
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#replaceAll-java.lang.String-">replaceAll</a>
method so it supports `$1</code> and <code>\1</code> for replacements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST hockey/_update_by_query
{
  "script": {
    "lang": "painless",
    "source": "ctx._source.last = /n([aeiou])/.matcher(ctx._source.last).replaceAll('$1')"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need more control over replacements you can call <code>replaceAll</code> on a
<code>CharSequence</code> with a <code>Function&lt;Matcher, String&gt;</code> that builds the replacement.
This does not support <code>$1</code> or <code>\1</code> to access replacements because you already
have a reference to the matcher and can get them with <code>m.group(1)</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Calling <code>Matcher.find</code> inside of the function that builds the
replacement is rude and will likely break the replacement process.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will make all of the vowels in the hockey player&#8217;s last names upper case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST hockey/_update_by_query
{
  "script": {
    "lang": "painless",
    "source": """
      ctx._source.last = ctx._source.last.replaceAll(/[aeiou]/, m -&gt;
        m.group().toUpperCase(Locale.ROOT))
    """
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can use the <code>CharSequence.replaceFirst</code> to make the first vowel in their
last names upper case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST hockey/_update_by_query
{
  "script": {
    "lang": "painless",
    "source": """
      ctx._source.last = ctx._source.last.replaceFirst(/[aeiou]/, m -&gt;
        m.group().toUpperCase(Locale.ROOT))
    """
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: all of the <code>_update_by_query</code> examples above could really do with a
<code>query</code> to limit the data that they pull back. While you <strong>could</strong> use a
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/query-dsl-script-query.html">script query</a> it wouldn&#8217;t be as efficient
as using any other query because script queries aren&#8217;t able to use the inverted
index to limit the documents that they have to check.</p>
</div>
</div>
<div class="sect2">
<h3 id="painless-datetime">Using Datetime in Painless</h3>
<div class="sect3">
<h4 id="_datetime_api">Datetime API</h4>
<div class="paragraph">
<p>Datetimes in Painless use the standard Java libraries and are available through
the Painless <a href="painless-api-reference.html#painless-api-reference-shared">Shared API</a>. Most of the classes
from the following Java packages are available to use in Painless scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="painless-api-reference.html#painless-api-reference-shared-java-time">java.time</a></p>
</li>
<li>
<p><a href="painless-api-reference.html#painless-api-reference-shared-java-time-chrono">java.time.chrono</a></p>
</li>
<li>
<p><a href="painless-api-reference.html#painless-api-reference-shared-java-time-format">java.time.format</a></p>
</li>
<li>
<p><a href="painless-api-reference.html#painless-api-reference-shared-java-time-temporal">java.time.temporal</a></p>
</li>
<li>
<p><a href="painless-api-reference.html#painless-api-reference-shared-java-time-zone">java.time.zone</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_representation">Datetime Representation</h4>
<div class="paragraph">
<p>Datetimes in Painless are most commonly represented as a numeric value, a
string value, or a complex value.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">numeric</dt>
<dd>
<p>a datetime representation as a number from a starting offset called
an epoch; in Painless this is typically a <a href="painless-lang-spec.html#primitive-types">long</a> as
milliseconds since an epoch of 1970-01-01 00:00:00 Zulu Time</p>
</dd>
<dt class="hdlist1">string</dt>
<dd>
<p>a datetime representation as a sequence of characters defined by
a standard format or a custom format; in Painless this is typically a
<a href="painless-lang-spec.html#string-type">String</a> of the standard format
<a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a></p>
</dd>
<dt class="hdlist1">complex</dt>
<dd>
<p>a datetime representation as a complex type
(<a href="painless-lang-spec.html#reference-types">object</a>) that abstracts away internal details of how the
datetime is stored and often provides utilities for modification and
comparison; in Painless this is typically a
<a href="painless-api-reference.html#painless-api-reference-shared-ZonedDateTime">ZonedDateTime</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Switching between different representations of datetimes is often necessary to
achieve a script&#8217;s objective(s). A typical pattern in a script is to switch a
numeric or string datetime to a complex datetime, modify or compare the complex
datetime, and then switch it back to a numeric or string datetime for storage
or to return a result.</p>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_parsing_and_formatting">Datetime Parsing and Formatting</h4>
<div class="paragraph">
<p>Datetime parsing is a switch from a string datetime to a complex datetime, and
datetime formatting is a switch from a complex datetime to a string datetime.</p>
</div>
<div class="paragraph">
<p>A <a href="painless-api-reference.html#painless-api-reference-shared-DateTimeFormatter">DateTimeFormatter</a> is a
complex type (<a href="painless-lang-spec.html#reference-types">object</a>) that defines the allowed sequence
of characters for a string datetime. Datetime parsing and formatting often
require a DateTimeFormatter. For more information about how to use a
DateTimeFormatter see the
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/format/DateTimeFormatter.html">Java documentation</a>.</p>
</div>
<div class="sect4">
<h5 id="_datetime_parsing_examples">Datetime Parsing Examples</h5>
<div class="ulist">
<ul>
<li>
<p>parse from milliseconds</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">String milliSinceEpochString = "434931330000";
long milliSinceEpoch = Long.parseLong(milliSinceEpochString);
Instant instant = Instant.ofEpochMilli(milliSinceEpoch);
ZonedDateTime zdt = ZonedDateTime.ofInstant(instant, ZoneId.of('Z'));</code></pre>
</div>
</div>
</li>
<li>
<p>parse from ISO 8601</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">String datetime = '1983-10-13T22:15:30Z';
ZonedDateTime zdt = ZonedDateTime.parse(datetime); <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note the parse method uses ISO 8601 by default.</p>
</li>
</ol>
</div>
</li>
<li>
<p>parse from RFC 1123</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">String datetime = 'Thu, 13 Oct 1983 22:15:30 GMT';
ZonedDateTime zdt = ZonedDateTime.parse(datetime,
        DateTimeFormatter.RFC_1123_DATE_TIME); <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note the use of a built-in DateTimeFormatter.</p>
</li>
</ol>
</div>
</li>
<li>
<p>parse from a custom format</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">String datetime = 'custom y 1983 m 10 d 13 22:15:30 Z';
DateTimeFormatter dtf = DateTimeFormatter.ofPattern(
        "'custom' 'y' yyyy 'm' MM 'd' dd HH:mm:ss VV");
ZonedDateTime zdt = ZonedDateTime.parse(datetime, dtf); <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note the use of a custom DateTimeFormatter.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_datetime_formatting_examples">Datetime Formatting Examples</h5>
<div class="ulist">
<ul>
<li>
<p>format to ISO 8601</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
String datetime = zdt.format(DateTimeFormatter.ISO_INSTANT); <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note the use of a built-in DateTimeFormatter.</p>
</li>
</ol>
</div>
</li>
<li>
<p>format to a custom format</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
DateTimeFormatter dtf = DateTimeFormatter.ofPattern(
        "'date:' yyyy/MM/dd 'time:' HH:mm:ss");
String datetime = zdt.format(dtf); <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note the use of a custom DateTimeFormatter.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_conversion">Datetime Conversion</h4>
<div class="paragraph">
<p>Datetime conversion is a switch from a numeric datetime to a complex datetime
and vice versa.</p>
</div>
<div class="sect4">
<h5 id="_datetime_conversion_examples">Datetime Conversion Examples</h5>
<div class="ulist">
<ul>
<li>
<p>convert from milliseconds</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">long milliSinceEpoch = 434931330000L;
Instant instant = Instant.ofEpochMilli(milliSinceEpoch);
ZonedDateTime zdt = ZonedDateTime.ofInstant(instant, ZoneId.of('Z'));</code></pre>
</div>
</div>
</li>
<li>
<p>convert to milliseconds</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
long milliSinceEpoch = zdt.toInstant().toEpochMilli();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_pieces">Datetime Pieces</h4>
<div class="paragraph">
<p>Datetime representations often contain the data to extract individual datetime
pieces such as year, hour, timezone, etc. Use individual pieces of a datetime
to create a complex datetime, and use a complex datetime to extract individual
pieces.</p>
</div>
<div class="sect4">
<h5 id="_datetime_pieces_examples">Datetime Pieces Examples</h5>
<div class="ulist">
<ul>
<li>
<p>create a complex datetime from pieces</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">int year = 1983;
int month = 10;
int day = 13;
int hour = 22;
int minutes = 15;
int seconds = 30;
int nanos = 0;
ZonedDateTime zdt = ZonedDateTime.of(
        year, month, day, hour, minutes, seconds, nanos, ZoneId.of('Z'));</code></pre>
</div>
</div>
</li>
<li>
<p>extract pieces from a complex datetime</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 100, ZoneId.of(tz));
int year = zdt.getYear();
int month = zdt.getMonthValue();
int day = zdt.getDayOfMonth();
int hour = zdt.getHour();
int minutes = zdt.getMinute();
int seconds = zdt.getSecond();
int nanos = zdt.getNano();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_modification">Datetime Modification</h4>
<div class="paragraph">
<p>Use either a numeric datetime or a complex datetime to do modification such as
adding several seconds to a datetime or subtracting several days from a
datetime. Use standard <a href="painless-lang-spec.html#painless-operators-numeric">numeric operators</a> to
modify a numeric datetime. Use
<a href="painless-api-reference.html#painless-api-reference-shared-ZonedDateTime">methods</a> (or fields) to modify
a complex datetime. Note many complex datetimes are immutable so upon
modification a new complex datetime is created that requires
<a href="painless-lang-spec.html#variable-assignment">assignment</a> or immediate use.</p>
</div>
<div class="sect4">
<h5 id="_datetime_modification_examples">Datetime Modification Examples</h5>
<div class="ulist">
<ul>
<li>
<p>Subtract three seconds from a numeric datetime in milliseconds</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">long milliSinceEpoch = 434931330000L;
milliSinceEpoch = milliSinceEpoch - 1000L*3L;</code></pre>
</div>
</div>
</li>
<li>
<p>Add three days to a complex datetime</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime updatedZdt = zdt.plusDays(3);</code></pre>
</div>
</div>
</li>
<li>
<p>Subtract 125 minutes from a complex datetime</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime updatedZdt = zdt.minusMinutes(125);</code></pre>
</div>
</div>
</li>
<li>
<p>Set the year on a complex datetime</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime updatedZdt = zdt.withYear(1976);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_difference_elapsed_time">Datetime Difference (Elapsed Time)</h4>
<div class="paragraph">
<p>Use either two numeric datetimes or two complex datetimes to calculate the
difference (elapsed time) between two different datetimes. Use
<a href="painless-lang-spec.html#subtraction-operator">subtraction</a> to calculate the difference between two
numeric datetimes of the same time unit such as milliseconds. For
complex datetimes there is often a method or another complex type
(<a href="painless-lang-spec.html#reference-types">object</a>) available to calculate the difference. Use
<a href="painless-api-reference.html#painless-api-reference-shared-ChronoUnit">ChronoUnit</a>
to calculate the difference between two complex datetimes if supported.</p>
</div>
<div class="sect4">
<h5 id="_datetime_difference_examples">Datetime Difference Examples</h5>
<div class="ulist">
<ul>
<li>
<p>Difference in milliseconds between two numeric datetimes</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">long startTimestamp = 434931327000L;
long endTimestamp = 434931330000L;
long differenceInMillis = endTimestamp - startTimestamp;</code></pre>
</div>
</div>
</li>
<li>
<p>Difference in milliseconds between two complex datetimes</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 11000000, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 35, 0, ZoneId.of('Z'));
long differenceInMillis = ChronoUnit.MILLIS.between(zdt1, zdt2);</code></pre>
</div>
</div>
</li>
<li>
<p>Difference in days between two complex datetimes</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 11000000, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 17, 22, 15, 35, 0, ZoneId.of('Z'));
long differenceInDays = ChronoUnit.DAYS.between(zdt1, zdt2);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_comparison">Datetime Comparison</h4>
<div class="paragraph">
<p>Use either two numeric datetimes or two complex datetimes to do a datetime
comparison. Use standard <a href="painless-lang-spec.html#painless-operators-boolean">comparison operators</a>
to compare two numeric datetimes of the same time unit such as milliseconds.
For complex datetimes there is often a method or another complex type
(<a href="painless-lang-spec.html#reference-types">object</a>) available to do the comparison.</p>
</div>
<div class="sect4">
<h5 id="_datetime_comparison_examples">Datetime Comparison Examples</h5>
<div class="ulist">
<ul>
<li>
<p>Greater than comparison of two numeric datetimes in milliseconds</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">long timestamp1 = 434931327000L;
long timestamp2 = 434931330000L;

if (timestamp1 &gt; timestamp2) {
   // handle condition
}</code></pre>
</div>
</div>
</li>
<li>
<p>Equality comparison of two complex datetimes</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));

if (zdt1.equals(zdt2)) {
    // handle condition
}</code></pre>
</div>
</div>
</li>
<li>
<p>Less than comparison of two complex datetimes</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 17, 22, 15, 35, 0, ZoneId.of('Z'));

if (zdt1.isBefore(zdt2)) {
    // handle condition
}</code></pre>
</div>
</div>
</li>
<li>
<p>Greater than comparison of two complex datetimes</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime zdt1 =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime zdt2 =
        ZonedDateTime.of(1983, 10, 17, 22, 15, 35, 0, ZoneId.of('Z'));

if (zdt1.isAfter(zdt2)) {
    // handle condition
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_zone">Datetime Zone</h4>
<div class="paragraph">
<p>Both string datetimes and complex datetimes have a timezone with a default of
<code>UTC</code>. Numeric datetimes do not have enough explicit information to
have a timezone, so <code>UTC</code> is always assumed. Use
<a href="painless-api-reference.html#painless-api-reference-shared-ZonedDateTime">methods</a> (or fields) in
conjunction with a <a href="painless-api-reference.html#painless-api-reference-shared-ZoneId">ZoneId</a> to change
the timezone for a complex datetime. Parse a string datetime into a complex
datetime to change the timezone, and then format the complex datetime back into
a desired string datetime. Note many complex datetimes are immutable so upon
modification a new complex datetime is created that requires
<a href="painless-lang-spec.html#variable-assignment">assignment</a> or immediate use.</p>
</div>
<div class="sect4">
<h5 id="_datetime_zone_examples">Datetime Zone Examples</h5>
<div class="ulist">
<ul>
<li>
<p>Modify the timezone for a complex datetime</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime utc =
        ZonedDateTime.of(1983, 10, 13, 22, 15, 30, 0, ZoneId.of('Z'));
ZonedDateTime pst = utc.withZoneSameInstant(ZoneId.of('America/Los_Angeles'));</code></pre>
</div>
</div>
</li>
<li>
<p>Modify the timezone for a string datetime</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">String gmtString = 'Thu, 13 Oct 1983 22:15:30 GMT';
ZonedDateTime gmtZdt = ZonedDateTime.parse(gmtString,
        DateTimeFormatter.RFC_1123_DATE_TIME); <b class="conum">(1)</b>
ZonedDateTime pstZdt =
        gmtZdt.withZoneSameInstant(ZoneId.of('America/Los_Angeles'));
String pstString = pstZdt.format(DateTimeFormatter.RFC_1123_DATE_TIME);</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note the use of a built-in DateTimeFormatter.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_input">Datetime Input</h4>
<div class="paragraph">
<p>There are several common ways datetimes are used as input for a script
determined by the <a href="painless-contexts.html">Painless context</a>. Typically, datetime
input will be accessed from parameters specified by the user, from an original
source document, or from an indexed document.</p>
</div>
<div class="sect4">
<h5 id="_datetime_input_from_user_parameters">Datetime Input From User Parameters</h5>
<div class="paragraph">
<p>Use the <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-scripting-using.html#_script_parameters">params section</a>
during script specification to pass in a numeric datetime or string datetime as
a script input. Access to user-defined parameters within a script is dependent
on the Painless context, though, the parameters are most commonly accessible
through an input called <code>params</code>.</p>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Parse a numeric datetime from user parameters to a complex datetime</p>
<div class="ulist">
<ul>
<li>
<p>Input:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">...
"script": {
    ...
    "params": {
        "input_datetime": 434931327000
    }
}
...</code></pre>
</div>
</div>
</li>
<li>
<p>Script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">long inputDateTime = params['input_datetime'];
Instant instant = Instant.ofEpochMilli(inputDateTime);
ZonedDateTime zdt = ZonedDateTime.ofInstant(instant, ZoneId.of('Z'));</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Parse a string datetime from user parameters to a complex datetime</p>
<div class="ulist">
<ul>
<li>
<p>Input:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">...
"script": {
    ...
    "params": {
        "input_datetime": "custom y 1983 m 10 d 13 22:15:30 Z"
    }
}
...</code></pre>
</div>
</div>
</li>
<li>
<p>Script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">String datetime = params['input_datetime'];
DateTimeFormatter dtf = DateTimeFormatter.ofPattern(
        "'custom' 'y' yyyy 'm' MM 'd' dd HH:mm:ss VV");
ZonedDateTime zdt = ZonedDateTime.parse(datetime, dtf); <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note the use of a custom DateTimeFormatter.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_datetime_input_from_a_source_document">Datetime Input From a Source Document</h5>
<div class="paragraph">
<p>Use an original <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/mapping-source-field.html">source</a> document as a script
input to access a numeric datetime or string datetime for a specific field
within that document. Access to an original source document within a script is
dependent on the Painless context and is not always available. An original
source document is most commonly accessible through an input called
<code>ctx['_source']</code> or <code>params['_source']</code>.</p>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Parse a numeric datetime from a sourced document to a complex datetime</p>
<div class="ulist">
<ul>
<li>
<p>Input:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">{
  ...
  "input_datetime": 434931327000
  ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>Script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">long inputDateTime = ctx['_source']['input_datetime']; <b class="conum">(1)</b>
Instant instant = Instant.ofEpochMilli(inputDateTime);
ZonedDateTime zdt = ZonedDateTime.ofInstant(instant, ZoneId.of('Z'));</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note access to <code>_source</code> is dependent on the Painless context.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Parse a string datetime from a sourced document to a complex datetime</p>
<div class="ulist">
<ul>
<li>
<p>Input:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">{
  ...
  "input_datetime": "1983-10-13T22:15:30Z"
  ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>Script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">String datetime = params['_source']['input_datetime']; <b class="conum">(1)</b>
ZonedDateTime zdt = ZonedDateTime.parse(datetime); <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note access to <code>_source</code> is dependent on the Painless context.</p>
</li>
<li>
<p>Note the parse method uses ISO 8601 by default.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_datetime_input_from_an_indexed_document">Datetime Input From an Indexed Document</h5>
<div class="paragraph">
<p>Use an indexed document as a script input to access a complex datetime for a
specific field within that document where the field is mapped as a
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/date.html">standard date</a> or a <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/date_nanos.html">nanosecond date</a>.
Numeric datetime fields mapped as <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/number.html">numeric</a> and string
datetime fields mapped as <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/keyword.html">keyword</a> are accessible through an
indexed document as well. Access to an indexed document within a script is
dependent on the Painless context and is not always available. An indexed
document is most commonly accessible through an input called <code>doc</code>.</p>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Format a complex datetime from an indexed document to a string datetime</p>
<div class="ulist">
<ul>
<li>
<p>Assumptions:</p>
<div class="ulist">
<ul>
<li>
<p>The field <code>input_datetime</code> exists in all indexes as part of the query</p>
</li>
<li>
<p>All indexed documents contain the field <code>input_datetime</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Mappings:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">{
  "mappings": {
    ...
    "properties": {
      ...
      "input_datetime": {
        "type": "date"
      }
      ...
    }
    ...
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime input = doc['input_datetime'].value;
String output = input.format(DateTimeFormatter.ISO_INSTANT); <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note the use of a built-in DateTimeFormatter.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Find the difference between two complex datetimes from an indexed document</p>
<div class="ulist">
<ul>
<li>
<p>Assumptions:</p>
<div class="ulist">
<ul>
<li>
<p>The fields <code>start</code> and <code>end</code> may <strong>not</strong> exist in all indexes as part of the
query</p>
</li>
<li>
<p>The fields <code>start</code> and <code>end</code> may <strong>not</strong> have values in all indexed documents</p>
</li>
</ul>
</div>
</li>
<li>
<p>Mappings:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">{
  "mappings": {
    ...
    "properties": {
      ...
      "start": {
        "type": "date"
      },
      "end": {
        "type": "date"
      }
      ...
    }
    ...
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">if (doc.containsKey('start') &amp;&amp; doc.containsKey('end')) { <b class="conum">(1)</b>

    if (doc['start'].size() &gt; 0 &amp;&amp; doc['end'].size() &gt; 0) { <b class="conum">(2)</b>

        ZonedDateTime start = doc['start'].value;
        ZonedDateTime end = doc['end'].value;
        long differenceInMillis = ChronoUnit.MILLIS.between(start, end);

        // handle difference in times
    } else {
        // handle fields without values
    }
} else {
    // handle index with missing fields
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>When a query&#8217;s results span multiple indexes, some indexes may not
contain a specific field. Use the <code>containsKey</code> method call on the <code>doc</code> input
to ensure a field exists as part of the index for the current document.</p>
</li>
<li>
<p>Some fields within a document may have no values. Use the <code>size</code> method
call on a field within the <code>doc</code> input to ensure that field has at least one
value for the current document.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_now">Datetime Now</h4>
<div class="paragraph">
<p>Under most Painless contexts the current datetime, <code>now</code>, is not supported.
There are two primary reasons for this. The first is that scripts are often run once
per document, so each time the script is run a different <code>now</code> is returned. The
second is that scripts are often run in a distributed fashion without a way to
appropriately synchronize <code>now</code>. Instead, pass in a user-defined parameter with
either a string datetime or numeric datetime for <code>now</code>. A numeric datetime is
preferred as there is no need to parse it for comparison.</p>
</div>
<div class="sect4">
<h5 id="_datetime_now_examples">Datetime Now Examples</h5>
<div class="ulist">
<ul>
<li>
<p>Use a numeric datetime as <code>now</code></p>
<div class="ulist">
<ul>
<li>
<p>Assumptions:</p>
<div class="ulist">
<ul>
<li>
<p>The field <code>input_datetime</code> exists in all indexes as part of the query</p>
</li>
<li>
<p>All indexed documents contain the field <code>input_datetime</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Mappings:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">{
  "mappings": {
      ...
      "properties": {
        ...
        "input_datetime": {
        "type": "date"
      }
      ...
    }
    ...
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Input:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">...
"script": {
    ...
    "params": {
        "now": &lt;generated numeric datetime in milliseconds since epoch&gt;
    }
}
...</code></pre>
</div>
</div>
</li>
<li>
<p>Script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">long now = params['now'];
ZonedDateTime inputDateTime = doc['input_datetime'];
long millisDateTime = zdt.toInstant().toEpochMilli();
long elapsedTime = now - millisDateTime;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Use a string datetime as <code>now</code></p>
<div class="ulist">
<ul>
<li>
<p>Assumptions:</p>
<div class="ulist">
<ul>
<li>
<p>The field <code>input_datetime</code> exists in all indexes as part of the query</p>
</li>
<li>
<p>All indexed documents contain the field <code>input_datetime</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Mappings:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">{
  "mappings": {
    ...
    "properties": {
      ...
      "input_datetime": {
        "type": "date"
      }
      ...
    }
    ...
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Input:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JSON" data-lang="JSON">...
"script": {
    ...
    "params": {
        "now": "&lt;generated string datetime in ISO-8601&gt;"
    }
}
...</code></pre>
</div>
</div>
</li>
<li>
<p>Script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">String nowString = params['now'];
ZonedDateTime nowZdt = ZonedDateTime.parse(nowString); <b class="conum">(1)</b>
long now = ZonedDateTime.toInstant().toEpochMilli();
ZonedDateTime inputDateTime = doc['input_datetime'];
long millisDateTime = zdt.toInstant().toEpochMilli();
long elapsedTime = now - millisDateTime;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note this parses the same string datetime every time the script runs. Use a
numeric datetime to avoid a significant performance hit.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_datetime_examples_in_contexts">Datetime Examples in Contexts</h4>
<div class="sect4">
<h5 id="_load_the_example_data">Load the Example Data</h5>
<div class="paragraph">
<p>Run the following curl commands to load the data necessary for the context
examples into an OpenSearch cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/mapping.html">mappings</a> for the sample data.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /messages
{
  "mappings": {
    "properties": {
      "priority": {
        "type": "integer"
      },
      "datetime": {
        "type": "date"
      },
      "message": {
        "type": "text"
      }
    }
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Load the sample data.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /_bulk
{ "index" : { "_index" : "messages", "_id" : "1" } }
{ "priority": 1, "datetime": "2019-07-17T12:13:14Z", "message": "m1" }
{ "index" : { "_index" : "messages", "_id" : "2" } }
{ "priority": 1, "datetime": "2019-07-24T01:14:59Z", "message": "m2" }
{ "index" : { "_index" : "messages", "_id" : "3" } }
{ "priority": 2, "datetime": "1983-10-14T00:36:42Z", "message": "m3" }
{ "index" : { "_index" : "messages", "_id" : "4" } }
{ "priority": 3, "datetime": "1983-10-10T02:15:15Z", "message": "m4" }
{ "index" : { "_index" : "messages", "_id" : "5" } }
{ "priority": 3, "datetime": "1983-10-10T17:18:19Z", "message": "m5" }
{ "index" : { "_index" : "messages", "_id" : "6" } }
{ "priority": 1, "datetime": "2019-08-03T17:19:31Z", "message": "m6" }
{ "index" : { "_index" : "messages", "_id" : "7" } }
{ "priority": 3, "datetime": "2019-08-04T17:20:00Z", "message": "m7" }
{ "index" : { "_index" : "messages", "_id" : "8" } }
{ "priority": 2, "datetime": "2019-08-04T18:01:01Z", "message": "m8" }
{ "index" : { "_index" : "messages", "_id" : "9" } }
{ "priority": 3, "datetime": "1983-10-10T19:00:45Z", "message": "m9" }
{ "index" : { "_index" : "messages", "_id" : "10" } }
{ "priority": 2, "datetime": "2019-07-23T23:39:54Z", "message": "m10" }</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_day_of_the_week_bucket_aggregation_example">Day-of-the-Week Bucket Aggregation Example</h5>
<div class="paragraph">
<p>The following example uses a
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-script">terms aggregation</a>
as part of the
<a href="painless-contexts.html#painless-bucket-script-agg-context">bucket script aggregation context</a> to
display the number of messages from each day-of-the-week.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /messages/_search?pretty=true
{
  "aggs": {
    "day-of-week-count": {
      "terms": {
        "script": "return doc[\"datetime\"].value.getDayOfWeekEnum();"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_morningevening_bucket_aggregation_example">Morning/Evening Bucket Aggregation Example</h5>
<div class="paragraph">
<p>The following example uses a
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-script">terms aggregation</a>
as part of the
<a href="painless-contexts.html#painless-bucket-script-agg-context">bucket script aggregation context</a> to
display the number of messages received in the morning versus the evening.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /messages/_search?pretty=true
{
  "aggs": {
    "am-pm-count": {
      "terms": {
        "script": "return doc[\"datetime\"].value.getHour() &lt; 12 ? \"AM\" : \"PM\";"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_age_of_a_message_script_field_example">Age of a Message Script Field Example</h5>
<div class="paragraph">
<p>The following example uses a
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/search-fields.html#script-fields">script field</a> as part of the
<a href="painless-contexts.html#painless-field-context">field context</a> to display the elapsed time between
"now" and when a message was received.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search?pretty=true
{
  "query": {
    "match_all": {}
  },
  "script_fields": {
    "message_age": {
      "script": {
        "source": "ZonedDateTime now = ZonedDateTime.ofInstant(Instant.ofEpochMilli(params[\"now\"]), ZoneId.of(\"Z\")); ZonedDateTime mdt = doc[\"datetime\"].value; String age; long years = mdt.until(now, ChronoUnit.YEARS); age = years + \"Y \"; mdt = mdt.plusYears(years); long months = mdt.until(now, ChronoUnit.MONTHS); age += months + \"M \"; mdt = mdt.plusMonths(months); long days = mdt.until(now, ChronoUnit.DAYS); age += days + \"D \"; mdt = mdt.plusDays(days); long hours = mdt.until(now, ChronoUnit.HOURS); age += hours + \"h \"; mdt = mdt.plusHours(hours); long minutes = mdt.until(now, ChronoUnit.MINUTES); age += minutes + \"m \"; mdt = mdt.plusMinutes(minutes); long seconds = mdt.until(now, ChronoUnit.SECONDS); age += hours + \"s\"; return age;",
        "params": {
          "now": 1574005645830
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following shows the script broken into multiple lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-Painless" data-lang="Painless">ZonedDateTime now = ZonedDateTime.ofInstant(
        Instant.ofEpochMilli(params['now']), ZoneId.of('Z')); <b class="conum">(1)</b>
ZonedDateTime mdt = doc['datetime'].value; <b class="conum">(2)</b>

String age;

long years = mdt.until(now, ChronoUnit.YEARS); <b class="conum">(3)</b>
age = years + 'Y '; <b class="conum">(4)</b>
mdt = mdt.plusYears(years); <b class="conum">(5)</b>

long months = mdt.until(now, ChronoUnit.MONTHS);
age += months + 'M ';
mdt = mdt.plusMonths(months);

long days = mdt.until(now, ChronoUnit.DAYS);
age += days + 'D ';
mdt = mdt.plusDays(days);

long hours = mdt.until(now, ChronoUnit.HOURS);
age += hours + 'h ';
mdt = mdt.plusHours(hours);

long minutes = mdt.until(now, ChronoUnit.MINUTES);
age += minutes + 'm ';
mdt = mdt.plusMinutes(minutes);

long seconds = mdt.until(now, ChronoUnit.SECONDS);
age += hours + 's';

return age; <b class="conum">(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Parse the datetime "now" as input from the user-defined params.</p>
</li>
<li>
<p>Store the datetime the message was received as a <code>ZonedDateTime</code>.</p>
</li>
<li>
<p>Find the difference in years between "now" and the datetime the message was
received.</p>
</li>
<li>
<p>Add the difference in years later returned in the format
<code>Y &lt;years&gt; &#8230;&#8203;</code> for the age of a message.</p>
</li>
<li>
<p>Add the years so only the remainder of the months, days, etc. remain as the
difference between "now" and the datetime the message was received. Repeat this
pattern until the desired granularity is reached (seconds in this example).</p>
</li>
<li>
<p>Return the age of the message in the format
<code>Y &lt;years&gt; M &lt;months&gt; D &lt;days&gt; h &lt;hours&gt; m &lt;minutes&gt; s &lt;seconds&gt;</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modules-scripting-painless-dispatch">How painless dispatches functions</h3>
<div class="paragraph">
<p>Painless uses receiver, name, and <a href="https://en.wikipedia.org/wiki/Arity">arity</a>
for method dispatch. For example, <code>s.foo(a, b)</code> is resolved by first getting
the class of <code>s</code> and then looking up the method <code>foo</code> with two parameters. This
is different from Groovy which uses the
<a href="https://en.wikipedia.org/wiki/Multiple_dispatch">runtime types</a> of the
parameters and Java which uses the compile time types of the parameters.</p>
</div>
<div class="paragraph">
<p>The consequence of this that Painless doesn&#8217;t support overloaded methods like
Java, leading to some trouble when it allows classes from the Java
standard library. For example, in Java and Groovy, <code>Matcher</code> has two methods:
<code>group(int)</code> and <code>group(String)</code>. Painless can&#8217;t allow both of these methods
because they have the same name and the same number of parameters. So instead it
has <code>group(int)</code> and <code>namedGroup(String)</code>.</p>
</div>
<div class="paragraph">
<p>We have a few justifications for this different way of dispatching methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It makes operating on <code>def</code> types simpler and, presumably, faster. Using
receiver, name, and arity means that when Painless sees a call on a <code>def</code> object it
can dispatch the appropriate method without having to do expensive comparisons
of the types of the parameters. The same is true for invocations with <code>def</code>
typed parameters.</p>
</li>
<li>
<p>It keeps things consistent. It would be genuinely weird for Painless to
behave like Groovy if any <code>def</code> typed parameters were involved and Java
otherwise. It&#8217;d be slow for it to behave like Groovy all the time.</p>
</li>
<li>
<p>It keeps Painless maintainable. Adding the Java or Groovy like method
dispatch <strong>feels</strong> like it&#8217;d add a ton of complexity which&#8217;d make maintenance and
other improvements much more difficult.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="painless-debugging">Painless Debugging</h3>
<div class="sect3">
<h4 id="_debug_explain">Debug.Explain</h4>
<div class="paragraph">
<p>Painless doesn&#8217;t have a
<a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a>
and while it&#8217;d be nice for it to have one day, it wouldn&#8217;t tell you the
whole story around debugging painless scripts embedded in OpenSearch because
the data that the scripts have access to or "context" is so important. For now
the best way to debug embedded scripts is by throwing exceptions at choice
places. While you can throw your own exceptions
(<code>throw new Exception('whatever')</code>), Painless&#8217;s sandbox prevents you from
accessing useful information like the type of an object. So Painless has a
utility method, <code>Debug.explain</code> which throws the exception for you. For
example, you can use <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/search-explain.html"><code>_explain</code></a> to explore the
context available to a <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/query-dsl-script-query.html">script query</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /hockey/_doc/1?refresh
{"first":"johnny","last":"gaudreau","goals":[9,27,1],"assists":[17,46,0],"gp":[26,82,1]}

POST /hockey/_explain/1
{
  "query": {
    "script": {
      "script": "Debug.explain(doc.goals)"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which shows that the class of <code>doc.first</code> is
<code>org.opensearch.index.fielddata.ScriptDocValues.Longs</code> by responding with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
   "error": {
      "type": "script_exception",
      "to_string": "[1, 9, 27]",
      "painless_class": "org.opensearch.index.fielddata.ScriptDocValues.Longs",
      "java_class": "org.opensearch.index.fielddata.ScriptDocValues$Longs",
      ...
   },
   "status": 400
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the same trick to see that <code>_source</code> is a <code>LinkedHashMap</code>
in the <code>_update</code> API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /hockey/_update/1
{
  "script": "Debug.explain(ctx._source)"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "error" : {
    "root_cause": ...,
    "type": "illegal_argument_exception",
    "reason": "failed to execute script",
    "caused_by": {
      "type": "script_exception",
      "to_string": "{gp=[26, 82, 1], last=gaudreau, assists=[17, 46, 0], first=johnny, goals=[9, 27, 1]}",
      "painless_class": "java.util.LinkedHashMap",
      "java_class": "java.util.LinkedHashMap",
      ...
    }
  },
  "status": 400
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have a class you can go to <a href="painless-api-reference.html">Painless API Reference</a> to see a list of
available methods.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="painless-execute-api">Painless execute API</h3>
<div class="paragraph">
<p>experimental::[The painless execute api is new and the request / response format may change in a breaking way in the future]</p>
</div>
<div class="paragraph">
<p>The Painless execute API allows an arbitrary script to be executed and a result to be returned.</p>
</div>
<table id="painless-execute-api-parameters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>script</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The script to execute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>context</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>painless_test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The context the script should be executed in.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>context_setup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional parameters to the context.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_contexts">Contexts</h4>
<div class="paragraph">
<p>Contexts control how scripts are executed, what variables are available at runtime and what the return type is.</p>
</div>
<div class="sect4">
<h5 id="_painless_test_context">Painless test context</h5>
<div class="paragraph">
<p>The <code>painless_test</code> context executes scripts as is and does not add any special parameters.
The only variable that is available is <code>params</code>, which can be used to access user defined values.
The result of the script is always converted to a string.
If no context is specified then this context is used by default.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p>Request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">POST /_scripts/painless/_execute
{
  "script": {
    "source": "params.count / params.total",
    "params": {
      "count": 100.0,
      "total": 1000.0
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "result": "0.1"
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_filter_context">Filter context</h5>
<div class="paragraph">
<p>The <code>filter</code> context executes scripts as if they were executed inside a <code>script</code> query.
For testing purposes, a document must be provided so that it will be temporarily indexed in-memory and
is accessible from the script. More precisely, the _source, stored fields and doc values of such a
document are available to the script being tested.</p>
</div>
<div class="paragraph">
<p>The following parameters may be specified in <code>context_setup</code> for a filter context:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">document</dt>
<dd>
<p>Contains the document that will be temporarily indexed in-memory and is accessible from the script.</p>
</dd>
<dt class="hdlist1">index</dt>
<dd>
<p>The name of an index containing a mapping that is compatible with the document being indexed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /my-index-000001
{
  "mappings": {
    "properties": {
      "field": {
        "type": "keyword"
      }
    }
  }
}

POST /_scripts/painless/_execute
{
  "script": {
    "source": "doc['field'].value.length() &lt;= params.max_length",
    "params": {
      "max_length": 4
    }
  },
  "context": "filter",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "field": "four"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "result": true
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_score_context">Score context</h5>
<div class="paragraph">
<p>The <code>score</code> context executes scripts as if they were executed inside a <code>script_score</code> function in
<code>function_score</code> query.</p>
</div>
<div class="paragraph">
<p>The following parameters may be specified in <code>context_setup</code> for a score context:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">document</dt>
<dd>
<p>Contains the document that will be temporarily indexed in-memory and is accessible from the script.</p>
</dd>
<dt class="hdlist1">index</dt>
<dd>
<p>The name of an index containing a mapping that is compatible with the document being indexed.</p>
</dd>
<dt class="hdlist1">query</dt>
<dd>
<p>If <code>_score</code> is used in the script then a query can specify that it will be used to compute a score.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /my-index-000001
{
  "mappings": {
    "properties": {
      "field": {
        "type": "keyword"
      },
      "rank": {
        "type": "long"
      }
    }
  }
}


POST /_scripts/painless/_execute
{
  "script": {
    "source": "doc['rank'].value / params.max_rank",
    "params": {
      "max_rank": 5.0
    }
  },
  "context": "score",
  "context_setup": {
    "index": "my-index-000001",
    "document": {
      "rank": 4
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "result": 0.8
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>↑ Up: <a href="index.html">Painless Scripting Language</a> | Next: <a href="redirects.html">Deleted pages</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-03-22 21:56:08 -0700
</div>
</div>
</body>
</html>