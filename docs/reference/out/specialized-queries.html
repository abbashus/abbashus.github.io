<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>OpenSearch Reference</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="specialized-queries" class="book toc2 toc-left">
<div id="header">
<h1>OpenSearch Reference</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OpenSearch Reference</a></span></p><ul class="sectlevel1">
<li><a href="opensearch-intro.html">What is OpenSearch?</a>
</li>
<li><a href="getting-started.html">Getting started with OpenSearch</a>
</li>
<li><a href="setup.html">Set up OpenSearch</a>
</li>
<li><a href="setup-upgrade.html">Upgrade OpenSearch</a>
</li>
<li><a href="index-modules.html">Index modules</a>
</li>
<li><a href="mapping.html">Mapping</a>
</li>
<li><a href="analysis.html">Text analysis</a>
</li>
<li><a href="index-templates.html">Index templates</a>
</li>
<li><a href="ingest.html">Ingest node</a>
</li>
<li><a href="search-your-data.html">Search your data</a>
</li>
<li><a href="query-dsl.html">Query DSL</a>
<ul class="sectlevel1">
<li><a href="query-filter-context.html">Query and filter context</a>
</li>
<li><a href="compound-queries.html">Compound queries</a>
</li>
<li><a href="full-text-queries.html">Full text queries</a>
</li>
<li><a href="geo-queries.html">Geo queries</a>
</li>
<li><a href="joining-queries.html">Joining queries</a>
</li>
<li><a href="query-dsl-match-all-query.html">Match all query</a>
</li>
<li><a href="span-queries.html">Span queries</a>
</li>
<li><a href="specialized-queries.html"><span class="toc-current">Specialized queries</span></a>
<ul class="sectlevel2">
<li><a href="specialized-queries.html#query-dsl-distance-feature-query">Distance feature query</a>
</li>
<li><a href="specialized-queries.html#query-dsl-mlt-query">More like this query</a>
</li>
<li><a href="specialized-queries.html#query-dsl-percolate-query">Percolate query</a>
</li>
<li><a href="specialized-queries.html#query-dsl-rank-feature-query">Rank feature query</a>
</li>
<li><a href="specialized-queries.html#query-dsl-script-query">Script query</a>
</li>
<li><a href="specialized-queries.html#query-dsl-script-score-query">Script score query</a>
</li>
<li><a href="specialized-queries.html#query-dsl-wrapper-query">Wrapper query</a>
</li>
</ul>
</li>
<li><a href="term-level-queries.html">Term-level queries</a>
</li>
<li><a href="query-dsl-minimum-should-match.html"><code>minimum_should_match</code> parameter</a>
</li>
<li><a href="query-dsl-multi-term-rewrite.html"><code>rewrite</code> parameter</a>
</li>
<li><a href="regexp-syntax.html">Regular expression syntax</a>
</li>
</ul>
</li>
<li><a href="search-aggregations.html">Aggregations</a>
</li>
<li><a href="modules-scripting.html">Scripting</a>
</li>
<li><a href="high-availability.html">Set up a cluster for high availability</a>
</li>
<li><a href="snapshot-restore.html">Snapshot and restore</a>
</li>
<li><a href="commands.html">Command line tools</a>
</li>
<li><a href="how-to.html">How To</a>
</li>
<li><a href="glossary.html">Glossary of terms</a>
</li>
<li><a href="rest-apis.html">REST APIs</a>
</li>
<li><a href="breaking-changes.html">Migration guide</a>
</li>
<li><a href="opensearch-release-notes.html">Release notes</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="specialized-queries">Specialized queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This group contains queries which do not fit into the other groups:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="specialized-queries.html#query-dsl-distance-feature-query"><code>distance_feature</code> query</a></dt>
<dd>
<p>A query that computes scores based on the dynamically computed distances
between the origin and documents' date, date_nanos and geo_point fields.
It is able to efficiently skip non-competitive hits.</p>
</dd>
<dt class="hdlist1"><a href="specialized-queries.html#query-dsl-mlt-query"><code>more_like_this</code> query</a></dt>
<dd>
<p>This query finds documents which are similar to the specified text, document,
or collection of documents.</p>
</dd>
<dt class="hdlist1"><a href="specialized-queries.html#query-dsl-percolate-query"><code>percolate</code> query</a></dt>
<dd>
<p>This query finds queries that are stored as documents that match with
the specified document.</p>
</dd>
<dt class="hdlist1"><a href="specialized-queries.html#query-dsl-rank-feature-query"><code>rank_feature</code> query</a></dt>
<dd>
<p>A query that computes scores based on the values of numeric features and is
able to efficiently skip non-competitive hits.</p>
</dd>
<dt class="hdlist1"><a href="specialized-queries.html#query-dsl-script-query"><code>script</code> query</a></dt>
<dd>
<p>This query allows a script to act as a filter.  Also see the
<a href="compound-queries.html#query-dsl-function-score-query"><code>function_score</code> query</a>.</p>
</dd>
<dt class="hdlist1"><a href="specialized-queries.html#query-dsl-script-score-query"><code>script_score</code> query</a></dt>
<dd>
<p>A query that allows to modify the score of a sub-query with a script.</p>
</dd>
<dt class="hdlist1"><a href="specialized-queries.html#query-dsl-wrapper-query"><code>wrapper</code> query</a></dt>
<dd>
<p>A query that accepts other queries as json or yaml string.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="query-dsl-distance-feature-query">Distance feature query</h3>
<titleabbrev>Distance feature</titleabbrev>
<div class="paragraph">
<p>Boosts the <a href="query-filter-context.html#relevance-scores">relevance score</a> of documents closer to a
provided <code>origin</code> date or point. For example, you can use this query to give
more weight to documents closer to a certain date or location.</p>
</div>
<div class="paragraph">
<p>You can use the <code>distance_feature</code> query to find the nearest neighbors to a
location. You can also use the query in a <a href="compound-queries.html#query-dsl-bool-query"><code>bool</code></a>
search&#8217;s <code>should</code> filter to add boosted relevance scores to the <code>bool</code> query&#8217;s
scores.</p>
</div>
<div class="sect3">
<h4 id="distance-feature-query-ex-request">Example request</h4>
<div class="sect4">
<h5 id="distance-feature-index-setup">Index setup</h5>
<div class="paragraph">
<p>To use the <code>distance_feature</code> query, your index must include a <a href="mapping-types.html#date"><code>date</code></a>,
<a href="mapping-types.html#date_nanos"><code>date_nanos</code></a> or <a href="mapping-types.html#geo-point"><code>geo_point</code></a> field.</p>
</div>
<div class="paragraph">
<p>To see how you can set up an index for the <code>distance_feature</code> query, try the
following example.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an <code>items</code> index with the following field mapping:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>name</code>, a <a href="mapping-types.html#keyword"><code>keyword</code></a> field</p>
</li>
<li>
<p><code>production_date</code>, a <a href="mapping-types.html#date"><code>date</code></a> field</p>
</li>
<li>
<p><code>location</code>, a <a href="mapping-types.html#geo-point"><code>geo_point</code></a> field</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /items
{
  "mappings": {
    "properties": {
      "name": {
        "type": "keyword"
      },
      "production_date": {
        "type": "date"
      },
      "location": {
        "type": "geo_point"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Index several documents to this index.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /items/_doc/1?refresh
{
  "name" : "chocolate",
  "production_date": "2018-02-01",
  "location": [-71.34, 41.12]
}

PUT /items/_doc/2?refresh
{
  "name" : "chocolate",
  "production_date": "2018-01-01",
  "location": [-71.3, 41.15]
}


PUT /items/_doc/3?refresh
{
  "name" : "chocolate",
  "production_date": "2017-12-01",
  "location": [-71.3, 41.12]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="distance-feature-query-ex-query">Example queries</h5>
<div class="sect5">
<h6 id="distance-feature-query-date-ex">Boost documents based on date</h6>
<div class="paragraph">
<p>The following <code>bool</code> search returns documents with a <code>name</code> value of
<code>chocolate</code>. The search also uses the <code>distance_feature</code> query to increase the
relevance score of documents with a <code>production_date</code> value closer to <code>now</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /items/_search
{
  "query": {
    "bool": {
      "must": {
        "match": {
          "name": "chocolate"
        }
      },
      "should": {
        "distance_feature": {
          "field": "production_date",
          "pivot": "7d",
          "origin": "now"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="distance-feature-query-distance-ex">Boost documents based on location</h6>
<div class="paragraph">
<p>The following <code>bool</code> search returns documents with a <code>name</code> value of
<code>chocolate</code>. The search also uses the <code>distance_feature</code> query to increase the
relevance score of documents with a <code>location</code> value closer to <code>[-71.3, 41.15]</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /items/_search
{
  "query": {
    "bool": {
      "must": {
        "match": {
          "name": "chocolate"
        }
      },
      "should": {
        "distance_feature": {
          "field": "location",
          "pivot": "1000m",
          "origin": [-71.3, 41.15]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="distance-feature-top-level-params">Top-level parameters for <code>distance_feature</code></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>field</code></dt>
<dd>
<p>(Required, string) Name of the field used to calculate distances. This field
must meet the following criteria:</p>
<div class="ulist">
<ul>
<li>
<p>Be a <a href="mapping-types.html#date"><code>date</code></a>, <a href="mapping-types.html#date_nanos"><code>date_nanos</code></a> or
<a href="mapping-types.html#geo-point"><code>geo_point</code></a> field</p>
</li>
<li>
<p>Have an <a href="mapping-params.html#mapping-index"><code>index</code></a> mapping parameter value of <code>true</code>, which is
the default</p>
</li>
<li>
<p>Have an <a href="mapping-params.html#doc-values"><code>doc_values</code></a> mapping parameter value of <code>true</code>, which
is the default</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>origin</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Required, string) Date or point of origin used to calculate distances.</p>
</div>
<div class="paragraph">
<p>If the <code>field</code> value is a <a href="mapping-types.html#date"><code>date</code></a> or <a href="mapping-types.html#date_nanos"><code>date_nanos</code></a>
field, the <code>origin</code> value must be a <a href="search-aggregations-bucket.html#date-format-pattern">date</a>.
<a href="api-conventions.html#date-math">Date Math</a>, such as <code>now-1h</code>, is supported.</p>
</div>
<div class="paragraph">
<p>If the <code>field</code> value is a <a href="mapping-types.html#geo-point"><code>geo_point</code></a> field, the <code>origin</code> value
must be a geopoint.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>pivot</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Required, <a href="api-conventions.html#time-units">time unit</a> or <a href="api-conventions.html#distance-units">distance unit</a>)
Distance from the <code>origin</code> at which relevance scores receive half of the <code>boost</code>
value.</p>
</div>
<div class="paragraph">
<p>If the <code>field</code> value is a <a href="mapping-types.html#date"><code>date</code></a> or <a href="mapping-types.html#date_nanos"><code>date_nanos</code></a>
field, the <code>pivot</code> value must be a <a href="api-conventions.html#time-units">time unit</a>, such as <code>1h</code> or
<code>10d</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>field</code> value is a <a href="mapping-types.html#geo-point"><code>geo_point</code></a> field, the <code>pivot</code> value
must be a <a href="api-conventions.html#distance-units">distance unit</a>, such as <code>1km</code> or <code>12m</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>boost</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, float) Floating point number used to multiply the
<a href="query-filter-context.html#relevance-scores">relevance score</a> of matching documents. This value
cannot be negative. Defaults to <code>1.0</code>.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="distance-feature-notes">Notes</h4>
<div class="sect4">
<h5 id="distance-feature-calculation">How the <code>distance_feature</code> query calculates relevance scores</h5>
<div class="paragraph">
<p>The <code>distance_feature</code> query dynamically calculates the distance between the
<code>origin</code> value and a document&#8217;s field values. It then uses this distance as a
feature to boost the <a href="query-filter-context.html#relevance-scores">relevance score</a> of closer
documents.</p>
</div>
<div class="paragraph">
<p>The <code>distance_feature</code> query calculates a document&#8217;s
<a href="query-filter-context.html#relevance-scores">relevance score</a> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>relevance score = boost * pivot / (pivot + distance)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>distance</code> is the absolute difference between the <code>origin</code> value and a
document&#8217;s field value.</p>
</div>
</div>
<div class="sect4">
<h5 id="distance-feature-skip-hits">Skip non-competitive hits</h5>
<div class="paragraph">
<p>Unlike the <a href="compound-queries.html#query-dsl-function-score-query"><code>function_score</code></a> query or other
ways to change <a href="query-filter-context.html#relevance-scores">relevance scores</a>, the
<code>distance_feature</code> query efficiently skips non-competitive hits when the
<a href="getting-started-modify-data.html#search-uri-request"><code>track_total_hits</code></a> parameter is <strong>not</strong> <code>true</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-dsl-mlt-query">More like this query</h3>
<titleabbrev>More like this</titleabbrev>
<div class="paragraph">
<p>The More Like This Query finds documents that are "like" a given
set of documents. In order to do so, MLT selects a set of representative terms
of these input documents, forms a query using these terms, executes the query
and returns the results. The user controls the input documents, how the terms
should be selected and how the query is formed.</p>
</div>
<div class="paragraph">
<p>The simplest use case consists of asking for documents that are similar to a
provided piece of text. Here, we are asking for all movies that have some text
similar to "Once upon a time" in their "title" and in their "description"
fields, limiting the number of selected terms to 12.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search
{
  "query": {
    "more_like_this" : {
      "fields" : ["title", "description"],
      "like" : "Once upon a time",
      "min_term_freq" : 1,
      "max_query_terms" : 12
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A more complicated use case consists of mixing texts with documents already
existing in the index. In this case, the syntax to specify a document is
similar to the one used in the <a href="docs.html#docs-multi-get">Multi GET API</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search
{
  "query": {
    "more_like_this": {
      "fields": [ "title", "description" ],
      "like": [
        {
          "_index": "imdb",
          "_id": "1"
        },
        {
          "_index": "imdb",
          "_id": "2"
        },
        "and potentially some more text here as well"
      ],
      "min_term_freq": 1,
      "max_query_terms": 12
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, users can mix some texts, a chosen set of documents but also provide
documents not necessarily present in the index. To provide documents not
present in the index, the syntax is similar to <a href="docs.html#docs-termvectors-artificial-doc">artificial documents</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search
{
  "query": {
    "more_like_this": {
      "fields": [ "name.first", "name.last" ],
      "like": [
        {
          "_index": "marvel",
          "doc": {
            "name": {
              "first": "Ben",
              "last": "Grimm"
            },
            "_doc": "You got no idea what I'd... what I'd give to be invisible."
          }
        },
        {
          "_index": "marvel",
          "_id": "2"
        }
      ],
      "min_term_freq": 1,
      "max_query_terms": 12
    }
  }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_how_it_works">How it Works</h4>
<div class="paragraph">
<p>Suppose we wanted to find all documents similar to a given input document.
Obviously, the input document itself should be its best match for that type of
query. And the reason would be mostly, according to
<a href="https://lucene.apache.org/core/4_9_0/core/org/apache/lucene/search/similarities/TFIDFSimilarity.html">Lucene scoring formula</a>,
due to the terms with the highest tf-idf. Therefore, the terms of the input
document that have the highest tf-idf are good representatives of that
document, and could be used within a disjunctive query (or <code>OR</code>) to retrieve similar
documents. The MLT query simply extracts the text from the input document,
analyzes it, usually using the same analyzer at the field, then selects the
top K terms with highest tf-idf to form a disjunctive query of these terms.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The fields on which to perform MLT must be indexed and of type
<code>text</code> or <code>keyword`</code>. Additionally, when using <code>like</code> with documents, either
<code>_source</code> must be enabled or the fields must be <code>stored</code> or store
<code>term_vector</code>. In order to speed up analysis, it could help to store term
vectors at index time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if we wish to perform MLT on the "title" and "tags.raw" fields,
we can explicitly store their <code>term_vector</code> at index time. We can still
perform MLT on the "description" and "tags" fields, as <code>_source</code> is enabled by
default, but there will be no speed up on analysis for these fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /imdb
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "term_vector": "yes"
      },
      "description": {
        "type": "text"
      },
      "tags": {
        "type": "text",
        "fields": {
          "raw": {
            "type": "text",
            "analyzer": "keyword",
            "term_vector": "yes"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_parameters_2">Parameters</h4>
<div class="paragraph">
<p>The only required parameter is <code>like</code>, all other parameters have sensible
defaults. There are three types of parameters: one to specify the document
input, the other one for term selection and for query formation.</p>
</div>
<h4 id="_document_input_parameters" class="discrete">Document Input Parameters</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>like</code>
</td>
<td class="hdlist2">
<p>The only <strong>required</strong> parameter of the MLT query is <code>like</code> and follows a
versatile syntax, in which the user can specify free form text and/or a single
or multiple documents (see examples above). The syntax to specify documents is
similar to the one used by the <a href="docs.html#docs-multi-get">Multi GET API</a>. When
specifying documents, the text is fetched from <code>fields</code> unless overridden in
each document request. The text is analyzed by the analyzer at the field, but
could also be overridden. The syntax to override the analyzer at the field
follows a similar syntax to the <code>per_field_analyzer</code> parameter of the
<a href="docs.html#docs-termvectors-per-field-analyzer">Term Vectors API</a>.
Additionally, to provide documents not necessarily present in the index,
<a href="docs.html#docs-termvectors-artificial-doc">artificial documents</a> are also supported.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>unlike</code>
</td>
<td class="hdlist2">
<p>The <code>unlike</code> parameter is used in conjunction with <code>like</code> in order not to
select terms found in a chosen set of documents. In other words, we could ask
for documents <code>like: "Apple"</code>, but <code>unlike: "cake crumble tree"</code>. The syntax
is the same as <code>like</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>fields</code>
</td>
<td class="hdlist2">
<p>A list of fields to fetch and analyze the text from.</p>
</td>
</tr>
</table>
</div>
<h4 id="mlt-query-term-selection" class="discrete">Term Selection Parameters</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>max_query_terms</code>
</td>
<td class="hdlist2">
<p>The maximum number of query terms that will be selected. Increasing this value
gives greater accuracy at the expense of query execution speed. Defaults to
<code>25</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min_term_freq</code>
</td>
<td class="hdlist2">
<p>The minimum term frequency below which the terms will be ignored from the
input document. Defaults to <code>2</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min_doc_freq</code>
</td>
<td class="hdlist2">
<p>The minimum document frequency below which the terms will be ignored from the
input document. Defaults to <code>5</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_doc_freq</code>
</td>
<td class="hdlist2">
<p>The maximum document frequency above which the terms will be ignored from the
input document. This could be useful in order to ignore highly frequent words
such as stop words. Defaults to unbounded (<code>Integer.MAX_VALUE</code>, which is <code>2^31-1</code>
or 2147483647).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min_word_length</code>
</td>
<td class="hdlist2">
<p>The minimum word length below which the terms will be ignored. The old name
<code>min_word_len</code> is deprecated. Defaults to <code>0</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max_word_length</code>
</td>
<td class="hdlist2">
<p>The maximum word length above which the terms will be ignored. The old name
<code>max_word_len</code> is deprecated. Defaults to unbounded (<code>0</code>).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>stop_words</code>
</td>
<td class="hdlist2">
<p>An array of stop words. Any word in this set is considered "uninteresting" and
ignored. If the analyzer allows for stop words, you might want to tell MLT to
explicitly ignore them, as for the purposes of document similarity it seems
reasonable to assume that "a stop word is never interesting".</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>analyzer</code>
</td>
<td class="hdlist2">
<p>The analyzer that is used to analyze the free form text. Defaults to the
analyzer associated with the first field in <code>fields</code>.</p>
</td>
</tr>
</table>
</div>
<h4 id="_query_formation_parameters" class="discrete">Query Formation Parameters</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>minimum_should_match</code>
</td>
<td class="hdlist2">
<p>After the disjunctive query has been formed, this parameter controls the
number of terms that must match.
The syntax is the same as the <a href="query-dsl-minimum-should-match.html">minimum should match</a>.
(Defaults to <code>"30%"</code>).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>fail_on_unsupported_field</code>
</td>
<td class="hdlist2">
<p>Controls whether the query should fail (throw an exception) if any of the
specified fields are not of the supported types
(<code>text</code> or <code>keyword</code>). Set this to <code>false</code> to ignore the field and continue
processing. Defaults to <code>true</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>boost_terms</code>
</td>
<td class="hdlist2">
<p>Each term in the formed query could be further boosted by their tf-idf score.
This sets the boost factor to use when using this feature. Defaults to
deactivated (<code>0</code>). Any other positive value activates terms boosting with the
given boost factor.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>include</code>
</td>
<td class="hdlist2">
<p>Specifies whether the input documents should also be included in the search
results returned. Defaults to <code>false</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>boost</code>
</td>
<td class="hdlist2">
<p>Sets the boost value of the whole query. Defaults to <code>1.0</code>.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_alternative">Alternative</h4>
<div class="paragraph">
<p>To take more control over the construction of a query for similar documents it is worth considering writing custom client code to assemble selected terms from an example document into a Boolean query with the desired settings. The logic in <code>more_like_this</code> that selects "interesting" words from a piece of text is also accessible via the <a href="docs.html#docs-termvectors">TermVectors API</a>. For example, using the termvectors API it would be possible to present users with a selection of topical keywords found in a document&#8217;s text, allowing them to select words of interest to drill down on, rather than using the more "black-box" approach of matching used by <code>more_like_this</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-dsl-percolate-query">Percolate query</h3>
<titleabbrev>Percolate</titleabbrev>
<div class="paragraph">
<p>The <code>percolate</code> query can be used to match queries
stored in an index. The <code>percolate</code> query itself
contains the document that will be used as query
to match with the stored queries.</p>
</div>
<h3 id="_sample_usage" class="discrete">Sample Usage</h3>
<div class="paragraph">
<p>Create an index with two fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /my-index-00001
{
  "mappings": {
    "properties": {
      "message": {
        "type": "text"
      },
      "query": {
        "type": "percolator"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>message</code> field is the field used to preprocess the document defined in
the <code>percolator</code> query before it gets indexed into a temporary index.</p>
</div>
<div class="paragraph">
<p>The <code>query</code> field is used for indexing the query documents. It will hold a
json object that represents an actual OpenSearch query. The <code>query</code> field
has been configured to use the <a href="mapping-types.html#percolator">percolator field type</a>. This field
type understands the query dsl and stores the query in such a way that it can be
used later on to match documents defined on the <code>percolate</code> query.</p>
</div>
<div class="paragraph">
<p>Register a query in the percolator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /my-index-00001/_doc/1?refresh
{
  "query": {
    "match": {
      "message": "bonsai tree"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Match a document to the registered percolator queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-00001/_search
{
  "query": {
    "percolate": {
      "field": "query",
      "document": {
        "message": "A new bonsai tree in the office"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above request will yield the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "took": 13,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped" : 0,
    "failed": 0
  },
  "hits": {
    "total" : {
        "value": 1,
        "relation": "eq"
    },
    "max_score": 0.26152915,
    "hits": [
      { <b class="conum">(1)</b>
        "_index": "my-index-00001",
        "_type": "_doc",
        "_id": "1",
        "_score": 0.26152915,
        "_source": {
          "query": {
            "match": {
              "message": "bonsai tree"
            }
          }
        },
        "fields" : {
          "_percolator_document_slot" : [0] <b class="conum">(2)</b>
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The query with id <code>1</code> matches our document.</p>
</li>
<li>
<p>The <code>_percolator_document_slot</code> field indicates which document has matched with this query.
Useful when percolating multiple document simultaneously.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
To provide a simple example, this documentation uses one index <code>my-index-00001</code> for both the percolate queries and documents.
This set-up can work well when there are just a few percolate queries registered. However, with heavier usage it is recommended
to store queries and documents in separate indices. Please see <a href="specialized-queries.html#how-it-works">How it Works Under the Hood</a> for more details.
</td>
</tr>
</table>
</div>
<h4 id="_parameters_3" class="discrete">Parameters</h4>
<div class="paragraph">
<p>The following parameters are required when percolating a document:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>field</code>
</td>
<td class="hdlist2">
<p>The field of type <code>percolator</code> that holds the indexed queries. This is a required parameter.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>name</code>
</td>
<td class="hdlist2">
<p>The suffix to be used for the <code>_percolator_document_slot</code> field in case multiple <code>percolate</code> queries have been specified.
This is an optional parameter.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>document</code>
</td>
<td class="hdlist2">
<p>The source of the document being percolated.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>documents</code>
</td>
<td class="hdlist2">
<p>Like the <code>document</code> parameter, but accepts multiple documents via a json array.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>document_type</code>
</td>
<td class="hdlist2">
<p>The type / mapping of the document being percolated.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Instead of specifying the source of the document being percolated, the source can also be retrieved from an already
stored document. The <code>percolate</code> query will then internally execute a get request to fetch that document.</p>
</div>
<div class="paragraph">
<p>In that case the <code>document</code> parameter can be substituted with the following parameters:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>index</code>
</td>
<td class="hdlist2">
<p>The index the document resides in. This is a required parameter.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p>The type of the document to fetch.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>id</code>
</td>
<td class="hdlist2">
<p>The id of the document to fetch. This is a required parameter.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>routing</code>
</td>
<td class="hdlist2">
<p>Optionally, routing to be used to fetch document to percolate.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>preference</code>
</td>
<td class="hdlist2">
<p>Optionally, preference to be used to fetch document to percolate.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>version</code>
</td>
<td class="hdlist2">
<p>Optionally, the expected version of the document to be fetched.</p>
</td>
</tr>
</table>
</div>
<h4 id="_percolating_in_a_filter_context" class="discrete">Percolating in a filter context</h4>
<div class="paragraph">
<p>In case you are not interested in the score, better performance can be expected by wrapping
the percolator query in a <code>bool</code> query&#8217;s filter clause or in a <code>constant_score</code> query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-00001/_search
{
  "query": {
    "constant_score": {
      "filter": {
        "percolate": {
          "field": "query",
          "document": {
            "message": "A new bonsai tree in the office"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At index time terms are extracted from the percolator query and the percolator
can often determine whether a query matches just by looking at those extracted
terms. However, computing scores requires to deserialize each matching query
and run it against the percolated document, which is a much more expensive
operation. Hence if computing scores is not required the <code>percolate</code> query
should be wrapped in a <code>constant_score</code> query or a <code>bool</code> query&#8217;s filter clause.</p>
</div>
<div class="paragraph">
<p>Note that the <code>percolate</code> query never gets cached by the query cache.</p>
</div>
<h4 id="_percolating_multiple_documents" class="discrete">Percolating multiple documents</h4>
<div class="paragraph">
<p>The <code>percolate</code> query can match multiple documents simultaneously with the indexed percolator queries.
Percolating multiple documents in a single request can improve performance as queries only need to be parsed and
matched once instead of multiple times.</p>
</div>
<div class="paragraph">
<p>The <code>_percolator_document_slot</code> field that is being returned with each matched percolator query is important when percolating
multiple documents simultaneously. It indicates which documents matched with a particular percolator query. The numbers
correlate with the slot in the <code>documents</code> array specified in the <code>percolate</code> query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-00001/_search
{
  "query": {
    "percolate": {
      "field": "query",
      "documents": [ <b class="conum">(1)</b>
        {
          "message": "bonsai tree"
        },
        {
          "message": "new tree"
        },
        {
          "message": "the office"
        },
        {
          "message": "office tree"
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The documents array contains 4 documents that are going to be percolated at the same time.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "took": 13,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped" : 0,
    "failed": 0
  },
  "hits": {
    "total" : {
        "value": 1,
        "relation": "eq"
    },
    "max_score": 0.7093853,
    "hits": [
      {
        "_index": "my-index-00001",
        "_type": "_doc",
        "_id": "1",
        "_score": 0.7093853,
        "_source": {
          "query": {
            "match": {
              "message": "bonsai tree"
            }
          }
        },
        "fields" : {
          "_percolator_document_slot" : [0, 1, 3] <b class="conum">(1)</b>
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>_percolator_document_slot</code> indicates that the first, second and last documents specified in the <code>percolate</code> query
are matching with this query.</p>
</li>
</ol>
</div>
<h4 id="_percolating_an_existing_document" class="discrete">Percolating an Existing Document</h4>
<div class="paragraph">
<p>In order to percolate a newly indexed document, the <code>percolate</code> query can be used. Based on the response
from an index request, the <code>_id</code> and other meta information can be used to immediately percolate the newly added
document.</p>
</div>
<h5 id="_example_2" class="discrete">Example</h5>
<div class="paragraph">
<p>Based on the previous example.</p>
</div>
<div class="paragraph">
<p>Index the document we want to percolate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /my-index-00001/_doc/2
{
  "message" : "A new bonsai tree in the office"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Index response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "_index": "my-index-00001",
  "_type": "_doc",
  "_id": "2",
  "_version": 1,
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "result": "created",
  "_seq_no" : 1,
  "_primary_term" : 1
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Percolating an existing document, using the index response as basis to build to new search request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-00001/_search
{
  "query": {
    "percolate": {
      "field": "query",
      "index": "my-index-00001",
      "id": "2",
      "version": 1 <b class="conum">(1)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The version is optional, but useful in certain cases. We can ensure that we are trying to percolate
the document we just have indexed. A change may be made after we have indexed, and if that is the
case the search request would fail with a version conflict error.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The search response returned is identical as in the previous example.</p>
</div>
<h4 id="_percolate_query_and_highlighting" class="discrete">Percolate query and highlighting</h4>
<div class="paragraph">
<p>The <code>percolate</code> query is handled in a special way when it comes to highlighting. The queries hits are used
to highlight the document that is provided in the <code>percolate</code> query. Whereas with regular highlighting the query in
the search request is used to highlight the hits.</p>
</div>
<h5 id="_example_3" class="discrete">Example</h5>
<div class="paragraph">
<p>This example is based on the mapping of the first example.</p>
</div>
<div class="paragraph">
<p>Save a query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /my-index-00001/_doc/3?refresh
{
  "query": {
    "match": {
      "message": "brown fox"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save another query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /my-index-00001/_doc/4?refresh
{
  "query": {
    "match": {
      "message": "lazy dog"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute a search request with the <code>percolate</code> query and highlighting enabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-00001/_search
{
  "query": {
    "percolate": {
      "field": "query",
      "document": {
        "message": "The quick brown fox jumps over the lazy dog"
      }
    }
  },
  "highlight": {
    "fields": {
      "message": {}
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will yield the following response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "took": 7,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped" : 0,
    "failed": 0
  },
  "hits": {
    "total" : {
        "value": 2,
        "relation": "eq"
    },
    "max_score": 0.26152915,
    "hits": [
      {
        "_index": "my-index-00001",
        "_type": "_doc",
        "_id": "3",
        "_score": 0.26152915,
        "_source": {
          "query": {
            "match": {
              "message": "brown fox"
            }
          }
        },
        "highlight": {
          "message": [
            "The quick &lt;em&gt;brown&lt;/em&gt; &lt;em&gt;fox&lt;/em&gt; jumps over the lazy dog" <b class="conum">(1)</b>
          ]
        },
        "fields" : {
          "_percolator_document_slot" : [0]
        }
      },
      {
        "_index": "my-index-00001",
        "_type": "_doc",
        "_id": "4",
        "_score": 0.26152915,
        "_source": {
          "query": {
            "match": {
              "message": "lazy dog"
            }
          }
        },
        "highlight": {
          "message": [
            "The quick brown fox jumps over the &lt;em&gt;lazy&lt;/em&gt; &lt;em&gt;dog&lt;/em&gt;" <b class="conum">(1)</b>
          ]
        },
        "fields" : {
          "_percolator_document_slot" : [0]
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The terms from each query have been highlighted in the document.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Instead of the query in the search request highlighting the percolator hits, the percolator queries are highlighting
the document defined in the <code>percolate</code> query.</p>
</div>
<div class="paragraph">
<p>When percolating multiple documents at the same time like the request below then the highlight response is different:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-00001/_search
{
  "query": {
    "percolate": {
      "field": "query",
      "documents": [
        {
          "message": "bonsai tree"
        },
        {
          "message": "new tree"
        },
        {
          "message": "the office"
        },
        {
          "message": "office tree"
        }
      ]
    }
  },
  "highlight": {
    "fields": {
      "message": {}
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The slightly different response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "took": 13,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped" : 0,
    "failed": 0
  },
  "hits": {
    "total" : {
        "value": 1,
        "relation": "eq"
    },
    "max_score": 0.7093853,
    "hits": [
      {
        "_index": "my-index-00001",
        "_type": "_doc",
        "_id": "1",
        "_score": 0.7093853,
        "_source": {
          "query": {
            "match": {
              "message": "bonsai tree"
            }
          }
        },
        "fields" : {
          "_percolator_document_slot" : [0, 1, 3]
        },
        "highlight" : { <b class="conum">(1)</b>
          "0_message" : [
              "&lt;em&gt;bonsai&lt;/em&gt; &lt;em&gt;tree&lt;/em&gt;"
          ],
          "3_message" : [
              "office &lt;em&gt;tree&lt;/em&gt;"
          ],
          "1_message" : [
              "new &lt;em&gt;tree&lt;/em&gt;"
          ]
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The highlight fields have been prefixed with the document slot they belong to,
in order to know which highlight field belongs to what document.</p>
</li>
</ol>
</div>
<h4 id="_specifying_multiple_percolate_queries" class="discrete">Specifying multiple percolate queries</h4>
<div class="paragraph">
<p>It is possible to specify multiple <code>percolate</code> queries in a single search request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-00001/_search
{
  "query": {
    "bool": {
      "should": [
        {
          "percolate": {
            "field": "query",
            "document": {
              "message": "bonsai tree"
            },
            "name": "query1" <b class="conum">(1)</b>
          }
        },
        {
          "percolate": {
            "field": "query",
            "document": {
              "message": "tulip flower"
            },
            "name": "query2" <b class="conum">(1)</b>
          }
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>name</code> parameter will be used to identify which percolator document slots belong to what <code>percolate</code> query.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>_percolator_document_slot</code> field name will be suffixed with what is specified in the <code>_name</code> parameter.
If that isn&#8217;t specified then the <code>field</code> parameter will be used, which in this case will result in ambiguity.</p>
</div>
<div class="paragraph">
<p>The above search request returns a response similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console-result" data-lang="console-result">{
  "took": 13,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped" : 0,
    "failed": 0
  },
  "hits": {
    "total" : {
        "value": 1,
        "relation": "eq"
    },
    "max_score": 0.26152915,
    "hits": [
      {
        "_index": "my-index-00001",
        "_type": "_doc",
        "_id": "1",
        "_score": 0.26152915,
        "_source": {
          "query": {
            "match": {
              "message": "bonsai tree"
            }
          }
        },
        "fields" : {
          "_percolator_document_slot_query1" : [0] <b class="conum">(1)</b>
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>_percolator_document_slot_query1</code> percolator slot field indicates that these matched slots are from the <code>percolate</code>
query with <code>_name</code> parameter set to <code>query1</code>.</p>
</li>
</ol>
</div>
<h4 id="how-it-works" class="discrete">How it Works Under the Hood</h4>
<div class="paragraph">
<p>When indexing a document into an index that has the <a href="mapping-types.html#percolator">percolator field type</a> mapping configured, the query
part of the document gets parsed into a Lucene query and is stored into the Lucene index. A binary representation
of the query gets stored, but also the query&#8217;s terms are analyzed and stored into an indexed field.</p>
</div>
<div class="paragraph">
<p>At search time, the document specified in the request gets parsed into a Lucene document and is stored in a in-memory
temporary Lucene index. This in-memory index can just hold this one document and it is optimized for that. After this
a special query is built based on the terms in the in-memory index that select candidate percolator queries based on
their indexed query terms. These queries are then evaluated by the in-memory index if they actually match.</p>
</div>
<div class="paragraph">
<p>The selecting of candidate percolator queries matches is an important performance optimization during the execution
of the <code>percolate</code> query as it can significantly reduce the number of candidate matches the in-memory index needs to
evaluate. The reason the <code>percolate</code> query can do this is because during indexing of the percolator queries the query
terms are being extracted and indexed with the percolator query. Unfortunately the percolator cannot extract terms from
all queries (for example the <code>wildcard</code> or <code>geo_shape</code> query) and as a result of that in certain cases the percolator
can&#8217;t do the selecting optimization (for example if an unsupported query is defined in a required clause of a boolean query
or the unsupported query is the only query in the percolator document).  These queries are marked by the percolator and
can be found by running the following search:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search
{
  "query": {
    "term" : {
      "query.extraction_result" : "failed"
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The above example assumes that there is a <code>query</code> field of type
<code>percolator</code> in the mappings.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Given the design of percolation, it often makes sense to use separate indices for the percolate queries and documents
being percolated, as opposed to a single index as we do in examples. There are a few benefits to this approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Because percolate queries contain a different set of fields from the percolated documents, using two separate indices
allows for fields to be stored in a denser, more efficient way.</p>
</li>
<li>
<p>Percolate queries do not scale in the same way as other queries, so percolation performance may benefit from using
a different index configuration, like the number of primary shards.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="percolate-query-notes">Notes</h4>
<div class="sect4">
<h5 id="_allow_expensive_queries_3">Allow expensive queries</h5>
<div class="paragraph">
<p>Percolate queries will not be executed if <a href="query-dsl.html#query-dsl-allow-expensive-queries"><code>search.allow_expensive_queries</code></a>
is set to false.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-dsl-rank-feature-query">Rank feature query</h3>
<titleabbrev>Rank feature</titleabbrev>
<div class="paragraph">
<p>Boosts the <a href="query-filter-context.html#relevance-scores">relevance score</a> of documents based on the
numeric value of a <a href="mapping-types.html#rank-feature"><code>rank_feature</code></a> or
<a href="mapping-types.html#rank-features"><code>rank_features</code></a> field.</p>
</div>
<div class="paragraph">
<p>The <code>rank_feature</code> query is typically used in the <code>should</code> clause of a
<a href="compound-queries.html#query-dsl-bool-query"><code>bool</code></a> query so its relevance scores are added to other
scores from the <code>bool</code> query.</p>
</div>
<div class="paragraph">
<p>Unlike the <a href="compound-queries.html#query-dsl-function-score-query"><code>function_score</code></a> query or other
ways to change <a href="query-filter-context.html#relevance-scores">relevance scores</a>, the
<code>rank_feature</code> query efficiently skips non-competitive hits when the
<a href="getting-started-modify-data.html#search-uri-request"><code>track_total_hits</code></a> parameter is <strong>not</strong> <code>true</code>. This can
dramatically improve query speed.</p>
</div>
<div class="sect3">
<h4 id="rank-feature-query-functions">Rank feature functions</h4>
<div class="paragraph">
<p>To calculate relevance scores based on rank feature fields, the <code>rank_feature</code>
query supports the following mathematical functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="specialized-queries.html#rank-feature-query-saturation">Saturation</a></p>
</li>
<li>
<p><a href="specialized-queries.html#rank-feature-query-logarithm">Logarithm</a></p>
</li>
<li>
<p><a href="specialized-queries.html#rank-feature-query-sigmoid">Sigmoid</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you don&#8217;t know where to start, we recommend using the <code>saturation</code> function.
If no function is provided, the <code>rank_feature</code> query uses the <code>saturation</code>
function by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="rank-feature-query-ex-request">Example request</h4>
<div class="sect4">
<h5 id="rank-feature-query-index-setup">Index setup</h5>
<div class="paragraph">
<p>To use the <code>rank_feature</code> query, your index must include a
<a href="mapping-types.html#rank-feature"><code>rank_feature</code></a> or <a href="mapping-types.html#rank-features"><code>rank_features</code></a> field
mapping. To see how you can set up an index for the <code>rank_feature</code> query, try
the following example.</p>
</div>
<div class="paragraph">
<p>Create a <code>test</code> index with the following field mappings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pagerank</code>, a <a href="mapping-types.html#rank-feature"><code>rank_feature</code></a> field which measures the
importance of a website</p>
</li>
<li>
<p><code>url_length</code>, a <a href="mapping-types.html#rank-feature"><code>rank_feature</code></a> field which contains the
length of the website&#8217;s URL. For this example, a long URL correlates negatively
to relevance, indicated by a <code>positive_score_impact</code> value of <code>false</code>.</p>
</li>
<li>
<p><code>topics</code>, a <a href="mapping-types.html#rank-features"><code>rank_features</code></a> field which contains a list of
topics and a measure of how well each document is connected to this topic</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /test
{
  "mappings": {
    "properties": {
      "pagerank": {
        "type": "rank_feature"
      },
      "url_length": {
        "type": "rank_feature",
        "positive_score_impact": false
      },
      "topics": {
        "type": "rank_features"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Index several documents to the <code>test</code> index.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">PUT /test/_doc/1?refresh
{
  "url": "https://en.wikipedia.org/wiki/2016_Summer_Olympics",
  "content": "Rio 2016",
  "pagerank": 50.3,
  "url_length": 42,
  "topics": {
    "sports": 50,
    "brazil": 30
  }
}

PUT /test/_doc/2?refresh
{
  "url": "https://en.wikipedia.org/wiki/2016_Brazilian_Grand_Prix",
  "content": "Formula One motor race held on 13 November 2016",
  "pagerank": 50.3,
  "url_length": 47,
  "topics": {
    "sports": 35,
    "formula one": 65,
    "brazil": 20
  }
}

PUT /test/_doc/3?refresh
{
  "url": "https://en.wikipedia.org/wiki/Deadpool_(film)",
  "content": "Deadpool is a 2016 American superhero film",
  "pagerank": 50.3,
  "url_length": 37,
  "topics": {
    "movies": 60,
    "super hero": 65
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rank-feature-query-ex-query">Example query</h5>
<div class="paragraph">
<p>The following query searches for <code>2016</code> and boosts relevance scores based on
<code>pagerank</code>, <code>url_length</code>, and the <code>sports</code> topic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /test/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "content": "2016"
          }
        }
      ],
      "should": [
        {
          "rank_feature": {
            "field": "pagerank"
          }
        },
        {
          "rank_feature": {
            "field": "url_length",
            "boost": 0.1
          }
        },
        {
          "rank_feature": {
            "field": "topics.sports",
            "boost": 0.4
          }
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rank-feature-top-level-params">Top-level parameters for <code>rank_feature</code></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>field</code></dt>
<dd>
<p>(Required, string) <a href="mapping-types.html#rank-feature"><code>rank_feature</code></a> or
<a href="mapping-types.html#rank-features"><code>rank_features</code></a> field used to boost
<a href="query-filter-context.html#relevance-scores">relevance scores</a>.</p>
</dd>
<dt class="hdlist1"><code>boost</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, float) Floating point number used to decrease or increase
<a href="query-filter-context.html#relevance-scores">relevance scores</a>. Defaults to <code>1.0</code>.</p>
</div>
<div class="paragraph">
<p>Boost values are relative to the default value of <code>1.0</code>. A boost value between
<code>0</code> and <code>1.0</code> decreases the relevance score. A value greater than <code>1.0</code>
increases the relevance score.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>saturation</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, <a href="specialized-queries.html#rank-feature-query-saturation">function object</a>) Saturation
function used to boost <a href="query-filter-context.html#relevance-scores">relevance scores</a> based on the
value of the rank feature <code>field</code>. If no function is provided, the <code>rank_feature</code>
query defaults to the <code>saturation</code> function. See
<a href="specialized-queries.html#rank-feature-query-saturation">Saturation</a> for more information.</p>
</div>
<div class="paragraph">
<p>Only one function <code>saturation</code>, <code>log</code>, or <code>sigmoid</code> can be provided.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>log</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, <a href="specialized-queries.html#rank-feature-query-logarithm">function object</a>) Logarithmic
function used to boost <a href="query-filter-context.html#relevance-scores">relevance scores</a> based on the
value of the rank feature <code>field</code>. See
<a href="specialized-queries.html#rank-feature-query-logarithm">Logarithm</a> for more information.</p>
</div>
<div class="paragraph">
<p>Only one function <code>saturation</code>, <code>log</code>, or <code>sigmoid</code> can be provided.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>sigmoid</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Optional, <a href="specialized-queries.html#rank-feature-query-sigmoid">function object</a>) Sigmoid function used
to boost <a href="query-filter-context.html#relevance-scores">relevance scores</a> based on the value of the
rank feature <code>field</code>. See <a href="specialized-queries.html#rank-feature-query-sigmoid">Sigmoid</a> for more
information.</p>
</div>
<div class="paragraph">
<p>Only one function <code>saturation</code>, <code>log</code>, or <code>sigmoid</code> can be provided.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="rank-feature-query-notes">Notes</h4>
<div class="sect4">
<h5 id="rank-feature-query-saturation">Saturation</h5>
<div class="paragraph">
<p>The <code>saturation</code> function gives a score equal to <code>S / (S + pivot)</code>, where <code>S</code> is
the value of the rank feature field and <code>pivot</code> is a configurable pivot value so
that the result will be less than <code>0.5</code> if <code>S</code> is less than pivot and greater
than <code>0.5</code> otherwise. Scores are always <code>(0,1)</code>.</p>
</div>
<div class="paragraph">
<p>If the rank feature has a negative score impact then the function will be
computed as <code>pivot / (S + pivot)</code>, which decreases when <code>S</code> increases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /test/_search
{
  "query": {
    "rank_feature": {
      "field": "pagerank",
      "saturation": {
        "pivot": 8
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a <code>pivot</code> value is not provided, OpenSearch computes a default value equal to the
approximate geometric mean of all rank feature values in the index. We recommend
using this default value if you haven&#8217;t had the opportunity to train a good
pivot value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /test/_search
{
  "query": {
    "rank_feature": {
      "field": "pagerank",
      "saturation": {}
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rank-feature-query-logarithm">Logarithm</h5>
<div class="paragraph">
<p>The <code>log</code> function gives a score equal to <code>log(scaling_factor + S)</code>, where <code>S</code>
is the value of the rank feature field and <code>scaling_factor</code> is a configurable
scaling factor. Scores are unbounded.</p>
</div>
<div class="paragraph">
<p>This function only supports rank features that have a positive score impact.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /test/_search
{
  "query": {
    "rank_feature": {
      "field": "pagerank",
      "log": {
        "scaling_factor": 4
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rank-feature-query-sigmoid">Sigmoid</h5>
<div class="paragraph">
<p>The <code>sigmoid</code> function is an extension of <code>saturation</code> which adds a configurable
exponent. Scores are computed as <code>S<sup>exp</sup> / (S<sup>exp</sup> + pivot<sup>exp</sup>)</code>. Like for the
<code>saturation</code> function, <code>pivot</code> is the value of <code>S</code> that gives a score of <code>0.5</code>
and scores are <code>(0,1)</code>.</p>
</div>
<div class="paragraph">
<p>The <code>exponent</code> must be positive and is typically in <code>[0.5, 1]</code>. A
good value should be computed via training. If you don&#8217;t have the opportunity to
do so, we recommend you use the <code>saturation</code> function instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /test/_search
{
  "query": {
    "rank_feature": {
      "field": "pagerank",
      "sigmoid": {
        "pivot": 7,
        "exponent": 0.6
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-dsl-script-query">Script query</h3>
<titleabbrev>Script</titleabbrev>
<div class="paragraph">
<p>Filters documents based on a provided <a href="modules-scripting-using.html">script</a>. The
<code>script</code> query is typically used in a <a href="query-filter-context.html">filter context</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Using scripts can result in slower search speeds. See
<a href="modules-scripting-using.html#scripts-and-search-speed">Scripts and search speed</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="script-query-ex-request">Example request</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search
{
  "query": {
    "bool": {
      "filter": {
        "script": {
          "script": {
            "source": "doc['num1'].value &gt; 1",
            "lang": "painless"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="script-top-level-params">Top-level parameters for <code>script</code></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>script</code></dt>
<dd>
<p>(Required, <a href="modules-scripting-using.html">script object</a>) Contains a script to run
as a query. This script must return a boolean value, <code>true</code> or <code>false</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="script-query-notes">Notes</h4>
<div class="sect4">
<h5 id="script-query-custom-params">Custom Parameters</h5>
<div class="paragraph">
<p>Like <a href="query-filter-context.html">filters</a>, scripts are cached for faster execution.
If you frequently change the arguments of a script, we recommend you store them
in the script&#8217;s <code>params</code> parameter. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search
{
  "query": {
    "bool": {
      "filter": {
        "script": {
          "script": {
            "source": "doc['num1'].value &gt; params.param1",
            "lang": "painless",
            "params": {
              "param1": 5
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_allow_expensive_queries_4">Allow expensive queries</h5>
<div class="paragraph">
<p>Script queries will not be executed if <a href="query-dsl.html#query-dsl-allow-expensive-queries"><code>search.allow_expensive_queries</code></a>
is set to false.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-dsl-script-score-query">Script score query</h3>
<titleabbrev>Script score</titleabbrev>
<div class="paragraph">
<p>Uses a <a href="modules-scripting.html">script</a> to provide a custom score for returned
documents.</p>
</div>
<div class="paragraph">
<p>The <code>script_score</code> query is useful if, for example, a scoring function is expensive and you only need to calculate the score of a filtered set of documents.</p>
</div>
<div class="sect3">
<h4 id="script-score-query-ex-request">Example request</h4>
<div class="paragraph">
<p>The following <code>script_score</code> query assigns each returned document a score equal to the <code>my-int</code> field value divided by <code>10</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search
{
  "query": {
    "script_score": {
      "query": {
        "match": { "message": "opensearch" }
      },
      "script": {
        "source": "doc['my-int'].value / 10 "
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="script-score-top-level-params">Top-level parameters for <code>script_score</code></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>query</code></dt>
<dd>
<p>(Required, query object) Query used to return documents.</p>
</dd>
<dt class="hdlist1"><code>script</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>(Required, <a href="modules-scripting-using.html">script object</a>) Script used to compute the score of documents returned by the <code>query</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Final relevance scores from the <code>script_score</code> query cannot be
negative. To support certain search optimizations, Lucene requires
scores be positive or <code>0</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>min_score</code></dt>
<dd>
<p>(Optional, float) Documents with a score lower
than this floating point number are excluded from the search results.</p>
</dd>
<dt class="hdlist1"><code>boost</code></dt>
<dd>
<p>(Optional, float) Documents' scores produced by <code>script</code> are
multiplied by <code>boost</code> to produce final documents' scores. Defaults to <code>1.0</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="script-score-query-notes">Notes</h4>
<div class="sect4">
<h5 id="script-score-access-scores">Use relevance scores in a script</h5>
<div class="paragraph">
<p>Within a script, you can
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-scripting-fields.html#scripting-score">access</a>
the <code>_score</code> variable which represents the current relevance score of a
document.</p>
</div>
</div>
<div class="sect4">
<h5 id="script-score-predefined-functions">Predefined functions</h5>
<div class="paragraph">
<p>You can use any of the available <a href="https://www.opensearch.org/guide/en/opensearch/painless/{branch}/painless-contexts.html">painless
functions</a> in your <code>script</code>. You can also use the following predefined functions
to customize scoring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="specialized-queries.html#script-score-saturation">Saturation</a></p>
</li>
<li>
<p><a href="specialized-queries.html#script-score-sigmoid">Sigmoid</a></p>
</li>
<li>
<p><a href="specialized-queries.html#random-score-function">Random score function</a></p>
</li>
<li>
<p><a href="specialized-queries.html#decay-functions-numeric-fields">Decay functions for numeric fields</a></p>
</li>
<li>
<p><a href="specialized-queries.html#decay-functions-geo-fields">Decay functions for geo fields</a></p>
</li>
<li>
<p><a href="specialized-queries.html#decay-functions-date-fields">Decay functions for date fields</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We suggest using these predefined functions instead of writing your own.
These functions take advantage of efficiencies from OpenSearch' internal mechanisms.</p>
</div>
<div class="sect5">
<h6 id="script-score-saturation">Saturation</h6>
<div class="paragraph">
<p><code>saturation(value,k) = value/(k + value)</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "saturation(doc['my-int'].value, 1)"
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="script-score-sigmoid">Sigmoid</h6>
<div class="paragraph">
<p><code>sigmoid(value, k, a) = value^a/ (k^a + value^a)</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "sigmoid(doc['my-int'].value, 2, 1)"
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="random-score-function">Random score function</h6>
<div class="paragraph">
<p><code>random_score</code> function generates scores that are uniformly distributed
from 0 up to but not including 1.</p>
</div>
<div class="paragraph">
<p><code>randomScore</code> function has the following syntax:
<code>randomScore(&lt;seed&gt;, &lt;fieldName&gt;)</code>.
It has a required parameter - <code>seed</code> as an integer value,
and an optional parameter - <code>fieldName</code> as a string value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "randomScore(100, '_seq_no')"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>fieldName</code> parameter is omitted, the internal Lucene
document ids will be used as a source of randomness. This is very efficient,
but unfortunately not reproducible since documents might be renumbered
by merges.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "randomScore(100)"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that documents that are within the same shard and have the
same value for field will get the same score, so it is usually desirable
to use a field that has unique values for all documents across a shard.
A good default choice might be to use the <code>_seq_no</code>
field, whose only drawback is that scores will change if the document is
updated since update operations also update the value of the <code>_seq_no</code> field.</p>
</div>
</div>
<div class="sect5">
<h6 id="decay-functions-numeric-fields">Decay functions for numeric fields</h6>
<div class="paragraph">
<p>You can read more about decay functions
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/query-dsl-function-score-query.html#function-decay">here</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>double decayNumericLinear(double origin, double scale, double offset, double decay, double docValue)</code></p>
</li>
<li>
<p><code>double decayNumericExp(double origin, double scale, double offset, double decay, double docValue)</code></p>
</li>
<li>
<p><code>double decayNumericGauss(double origin, double scale, double offset, double decay, double docValue)</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "decayNumericLinear(params.origin, params.scale, params.offset, params.decay, doc['dval'].value)",
    "params": { <b class="conum">(1)</b>
        "origin": 20,
        "scale": 10,
        "decay" : 0.5,
        "offset" : 0
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Using <code>params</code> allows to compile the script only once, even if params change.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="decay-functions-geo-fields">Decay functions for geo fields</h6>
<div class="ulist">
<ul>
<li>
<p><code>double decayGeoLinear(String originStr, String scaleStr, String offsetStr, double decay, GeoPoint docValue)</code></p>
</li>
<li>
<p><code>double decayGeoExp(String originStr, String scaleStr, String offsetStr, double decay, GeoPoint docValue)</code></p>
</li>
<li>
<p><code>double decayGeoGauss(String originStr, String scaleStr, String offsetStr, double decay, GeoPoint docValue)</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "decayGeoExp(params.origin, params.scale, params.offset, params.decay, doc['location'].value)",
    "params": {
        "origin": "40, -70.12",
        "scale": "200km",
        "offset": "0km",
        "decay" : 0.2
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="decay-functions-date-fields">Decay functions for date fields</h6>
<div class="ulist">
<ul>
<li>
<p><code>double decayDateLinear(String originStr, String scaleStr, String offsetStr, double decay, JodaCompatibleZonedDateTime docValueDate)</code></p>
</li>
<li>
<p><code>double decayDateExp(String originStr, String scaleStr, String offsetStr, double decay, JodaCompatibleZonedDateTime docValueDate)</code></p>
</li>
<li>
<p><code>double decayDateGauss(String originStr, String scaleStr, String offsetStr, double decay, JodaCompatibleZonedDateTime docValueDate)</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "decayDateGauss(params.origin, params.scale, params.offset, params.decay, doc['date'].value)",
    "params": {
        "origin": "2008-01-01T01:00:00Z",
        "scale": "1h",
        "offset" : "0",
        "decay" : 0.5
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Decay functions on dates are limited to dates in the default format
and default time zone. Also calculations with <code>now</code> are not supported.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_allow_expensive_queries_5">Allow expensive queries</h5>
<div class="paragraph">
<p>Script score queries will not be executed if <a href="query-dsl.html#query-dsl-allow-expensive-queries"><code>search.allow_expensive_queries</code></a>
is set to false.</p>
</div>
</div>
<div class="sect4">
<h5 id="script-score-faster-alt">Faster alternatives</h5>
<div class="paragraph">
<p>The <code>script_score</code> query calculates the score for
every matching document, or hit. There are faster alternative query types that
can efficiently skip non-competitive hits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you want to boost documents on some static fields, use the
<a href="specialized-queries.html#query-dsl-rank-feature-query"><code>rank_feature</code></a> query.</p>
</li>
<li>
<p>If you want to boost documents closer to a date or geographic point, use the
<a href="specialized-queries.html#query-dsl-distance-feature-query"><code>distance_feature</code></a> query.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="script-score-function-score-transition">Transition from the function score query</h5>
<div class="paragraph">
<p>We are deprecating the <a href="compound-queries.html#query-dsl-function-score-query"><code>function_score</code></a>
query. We recommend using the <code>script_score</code> query instead.</p>
</div>
<div class="paragraph">
<p>You can implement the following functions from the <code>function_score</code> query using
the <code>script_score</code> query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="specialized-queries.html#script-score"><code>script_score</code></a></p>
</li>
<li>
<p><a href="specialized-queries.html#weight"><code>weight</code></a></p>
</li>
<li>
<p><a href="specialized-queries.html#random-score"><code>random_score</code></a></p>
</li>
<li>
<p><a href="specialized-queries.html#field-value-factor"><code>field_value_factor</code></a></p>
</li>
<li>
<p><a href="specialized-queries.html#decay-functions"><code>decay</code> functions</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="script-score"><code>script_score</code></h6>
<div class="paragraph">
<p>What you used in <code>script_score</code> of the Function Score query, you
can copy into the Script Score query. No changes here.</p>
</div>
</div>
<div class="sect5">
<h6 id="weight"><code>weight</code></h6>
<div class="paragraph">
<p><code>weight</code> function can be implemented in the Script Score query through
the following script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "params.weight * _score",
    "params": {
        "weight": 2
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="random-score"><code>random_score</code></h6>
<div class="paragraph">
<p>Use <code>randomScore</code> function
as described in <a href="specialized-queries.html#random-score-function">random score function</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="field-value-factor"><code>field_value_factor</code></h6>
<div class="paragraph">
<p><code>field_value_factor</code> function can be easily implemented through script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "Math.log10(doc['field'].value * params.factor)",
    "params" : {
        "factor" : 5
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For checking if a document has a missing value, you can use
<code>doc['field'].size() == 0</code>. For example, this script will use
a value <code>1</code> if a document doesn&#8217;t have a field <code>field</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">"script" : {
    "source" : "Math.log10((doc['field'].size() == 0 ? 1 : doc['field'].value()) * params.factor)",
    "params" : {
        "factor" : 5
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This table lists how <code>field_value_factor</code> modifiers can be implemented
through a script:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Modifier</th>
<th class="tableblock halign-left valign-top">Implementation in Script Score</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Math.log10(doc['f'].value)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log1p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Math.log10(doc['f'].value + 1)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log2p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Math.log10(doc['f'].value + 2)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ln</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Math.log(doc['f'].value)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ln1p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Math.log(doc['f'].value + 1)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ln2p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Math.log(doc['f'].value + 2)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>square</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Math.pow(doc['f'].value, 2)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sqrt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Math.sqrt(doc['f'].value)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reciprocal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0 / doc['f'].value</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="decay-functions"><code>decay</code> functions</h6>
<div class="paragraph">
<p>The <code>script_score</code> query has equivalent <a href="specialized-queries.html#decay-functions">decay functions</a>
that can be used in script.</p>
</div>
</div>
<div class="sect5">
<h6 id="score-explanation">Explain request</h6>
<div class="paragraph">
<p>Using an <a href="search.html#search-explain">explain request</a> provides an explanation of how the parts of a score were computed. The <code>script_score</code> query can add its own explanation by setting the <code>explanation</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /my-index-000001/_explain/0
{
  "query": {
    "script_score": {
      "query": {
        "match": { "message": "opensearch" }
      },
      "script": {
        "source": """
          long count = doc['count'].value;
          double normalizedCount = count / 10;
          if (explanation != null) {
            explanation.set('normalized count = count / 10 = ' + count + ' / 10 = ' + normalizedCount);
          }
          return normalizedCount;
        """
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>explanation</code> will be null when using in a normal <code>_search</code> request, so having a conditional guard is best practice.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="query-dsl-wrapper-query">Wrapper query</h3>
<titleabbrev>Wrapper</titleabbrev>
<div class="paragraph">
<p>A query that accepts any other query as base64 encoded string.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /_search
{
  "query": {
    "wrapper": {
      "query": "eyJ0ZXJtIiA6IHsgInVzZXIuaWQiIDogImtpbWNoeSIgfX0=" <b class="conum">(1)</b>
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Base64 encoded string:  <code>{"term" : { "user.id" : "bilbo" }}</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This query is more useful in the context of the Java high-level REST client or
transport client to also accept queries as json formatted string.
In these cases queries can be specified as a json or yaml formatted string or
as a query builder (which is a available in the Java high-level REST client).</p>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="span-queries.html">Span queries</a> | ↑ Up: <a href="query-dsl.html">Query DSL</a> | ⌂ Home: <a href="index.html">OpenSearch Reference</a> | Next: <a href="term-level-queries.html">Term-level queries</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-04-12 14:08:20 -0700
</div>
</div>
</body>
</html>