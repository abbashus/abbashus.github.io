<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<title>OpenSearch Plugins and Integrations</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="discovery" class="book toc2 toc-left">
<div id="header">
<h1>OpenSearch Plugins and Integrations</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OpenSearch Plugins and Integrations</a></span></p><ul class="sectlevel1">
<li><a href="intro.html">Introduction to plugins</a>
</li>
<li><a href="plugin-management.html">Plugin Management</a>
</li>
<li><a href="analysis.html">Analysis Plugins</a>
</li>
<li><a href="discovery.html"><span class="toc-current">Discovery Plugins</span></a>
<ul class="sectlevel2">
<li><a href="discovery.html#discovery-ec2">EC2 Discovery Plugin</a>
</li>
<li><a href="discovery.html#discovery-azure-classic">Azure Classic Discovery Plugin</a>
</li>
<li><a href="discovery.html#discovery-gce">GCE Discovery Plugin</a>
</li>
</ul>
</li>
<li><a href="ingest.html">Ingest Plugins</a>
</li>
<li><a href="mapper.html">Mapper Plugins</a>
</li>
<li><a href="repository.html">Snapshot/Restore Repository Plugins</a>
</li>
<li><a href="store.html">Store Plugins</a>
</li>
<li><a href="plugin-authors.html">Help for plugin authors</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="discovery">Discovery Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Discovery plugins extend OpenSearch by adding new seed hosts providers that
can be used to extend the <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-discovery.html">cluster formation
module</a>.</p>
</div>
<h4 id="_core_discovery_plugins" class="discrete">Core discovery plugins</h4>
<div class="paragraph">
<p>The core discovery plugins are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="discovery.html#discovery-ec2">EC2 discovery</a></dt>
<dd>
<p>The EC2 discovery plugin uses the <a href="https://github.com/aws/aws-sdk-java">AWS API</a>
to identify the addresses of seed hosts.</p>
</dd>
<dt class="hdlist1"><a href="discovery.html#discovery-azure-classic">Azure Classic discovery</a></dt>
<dd>
<p>The Azure Classic discovery plugin uses the Azure Classic API to identify the
addresses of seed hosts.</p>
</dd>
<dt class="hdlist1"><a href="discovery.html#discovery-gce">GCE discovery</a></dt>
<dd>
<p>The Google Compute Engine discovery plugin uses the GCE API to identify the
addresses of seed hosts.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="discovery-ec2">EC2 Discovery Plugin</h3>
<div class="paragraph">
<p>The EC2 discovery plugin provides a list of seed addresses to the
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-discovery-hosts-providers.html">discovery process</a> by querying the
<a href="https://github.com/aws/aws-sdk-java">AWS API</a> for a list of EC2 instances
matching certain criteria determined by the <a href="discovery.html#discovery-ec2-usage">plugin
settings</a>.</p>
</div>
<h4 id="discovery-ec2-install" class="discrete">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo bin/opensearch-plugin install discovery-ec2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<div class="paragraph">
<p>You can download this plugin for <a href="plugin-management.html#plugin-management-custom-url">offline
install</a> from <a href="https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-ec2/discovery-ec2-1.0.0.zip" class="bare">https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-ec2/discovery-ec2-1.0.0.zip</a>. To verify
the <code>.zip</code> file, use the
<a href="https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-ec2/discovery-ec2-1.0.0.zip.sha512">SHA hash</a> or
<a href="https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-ec2/discovery-ec2-1.0.0.zip.asc">ASC key</a>.</p>
</div>
<h4 id="discovery-ec2-remove" class="discrete">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo bin/opensearch-plugin remove discovery-ec2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="discovery-ec2-usage">Using the EC2 discovery plugin</h4>
<div class="paragraph">
<p>The <code>discovery-ec2</code> plugin allows OpenSearch to find the master-eligible nodes in a
cluster running on AWS EC2 by querying the
<a href="https://github.com/aws/aws-sdk-java">AWS API</a> for the addresses of the EC2
instances running these nodes.</p>
</div>
<div class="paragraph">
<p>It is normally a good idea to restrict the discovery process just to the
master-eligible nodes in the cluster. This plugin allows you to identify these
nodes by certain criteria including their tags, their membership of security
groups, and their placement within availability zones. The discovery process
will work correctly even if it finds master-ineligible nodes, but master
elections will be more efficient if this can be avoided.</p>
</div>
<div class="paragraph">
<p>The interaction with the AWS API can be authenticated using the
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html">instance
role</a>, or else custom credentials can be supplied.</p>
</div>
<div class="sect4">
<h5 id="_enabling_ec2_discovery">Enabling EC2 discovery</h5>
<div class="paragraph">
<p>To enable EC2 discovery, configure OpenSearch to use the <code>ec2</code> seed hosts provider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">discovery.seed_providers: ec2</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_ec2_discovery">Configuring EC2 discovery</h5>
<div class="paragraph">
<p>EC2 discovery supports a number of settings. Some settings are sensitive and
must be stored in the <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html">OpenSearch keystore</a>. For example,
to authenticate using a particular access key and secret key, add these keys to
the keystore by running the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">bin/opensearch-keystore add discovery.ec2.access_key
bin/opensearch-keystore add discovery.ec2.secret_key</code></pre>
</div>
</div>
<div class="paragraph">
<p>The available settings for the EC2 discovery plugin are as follows.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>discovery.ec2.access_key</code> (<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html">Secure</a>, <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html#reloadable-secure-settings">reloadable</a>)</dt>
<dd>
<p>An EC2 access key. If set, you must also set <code>discovery.ec2.secret_key</code>.
If unset, <code>discovery-ec2</code> will instead use the instance role. This setting
is sensitive and must be stored in the OpenSearch keystore.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.secret_key</code> (<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html">Secure</a>, <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html#reloadable-secure-settings">reloadable</a>)</dt>
<dd>
<p>An EC2 secret key. If set, you must also set <code>discovery.ec2.access_key</code>.
This setting is sensitive and must be stored in the OpenSearch keystore.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.session_token</code> (<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html">Secure</a>, <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html#reloadable-secure-settings">reloadable</a>)</dt>
<dd>
<p>An EC2 session token. If set, you must also set <code>discovery.ec2.access_key</code>
and <code>discovery.ec2.secret_key</code>. This setting is sensitive and must be
stored in the OpenSearch keystore.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.endpoint</code></dt>
<dd>
<p>The EC2 service endpoint to which to connect. See
<a href="https://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region" class="bare">https://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region</a> to find
the appropriate endpoint for the region. This setting defaults to
<code>ec2.us-east-1.amazonaws.com</code> which is appropriate for clusters running in
the <code>us-east-1</code> region.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.protocol</code></dt>
<dd>
<p>The protocol to use to connect to the EC2 service endpoint, which may be
either <code>http</code> or <code>https</code>. Defaults to <code>https</code>.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.proxy.host</code></dt>
<dd>
<p>The address or host name of an HTTP proxy through which to connect to EC2.
If not set, no proxy is used.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.proxy.port</code></dt>
<dd>
<p>When the address of an HTTP proxy is given in <code>discovery.ec2.proxy.host</code>,
this setting determines the port to use to connect to the proxy. Defaults to
<code>80</code>.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.proxy.username</code> (<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html">Secure</a>, <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html#reloadable-secure-settings">reloadable</a>)</dt>
<dd>
<p>When the address of an HTTP proxy is given in <code>discovery.ec2.proxy.host</code>,
this setting determines the username to use to connect to the proxy. When
not set, no username is used. This setting is sensitive and must be stored
in the OpenSearch keystore.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.proxy.password</code> (<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html">Secure</a>, <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html#reloadable-secure-settings">reloadable</a>)</dt>
<dd>
<p>When the address of an HTTP proxy is given in <code>discovery.ec2.proxy.host</code>,
this setting determines the password to use to connect to the proxy. When
not set, no password is used. This setting is sensitive and must be stored
in the OpenSearch keystore.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.read_timeout</code></dt>
<dd>
<p>The socket timeout for connections to EC2,
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/common-options.html#time-units">including the units</a>. For example, a
value of <code>60s</code> specifies a 60-second timeout. Defaults to 50 seconds.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.groups</code></dt>
<dd>
<p>A list of the names or IDs of the security groups to use for discovery. The
<code>discovery.ec2.any_group</code> setting determines the behaviour of this setting.
Defaults to an empty list, meaning that security group membership is
ignored by EC2 discovery.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.any_group</code></dt>
<dd>
<p>Defaults to <code>true</code>, meaning that instances belonging to <em>any</em> of the
security groups specified in <code>discovery.ec2.groups</code> will be used for
discovery. If set to <code>false</code>, only instances that belong to <em>all</em> of the
security groups specified in <code>discovery.ec2.groups</code> will be used for
discovery.</p>
</dd>
<dt class="hdlist1"><code>discovery.ec2.host_type</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Each EC2 instance has a number of different addresses that might be suitable
for discovery. This setting allows you to select which of these addresses is
used by the discovery process. It can be set to one of <code>private_ip</code>,
<code>public_ip</code>, <code>private_dns</code>, <code>public_dns</code> or <code>tag:TAGNAME</code> where <code>TAGNAME</code>
refers to a name of a tag. This setting defaults to <code>private_ip</code>.</p>
</div>
<div class="paragraph">
<p>If you set <code>discovery.ec2.host_type</code> to a value of the form <code>tag:TAGNAME</code> then
the value of the tag <code>TAGNAME</code> attached to each instance will be used as that
instance&#8217;s address for discovery. Instances which do not have this tag set will
be ignored by the discovery process.</p>
</div>
<div class="paragraph">
<p>For example if you tag some EC2 instances with a tag named
<code>opensearch-host-name</code> and set <code>host_type: tag:opensearch-host-name</code> then
the <code>discovery-ec2</code> plugin will read each instance&#8217;s host name from the value
of the <code>opensearch-host-name</code> tag.
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">Read more
about EC2 Tags</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>discovery.ec2.availability_zones</code></dt>
<dd>
<p>A list of the names of the availability zones to use for discovery. The
name of an availability zone is the
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">region
code followed by a letter</a>, such as <code>us-east-1a</code>. Only instances placed in
one of the given availability zones will be used for discovery.</p>
</dd>
</dl>
</div>
<div id="discovery-ec2-filtering" class="dlist">
<dl>
<dt class="hdlist1"><code>discovery.ec2.tag.TAGNAME</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>A list of the values of a tag called <code>TAGNAME</code> to use for discovery. If set,
only instances that are tagged with one of the given values will be used for
discovery. For instance, the following settings will only use nodes with a
<code>role</code> tag set to <code>master</code> and an <code>environment</code> tag set to either <code>dev</code> or
<code>staging</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">discovery.ec2.tag.role: master
discovery.ec2.tag.environment: dev,staging</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The names of tags used for discovery may only contain ASCII letters,
numbers, hyphens and underscores. In particular you cannot use tags whose name
includes a colon.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>discovery.ec2.node_cache_time</code></dt>
<dd>
<p>Sets the length of time for which the collection of discovered instances is
cached. OpenSearch waits at least this long between requests for discovery
information from the EC2 API. AWS may reject discovery requests if they are
made too often, and this would cause discovery to fail. Defaults to <code>10s</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All <strong>secure</strong> settings of this plugin are
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/secure-settings.html#reloadable-secure-settings">reloadable</a>, allowing you
to update the secure settings for this plugin without needing to restart each
node.</p>
</div>
</div>
<div class="sect4">
<h5 id="discovery-ec2-permissions">Recommended EC2 permissions</h5>
<div class="paragraph">
<p>The <code>discovery-ec2</code> plugin works by making a <code>DescribeInstances</code> call to the AWS
EC2 API. You must configure your AWS account to allow this, which is normally
done using an IAM policy. You can create a custom policy via the IAM Management
Console. It should look similar to this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "Statement": [
    {
      "Action": [
        "ec2:DescribeInstances"
      ],
      "Effect": "Allow",
      "Resource": [
        "*"
      ]
    }
  ],
  "Version": "2012-10-17"
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="discovery-ec2-attributes">Automatic node attributes</h5>
<div class="paragraph">
<p>The <code>discovery-ec2</code> plugin can automatically set the <code>aws_availability_zone</code>
node attribute to the availability zone of each node. This node attribute
allows you to ensure that each shard has copies allocated redundantly across
multiple availability zones by using the
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-cluster.html#shard-allocation-awareness">Allocation Awareness</a>
feature.</p>
</div>
<div class="paragraph">
<p>In order to enable the automatic definition of the <code>aws_availability_zone</code>
attribute, set <code>cloud.node.auto_attributes</code> to <code>true</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cloud.node.auto_attributes: true
cluster.routing.allocation.awareness.attributes: aws_availability_zone</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>aws_availability_zone</code> attribute can be automatically set like this when
using any discovery type. It is not necessary to set <code>discovery.seed_providers:
ec2</code>. However this feature does require that the <code>discovery-ec2</code> plugin is
installed.</p>
</div>
</div>
<div class="sect4">
<h5 id="discovery-ec2-network-host">Binding to the correct address</h5>
<div class="paragraph">
<p>It is important to define <code>network.host</code> correctly when deploying a cluster on
EC2. By default each OpenSearch node only binds to <code>localhost</code>, which will prevent it
from being discovered by nodes running on any other instances.</p>
</div>
<div class="paragraph">
<p>You can use the <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-network.html">core network host settings</a> to bind
each node to the desired address, or you can set <code>network.host</code> to one of the
following EC2-specific settings provided by the <code>discovery-ec2</code> plugin:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">EC2 Host Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>ec2:privateIpv4</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The private IP address (ipv4) of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>ec2:privateDns</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The private host of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>ec2:publicIpv4</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The public IP address (ipv4) of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>ec2:publicDns</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The public host of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>ec2:privateIp</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equivalent to <code><em>ec2:privateIpv4</em></code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>ec2:publicIp</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equivalent to <code><em>ec2:publicIpv4</em></code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>ec2</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equivalent to <code><em>ec2:privateIpv4</em></code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These values are acceptable when using any discovery type. They do not require
you to set <code>discovery.seed_providers: ec2</code>. However they do require that the
<code>discovery-ec2</code> plugin is installed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-aws-best-practices">Best Practices in AWS</h4>
<div class="paragraph">
<p>This section contains some other information about designing and managing an
OpenSearch cluster on your own AWS infrastructure.</p>
</div>
<div class="sect4">
<h5 id="_storage">Storage</h5>
<div class="paragraph">
<p>EC2 instances offer a number of different kinds of storage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/InstanceStorage.html">Instance
storage</a> works well for OpenSearch clusters and offers excellent performance. Because it replicates each shard across multiple nodes, OpenSearch works well with this kind of ephemeral storage. If a node fails and its instance storage is lost, OpenSearch rebuilds any lost shards from replicas.</p>
</li>
<li>
<p><a href="https://aws.amazon.com/ebs/">EBS-based storage</a> also works well, especially on modern instance types. Be sure to use provisioned IOPS to ensure your cluster has satisfactory performance.</p>
</li>
<li>
<p><a href="https://aws.amazon.com/efs/">EFS-based storage</a> is not
recommended. Historically, shared network filesystems such as EFS have not always offered precisely the behaviour that OpenSearch requires of its filesystem, which can lead to index corruption. Although EFS offers durability, shared
storage, and the ability to grow and shrink filesystems dynamically, you can
achieve the same benefits using OpenSearch directly.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_choice_of_ami">Choice of AMI</h5>
<div class="paragraph">
<p>We recommend the <a href="https://aws.amazon.com/amazon-linux-2/">Amazon Linux 2 AMIs</a>. These images are lightweight and have EC2-specific performance enhancements.</p>
</div>
</div>
<div class="sect4">
<h5 id="_networking">Networking</h5>
<div class="ulist">
<ul>
<li>
<p>Smaller instance types have less network bandwidth. Check the <a href="https://aws.amazon.com/ec2/instance-types/">EC2 instance types</a> to make sure the bandwidth meets your needs.</p>
</li>
<li>
<p>It is a good idea to distribute your nodes across multiple
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">availability zones</a> and use <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-cluster.html#shard-allocation-awareness">shard allocation awareness</a> to ensure that each shard has copies in more than one availability zone.</p>
</li>
<li>
<p>Do not span a cluster across regions. OpenSearch expects that node-to-node
connections within a cluster are reasonably reliable and offer high bandwidth
and low latency, and these properties do not hold for connections between
regions. Although an OpenSearch cluster will behave correctly when node-to-node
connections are unreliable or slow, it is not optimised for this case and its
performance may suffer. If you wish to geographically distribute your data, use features like <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-cross-cluster-search.html">cross-cluster search</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_other_recommendations">Other recommendations</h5>
<div class="ulist">
<ul>
<li>
<p>If you have split your nodes into roles, consider
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">tagging the
EC2 instances</a> by role to make it easier to filter and view your EC2 instances
in the AWS console.</p>
</li>
<li>
<p>Consider
<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/terminating-instances.html#Using_ChangingDisableAPITermination">enabling
termination protection</a> for all of your data and master-eligible nodes. This
will help to prevent accidental termination of these nodes which could
temporarily reduce the resilience of the cluster and which could cause a
potentially disruptive reallocation of shards.</p>
</li>
<li>
<p>If running your cluster using one or more
<a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/AutoScalingGroup.html">auto-scaling
groups</a>, consider protecting your data and master-eligible nodes
<a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/as-instance-termination.html#instance-protection-instance">against
termination during scale-in</a>. This helps prevent automatic termination
of these nodes, which could temporarily reduce the resilience of the cluster and could cause a potentially disruptive reallocation of shards. If these
instances are protected against termination during scale-in, you can use
<a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/shard-allocation-filtering.html">shard allocation filtering</a> to gracefully
migrate any data off these nodes before terminating them manually.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="discovery-azure-classic">Azure Classic Discovery Plugin</h3>
<div class="paragraph">
<p>The deprecated Azure Classic Discovery plugin uses the Azure Classic API to identify the
addresses of seed hosts.</p>
</div>
<h4 id="discovery-azure-classic-install" class="discrete">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo bin/opensearch-plugin install discovery-azure-classic</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<div class="paragraph">
<p>You can download this plugin for <a href="plugin-management.html#plugin-management-custom-url">offline
install</a> from <a href="https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-azure-classic/discovery-azure-classic-1.0.0.zip" class="bare">https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-azure-classic/discovery-azure-classic-1.0.0.zip</a>. To verify
the <code>.zip</code> file, use the
<a href="https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-azure-classic/discovery-azure-classic-1.0.0.zip.sha512">SHA hash</a> or
<a href="https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-azure-classic/discovery-azure-classic-1.0.0.zip.asc">ASC key</a>.</p>
</div>
<h4 id="discovery-azure-classic-remove" class="discrete">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo bin/opensearch-plugin remove discovery-azure-classic</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="discovery-azure-classic-usage">Azure Virtual Machine Discovery</h4>
<div class="paragraph">
<p>Azure VM discovery allows to use the Azure APIs to perform automatic discovery.
Here is a simple sample configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cloud:
    azure:
        management:
             subscription.id: XXX-XXX-XXX-XXX
             cloud.service.name: opensearch-demo-app
             keystore:
                   path: /path/to/azurekeystore.pkcs12
                   password: WHATEVER
                   type: pkcs12

discovery:
    seed_providers: azure</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="title">Binding the network host</div>
<div class="paragraph">
<p>The keystore file must be placed in a directory accessible by OpenSearch like the <code>config</code> directory.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to define <code>network.host</code> as by default it&#8217;s bound to <code>localhost</code>.</p>
</div>
<div class="paragraph">
<p>You can use <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-network.html">core network host settings</a>. For example <code><em>en0</em></code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="discovery-azure-classic-short">How to start (short story)</h5>
<div class="ulist">
<ul>
<li>
<p>Create Azure instances</p>
</li>
<li>
<p>Install OpenSearch</p>
</li>
<li>
<p>Install Azure plugin</p>
</li>
<li>
<p>Modify <code>opensearch.yml</code> file</p>
</li>
<li>
<p>Start OpenSearch</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="discovery-azure-classic-settings">Azure credential API settings</h5>
<div class="paragraph">
<p>The following are a list of settings that can further control the credential API:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.keystore.path</code>
</td>
<td class="hdlist2">
<p>/path/to/keystore</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.keystore.type</code>
</td>
<td class="hdlist2">
<p><code>pkcs12</code>, <code>jceks</code> or <code>jks</code>. Defaults to <code>pkcs12</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.keystore.password</code>
</td>
<td class="hdlist2">
<p>your_password for the keystore</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.subscription.id</code>
</td>
<td class="hdlist2">
<p>your_azure_subscription_id</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cloud.azure.management.cloud.service.name</code>
</td>
<td class="hdlist2">
<p>your_azure_cloud_service_name. This is the cloud service name/DNS but without the <code>cloudapp.net</code> part.
So if the DNS name is <code>abc.cloudapp.net</code> then the <code>cloud.service.name</code> to use is just <code>abc</code>.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="discovery-azure-classic-settings-advanced">Advanced settings</h5>
<div class="paragraph">
<p>The following are a list of settings that can further control the discovery:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>discovery.azure.host.type</code></dt>
<dd>
<p>Either <code>public_ip</code> or <code>private_ip</code> (default). Azure discovery will use the
one you set to ping other nodes.</p>
</dd>
<dt class="hdlist1"><code>discovery.azure.endpoint.name</code></dt>
<dd>
<p>When using <code>public_ip</code> this setting is used to identify the endpoint name
used to forward requests to OpenSearch (aka transport port name).
Defaults to <code>opensearch</code>. In Azure management console, you could define
an endpoint <code>opensearch</code> forwarding for example requests on public IP
on port 8100 to the virtual machine on port 9300.</p>
</dd>
<dt class="hdlist1"><code>discovery.azure.deployment.name</code></dt>
<dd>
<p>Deployment name if any. Defaults to the value set with
<code>cloud.azure.management.cloud.service.name</code>.</p>
</dd>
<dt class="hdlist1"><code>discovery.azure.deployment.slot</code></dt>
<dd>
<p>Either <code>staging</code> or <code>production</code> (default).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">discovery:
    type: azure
    azure:
        host:
            type: private_ip
        endpoint:
            name: opensearch
        deployment:
            name: your_azure_cloud_service_name
            slot: production</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-azure-classic-long">Setup process for Azure Discovery</h4>
<div class="paragraph">
<p>We will expose here one strategy which is to hide our OpenSearch cluster from outside.</p>
</div>
<div class="paragraph">
<p>With this strategy, only VMs behind the same virtual port can talk to each
other.  That means that with this mode, you can use OpenSearch unicast
discovery to build a cluster, using the Azure API to retrieve information
about your nodes.</p>
</div>
<div class="sect4">
<h5 id="discovery-azure-classic-long-prerequisites">Prerequisites</h5>
<div class="paragraph">
<p>Before starting, you need to have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="https://azure.microsoft.com/en-us/">Windows Azure account</a></p>
</li>
<li>
<p>OpenSSL that isn&#8217;t from MacPorts, specifically <code>OpenSSL 1.0.1f 6 Jan
 2014</code> doesn&#8217;t seem to create a valid keypair for ssh. FWIW,
<code>OpenSSL 1.0.1c 10 May 2012</code> on Ubuntu 14.04 LTS is known to work.</p>
</li>
<li>
<p>SSH keys and certificate</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You should follow <a href="http://azure.microsoft.com/en-us/documentation/articles/linux-use-ssh-key/">this guide</a> to learn
how to create or use existing SSH keys. If you have already did it, you can skip the following.</p>
</div>
<div class="paragraph">
<p>Here is a description on how to generate SSH keys using <code>openssl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># You may want to use another dir than /tmp
cd /tmp
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout azure-private.key -out azure-certificate.pem
chmod 600 azure-private.key azure-certificate.pem
openssl x509 -outform der -in azure-certificate.pem -out azure-certificate.cer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generate a keystore which will be used by the plugin to authenticate with a certificate
all Azure API calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Generate a keystore (azurekeystore.pkcs12)
# Transform private key to PEM format
openssl pkcs8 -topk8 -nocrypt -in azure-private.key -inform PEM -out azure-pk.pem -outform PEM
# Transform certificate to PEM format
openssl x509 -inform der -in azure-certificate.cer -out azure-cert.pem
cat azure-cert.pem azure-pk.pem &gt; azure.pem.txt
# You MUST enter a password!
openssl pkcs12 -export -in azure.pem.txt -out azurekeystore.pkcs12 -name azure -noiter -nomaciter</code></pre>
</div>
</div>
<div class="paragraph">
<p>Upload the <code>azure-certificate.cer</code> file both in the OpenSearch Cloud Service (under <code>Manage Certificates</code>),
and under <code>Settings &#8594; Manage Certificates</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When prompted for a password, you need to enter a non empty one.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See this <a href="http://www.windowsazure.com/en-us/manage/linux/how-to-guides/ssh-into-linux/">guide</a> for
more details about how to create keys for Azure.</p>
</div>
<div class="paragraph">
<p>Once done, you need to upload your certificate in Azure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <a href="https://account.windowsazure.com/">management console</a>.</p>
</li>
<li>
<p>Sign in using your account.</p>
</li>
<li>
<p>Click on <code>Portal</code>.</p>
</li>
<li>
<p>Go to Settings (bottom of the left list)</p>
</li>
<li>
<p>On the bottom bar, click on <code>Upload</code> and upload your <code>azure-certificate.cer</code> file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may want to use
<a href="http://www.windowsazure.com/en-us/develop/nodejs/how-to-guides/command-line-tools/">Windows Azure Command-Line Tool</a>:</p>
</div>
</div>
</div>
</li>
<li>
<p>Install <a href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager">NodeJS</a>, for example using
homebrew on MacOS X:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">brew install node</code></pre>
</div>
</div>
</li>
<li>
<p>Install Azure tools</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo npm install azure-cli -g</code></pre>
</div>
</div>
</li>
<li>
<p>Download and import your azure settings:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># This will open a browser and will download a .publishsettings file
azure account download

# Import this file (we have downloaded it to /tmp)
# Note, it will create needed files in ~/.azure. You can remove azure.publishsettings when done.
azure account import /tmp/azure.publishsettings</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="discovery-azure-classic-long-instance">Creating your first instance</h5>
<div class="paragraph">
<p>You need to have a storage account available. Check <a href="http://www.windowsazure.com/en-us/develop/net/how-to-guides/blob-storage/#create-account">Azure Blob Storage documentation</a>
for more information.</p>
</div>
<div class="paragraph">
<p>You will need to choose the operating system you want to run on. To get a list of official available images, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">azure vm image list</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s say we are going to deploy an Ubuntu image on an extra small instance in West Europe:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Azure cluster name
</td>
<td class="hdlist2">
<p><code>azure-opensearch-cluster</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Image
</td>
<td class="hdlist2">
<p><code>b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-13_10-amd64-server-20130808-alpha3-en-us-30GB</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
VM Name
</td>
<td class="hdlist2">
<p><code>myesnode1</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
VM Size
</td>
<td class="hdlist2">
<p><code>extrasmall</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Location
</td>
<td class="hdlist2">
<p><code>West Europe</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Login
</td>
<td class="hdlist2">
<p><code>opensearch</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Password
</td>
<td class="hdlist2">
<p><code>password1234!!</code></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">azure vm create azure-opensearch-cluster \
                b39f27a8b8c64d52b05eac6a62ebad85__Ubuntu-13_10-amd64-server-20130808-alpha3-en-us-30GB \
                --vm-name myesnode1 \
                --location "West Europe" \
                --vm-size extrasmall \
                --ssh 22 \
                --ssh-cert /tmp/azure-certificate.pem \
                opensearch password1234\!\!</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">info:    Executing command vm create
+ Looking up image
+ Looking up cloud service
+ Creating cloud service
+ Retrieving storage accounts
+ Configuring certificate
+ Creating VM
info:    vm create command OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, your first instance is started.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Working with SSH</div>
<div class="paragraph">
<p>You need to give the private key and username each time you log on your instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">ssh -i ~/.ssh/azure-private.key opensearch@myescluster.cloudapp.net</code></pre>
</div>
</div>
<div class="paragraph">
<p>But you can also define it once in <code>~/.ssh/config</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Host *.cloudapp.net
 User opensearch
 StrictHostKeyChecking no
 UserKnownHostsFile=/dev/null
 IdentityFile ~/.ssh/azure-private.key</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, you need to install OpenSearch on your new instance. First, copy your
keystore to the instance, then connect to the instance using SSH:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">scp /tmp/azurekeystore.pkcs12 azure-opensearch-cluster.cloudapp.net:/home/opensearch
ssh azure-opensearch-cluster.cloudapp.net</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once connected, install OpenSearch and check that it is running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">GET /</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command should give you a JSON result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">{
  "name" : "Cp8oag6",
  "cluster_name" : "opensearch",
  "cluster_uuid" : "AT69_T_DTp-1qgIJlatQqA",
  "version" : {
    "number" : "{bare_version}",
    "build_type" : "tar",
    "build_hash" : "f27399d",
    "build_date" : "2016-03-30T09:51:41.449Z",
    "build_snapshot" : false,
    "lucene_version" : "8.7.0",
    "minimum_wire_compatibility_version" : "1.2.3",
    "minimum_index_compatibility_version" : "1.2.3"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="discovery-azure-classic-long-plugin">Install OpenSearch cloud azure plugin</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Stop OpenSearch
sudo service opensearch stop

# Install the plugin
sudo /usr/share/opensearch/bin/opensearch-plugin install discovery-azure-classic

# Configure it
sudo vi /etc/opensearch/opensearch.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># If you don't remember your account id, you may get it with `azure account list`
cloud:
    azure:
        management:
             subscription.id: your_azure_subscription_id
             cloud.service.name: your_azure_cloud_service_name
             keystore:
                   path: /home/opensearch/azurekeystore.pkcs12
                   password: your_password_for_keystore

discovery:
    type: azure

# Recommended (warning: non durable disk)
# path.data: /mnt/resource/opensearch/data</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart OpenSearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo service opensearch start</code></pre>
</div>
</div>
<div class="paragraph">
<p>If anything goes wrong, check your logs in <code>/var/log/opensearch</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-azure-classic-scale">Scaling Out!</h4>
<div class="paragraph">
<p>You need first to create an image of your previous machine.
Disconnect from your machine and run locally the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Shutdown the instance
azure vm shutdown myesnode1

# Create an image from this instance (it could take some minutes)
azure vm capture myesnode1 esnode-image --delete

# Note that the previous instance has been deleted (mandatory)
# So you need to create it again and BTW create other instances.

azure vm create azure-opensearch-cluster \
                esnode-image \
                --vm-name myesnode1 \
                --location "West Europe" \
                --vm-size extrasmall \
                --ssh 22 \
                --ssh-cert /tmp/azure-certificate.pem \
                opensearch password1234\!\!</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>It could happen that azure changes the endpoint public IP address.
DNS propagation could take some minutes before you can connect again using
name. You can get from azure the IP address if needed, using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Look at Network `Endpoints 0 Vip`
azure vm show myesnode1</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s start more instances!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">for x in $(seq  2 10)
	do
		echo "Launching azure instance #$x..."
		azure vm create azure-opensearch-cluster \
		                esnode-image \
		                --vm-name myesnode$x \
		                --vm-size extrasmall \
		                --ssh $((21 + $x)) \
		                --ssh-cert /tmp/azure-certificate.pem \
		                --connect \
		                opensearch password1234\!\!
	done</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to remove your running instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">azure vm delete myesnode1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="discovery-gce">GCE Discovery Plugin</h3>
<div class="paragraph">
<p>The Google Compute Engine Discovery plugin uses the GCE API to identify the
addresses of seed hosts.</p>
</div>
<h4 id="discovery-gce-install" class="discrete">Installation</h4>
<div class="paragraph">
<p>This plugin can be installed using the plugin manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo bin/opensearch-plugin install discovery-gce</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.</p>
</div>
<div class="paragraph">
<p>You can download this plugin for <a href="plugin-management.html#plugin-management-custom-url">offline
install</a> from <a href="https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-gce/discovery-gce-1.0.0.zip" class="bare">https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-gce/discovery-gce-1.0.0.zip</a>. To verify
the <code>.zip</code> file, use the
<a href="https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-gce/discovery-gce-1.0.0.zip.sha512">SHA hash</a> or
<a href="https://artifacts.opensearch.org/downloads/opensearch-plugins/discovery-gce/discovery-gce-1.0.0.zip.asc">ASC key</a>.</p>
</div>
<h4 id="discovery-gce-remove" class="discrete">Removal</h4>
<div class="paragraph">
<p>The plugin can be removed with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo bin/opensearch-plugin remove discovery-gce</code></pre>
</div>
</div>
<div class="paragraph">
<p>The node must be stopped before removing the plugin.</p>
</div>
<div class="sect3">
<h4 id="discovery-gce-usage">GCE Virtual Machine Discovery</h4>
<div class="paragraph">
<p>Google Compute Engine VM discovery allows to use the google APIs to perform
automatic discovery of seed hosts. Here is a simple sample configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cloud:
  gce:
      project_id: &lt;your-google-project-id&gt;
      zone: &lt;your-zone&gt;
discovery:
      seed_providers: gce</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following gce settings (prefixed with <code>cloud.gce</code>) are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>project_id</code></dt>
<dd>
<p>Your Google project id.
By default the project id will be derived from the instance metadata.</p>
<div class="literalblock">
<div class="content">
<pre>Note: Deriving the project id from system properties or environment variables
(`GOOGLE_CLOUD_PROJECT` or `GCLOUD_PROJECT`) is not supported.</pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>zone</code></dt>
<dd>
<p>helps to retrieve instances running in a given zone.
It should be one of the <a href="https://developers.google.com/compute/docs/zones#available">GCE supported zones</a>.
By default the zone will be derived from the instance metadata.
See also <a href="discovery.html#discovery-gce-usage-zones">Using GCE zones</a>.</p>
</dd>
<dt class="hdlist1"><code>retry</code></dt>
<dd>
<p>If set to <code>true</code>, client will use
<a href="https://developers.google.com/api-client-library/java/google-http-java-client/backoff">ExponentialBackOff</a>
policy to retry the failed http request. Defaults to <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>max_wait</code></dt>
<dd>
<p>The maximum elapsed time after the client instantiating retry. If the time elapsed goes past the
<code>max_wait</code>, client stops to retry. A negative value means that it will wait indefinitely. Defaults to <code>0s</code> (retry
indefinitely).</p>
</dd>
<dt class="hdlist1"><code>refresh_interval</code></dt>
<dd>
<p>How long the list of hosts is cached to prevent further requests to the GCE API. <code>0s</code> disables caching.
A negative value will cause infinite caching. Defaults to <code>0s</code>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="title">Binding the network host</div>
<div class="paragraph">
<p>It&#8217;s important to define <code>network.host</code> as by default it&#8217;s bound to <code>localhost</code>.</p>
</div>
<div class="paragraph">
<p>You can use <a href="https://www.opensearch.org/guide/en/opensearch/reference/{branch}/modules-network.html">core network host settings</a> or
<a href="discovery.html#discovery-gce-network-host">gce specific host settings</a>:</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="discovery-gce-network-host">GCE Network Host</h4>
<div class="paragraph">
<p>When the <code>discovery-gce</code> plugin is installed, the following are also allowed
as valid network host settings:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">GCE Host Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>gce:privateIp:X</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The private IP address of the machine for a given network interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>gce:hostname</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname of the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>gce</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <code><em>gce:privateIp:0</em></code> (recommended).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># get the IP address from network interface 1
network.host: _gce:privateIp:1_
# Using GCE internal hostname
network.host: _gce:hostname_
# shortcut for _gce:privateIp:0_ (recommended)
network.host: _gce_</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="discovery-gce-usage-short">How to start (short story)</h5>
<div class="ulist">
<ul>
<li>
<p>Create Google Compute Engine instance (with compute rw permissions)</p>
</li>
<li>
<p>Install OpenSearch</p>
</li>
<li>
<p>Install Google Compute Engine Cloud plugin</p>
</li>
<li>
<p>Modify <code>opensearch.yml</code> file</p>
</li>
<li>
<p>Start OpenSearch</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-gce-usage-long">Setting up GCE Discovery</h4>
<div class="sect4">
<h5 id="discovery-gce-usage-long-prerequisites">Prerequisites</h5>
<div class="paragraph">
<p>Before starting, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your project ID, e.g. <code>opensearch-cloud</code>. Get it from <a href="https://code.google.com/apis/console/">Google API Console</a>.</p>
</li>
<li>
<p>To install <a href="https://developers.google.com/cloud/sdk/">Google Cloud SDK</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you did not set it yet, you can define your default project you will work on:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gcloud config set project opensearch-cloud</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="discovery-gce-usage-long-login">Login to Google Cloud</h5>
<div class="paragraph">
<p>If you haven&#8217;t already, login to Google Cloud</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gcloud auth login</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will open your browser. You will be asked to sign-in to a Google account and
authorize access to the Google Cloud SDK.</p>
</div>
</div>
<div class="sect4">
<h5 id="discovery-gce-usage-long-first-instance">Creating your first instance</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gcloud compute instances create myopensearchnode1 \
       --zone &lt;your-zone&gt; \
       --scopes compute-rw</code></pre>
</div>
</div>
<div class="paragraph">
<p>When done, a report like this one should appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Created [https://www.googleapis.com/compute/v1/projects/opensearch-cloud-1070/zones/us-central1-f/instances/myesnode1].
NAME      ZONE          MACHINE_TYPE  PREEMPTIBLE INTERNAL_IP   EXTERNAL_IP   STATUS
myopensearchnode1 us-central1-f n1-standard-1             10.240.133.54 104.197.94.25 RUNNING</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now connect to your instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Connect using google cloud SDK
gcloud compute ssh myopensearchnode1 --zone europe-west1-a

# Or using SSH with external IP address
ssh -i ~/.ssh/google_compute_engine 192.158.29.199</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="title">Service Account Permissions</div>
<div class="paragraph">
<p>It&#8217;s important when creating an instance that the correct permissions are set. At a minimum, you must ensure you have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">scopes=compute-rw</code></pre>
</div>
</div>
<div class="paragraph">
<p>Failing to set this will result in unauthorized messages when starting OpenSearch.
See <a href="discovery.html#discovery-gce-usage-tips-permissions">Machine Permissions</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once connected, <a href="https://www.opensearch.org/guide/en/elastic-stack-get-started/{branch}/get-started-opensearch.html#install-opensearch">install OpenSearch</a>:</p>
</div>
</div>
<div class="sect4">
<h5 id="discovery-gce-usage-long-install-plugin">Install OpenSearch discovery gce plugin</h5>
<div class="paragraph">
<p>Install the plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Use Plugin Manager to install it
sudo bin/opensearch-plugin install discovery-gce</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open the <code>opensearch.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo vi /etc/opensearch/opensearch.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cloud:
  gce:
      project_id: opensearch-cloud
      zone: europe-west1-a
discovery:
      seed_providers: gce</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start OpenSearch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo /etc/init.d/opensearch start</code></pre>
</div>
</div>
<div class="paragraph">
<p>If anything goes wrong, you should check logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">tail -f /var/log/opensearch/opensearch.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>If needed, you can change log level to <code>trace</code> by opening <code>log4j2.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">sudo vi /etc/opensearch/log4j2.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>and adding the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># discovery
logger.discovery_gce.name = discovery.gce
logger.discovery_gce.level = trace</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-gce-usage-cloning">Cloning your existing machine</h4>
<div class="paragraph">
<p>In order to build a cluster on many nodes, you can clone your configured instance to new nodes.
You won&#8217;t have to reinstall everything!</p>
</div>
<div class="paragraph">
<p>First create an image of your running instance and upload it to Google Cloud Storage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Create an image of your current instance
sudo /usr/bin/gcimagebundle -d /dev/sda -o /tmp/

# An image has been created in `/tmp` directory:
ls /tmp
e4686d7f5bf904a924ae0cfeb58d0827c6d5b966.image.tar.gz

# Upload your image to Google Cloud Storage:
# Create a bucket to hold your image, let's say `opensearchimage`:
gsutil mb gs://opensearchimage

# Copy your image to this bucket:
gsutil cp /tmp/e4686d7f5bf904a924ae0cfeb58d0827c6d5b966.image.tar.gz gs://opensearchimage

# Then add your image to images collection:
gcloud compute images create opensearch-2-0-0 --source-uri gs://opensearchimage/e4686d7f5bf904a924ae0cfeb58d0827c6d5b966.image.tar.gz

# If the previous command did not work for you, logout from your instance
# and launch the same command from your local machine.</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="discovery-gce-usage-start-new-instances">Start new instances</h5>
<div class="paragraph">
<p>As you have now an image, you can create as many instances as you need:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Just change node name (here myopensearchnode2)
gcloud compute instances create myopensearchnode2 --image opensearch-2-0-0 --zone europe-west1-a

# If you want to provide all details directly, you can use:
gcloud compute instances create myopensearchnode2 --image=opensearch-2-0-0 \
       --zone europe-west1-a --machine-type f1-micro --scopes=compute-rw</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="discovery-gce-usage-remove-instance">Remove an instance (aka shut it down)</h5>
<div class="paragraph">
<p>You can use <a href="https://cloud.google.com/console">Google Cloud Console</a> or CLI to manage your instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Stopping and removing instances
gcloud compute instances delete myopensearchnode1 myopensearchnode2 \
       --zone=europe-west1-a

# Consider removing disk as well if you don't need them anymore
gcloud compute disks delete boot-myopensearchnode1 boot-myopensearchnode2  \
       --zone=europe-west1-a</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-gce-usage-zones">Using GCE zones</h4>
<div class="paragraph">
<p><code>cloud.gce.zone</code> helps to retrieve instances running in a given zone. It should be one of the
<a href="https://developers.google.com/compute/docs/zones#available">GCE supported zones</a>.</p>
</div>
<div class="paragraph">
<p>The GCE discovery can support multi zones although you need to be aware of network latency between zones.
To enable discovery across more than one zone, just enter add your zone list to <code>cloud.gce.zone</code> setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cloud:
  gce:
      project_id: &lt;your-google-project-id&gt;
      zone: ["&lt;your-zone1&gt;", "&lt;your-zone2&gt;"]
discovery:
      seed_providers: gce</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-gce-usage-tags">Filtering by tags</h4>
<div class="paragraph">
<p>The GCE discovery can also filter machines to include in the cluster based on tags using <code>discovery.gce.tags</code> settings.
For example, setting <code>discovery.gce.tags</code> to <code>dev</code> will only filter instances having a tag set to <code>dev</code>. Several tags
set will require all of those tags to be set for the instance to be included.</p>
</div>
<div class="paragraph">
<p>One practical use for tag filtering is when a GCE cluster contains many nodes
that are not master-eligible OpenSearch nodes. In this case, tagging the GCE
instances that <em>are</em> running the master-eligible OpenSearch nodes, and then filtering
by that tag, will help discovery to run more efficiently.</p>
</div>
<div class="paragraph">
<p>Add your tag when building the new instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gcloud compute instances create myopensearchnode1 --project=opensearch-cloud \
       --scopes=compute-rw \
       --tags=opensearch,dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, define it in <code>opensearch.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cloud:
  gce:
      project_id: opensearch-cloud
      zone: europe-west1-a
discovery:
      seed_providers: gce
      gce:
            tags: opensearch, dev</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-gce-usage-port">Changing default transport port</h4>
<div class="paragraph">
<p>By default, OpenSearch GCE plugin assumes that you run OpenSearch on 9300 default port.
But you can specify the port value OpenSearch is meant to use using google compute engine metadata <code>opensearch_port</code>:</p>
</div>
<div class="sect4">
<h5 id="discovery-gce-usage-port-create">When creating instance</h5>
<div class="paragraph">
<p>Add <code>--metadata opensearch_port=9301</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># when creating first instance
gcloud compute instances create myopensearchnode1 \
       --scopes=compute-rw,storage-full \
       --metadata opensearch_port=9301

# when creating an instance from an image
gcloud compute instances create myopensearchnode2 --image=opensearch-1-0-0-RC1 \
       --zone europe-west1-a --machine-type f1-micro --scopes=compute-rw \
       --metadata opensearch_port=9301</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="discovery-gce-usage-port-run">On a running instance</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gcloud compute instances add-metadata myopensearchnode1 \
       --zone europe-west1-a \
       --metadata opensearch_port=9301</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-gce-usage-tips">GCE Tips</h4>
<div class="sect4">
<h5 id="discovery-gce-usage-tips-projectid">Store project id locally</h5>
<div class="paragraph">
<p>If you don&#8217;t want to repeat the project id each time, you can save it in the local gcloud config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">gcloud config set project opensearch-cloud</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="discovery-gce-usage-tips-permissions">Machine Permissions</h5>
<div class="paragraph">
<p>If you have created a machine without the correct permissions, you will see <code>403 unauthorized</code> error messages. To change machine permission on an existing instance, first stop the instance then Edit. Scroll down to <code>Access Scopes</code> to change permission.  The other way to alter these permissions is to delete the instance (NOT THE DISK). Then create another with the correct permissions.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Creating machines with gcloud</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Ensure the following flags are set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">--scopes=compute-rw</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Creating with console (web)</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>When creating an instance using the web portal, click <em>Show advanced options</em>.</p>
</div>
<div class="paragraph">
<p>At the bottom of the page, under <code>PROJECT ACCESS</code>, choose <code>&gt;&gt; Compute &gt;&gt; Read Write</code>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Creating with knife google</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Set the service account scopes when creating the machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">knife google server create www1 \
    -m n1-standard-1 \
    -I debian-8 \
    -Z us-central1-a \
    -i ~/.ssh/id_rsa \
    -x jdoe \
    --gce-service-account-scopes https://www.googleapis.com/auth/compute.full_control</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, you may use the alias:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">    --gce-service-account-scopes compute-rw</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-gce-usage-testing">Testing GCE</h4>
<div class="paragraph">
<p>Integrations tests in this plugin require working GCE configuration and
therefore disabled by default. To enable tests prepare a config file
opensearch.yml with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cloud:
  gce:
      project_id: opensearch-cloud
      zone: europe-west1-a
discovery:
      seed_providers: gce</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replaces <code>project_id</code> and <code>zone</code> with your settings.</p>
</div>
<div class="paragraph">
<p>To run test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">mvn -Dtests.gce=true -Dtests.config=/path/to/config/file/opensearch.yml clean test</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>Previous:<a href="analysis.html">Analysis Plugins</a>| Up:<a href="index.html">OpenSearch Plugins and Integrations</a>| Next:<a href="ingest.html">Ingest Plugins</a></p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-04-05 12:06:59 -0700
</div>
</div>
</body>
</html>